<p-fluid>
  <div class="flex mt-4">
    <div class="card flex flex-col gap-4 w-full">
      <div class="flex justify-between items-center mb-2">
        <div class="flex items-center gap-1">
          <span class="bg-primary-500 text-white px-1.5 py-0.5 rounded-full text-xs font-bold">
            {{ index + 1 }}
          </span>
          <span class="font-semibold text-xl">Mặt hàng</span>
        </div>
        @if (!isViewOnly) {
          <p-button
            type="button"
            icon="pi pi-times"
            severity="danger"
            [rounded]="true"
            [outlined]="true"
            size="small"
            (onClick)="onRemove()"
            pTooltip="Xóa"
          />
        }
      </div>

      <div [formGroup]="itemForm">
        <!-- Category và Ingredient -->
        <div class="flex flex-row gap-4 mb-2">
          <div class="flex flex-col gap-1 w-full">
            <label for="category">Loại nguyên liệu</label>
            <p-dropdown
              [options]="categories"
              optionLabel="displayName"
              optionValue="id"
              placeholder="Chọn..."
              [showClear]="true"
              formControlName="categoryId"
              (onChange)="onCategoryChange($event.value)"
              class="w-full"
              [readonly]="isViewOnly"
            />
          </div>
          <div class="flex flex-col gap-1 w-full">
            <label for="ingredient">Nguyên liệu</label>
            <p-dropdown
              formControlName="ingredientId"
              [options]="ingredients"
              optionLabel="displayName"
              optionValue="id"
              placeholder="Chọn..."
              [showClear]="true"
              (onChange)="onIngredientChange($event.value)"
              [readonly]="isViewOnly"
            />
            <app-validation-error
              [control]="itemForm.get('ingredientId')"
              fieldName="Nguyên liệu"
            />
          </div>
        </div>

        <!-- Số lượng và Đơn vị -->
        <div class="flex flex-row gap-4 mb-2">
          <div class="flex flex-col gap-1 w-full">
            <label for="quantity">Số lượng</label>
            <p-inputnumber
              formControlName="quantity"
              [min]="1"
              [step]="1"
              placeholder="0"
              class="w-full"
              (onInput)="onCalculateTotal()"
              [readonly]="isViewOnly"
            />
            <app-validation-error [control]="itemForm.get('quantity')" fieldName="Số lượng" />
          </div>
          <div class="flex flex-col gap-1 w-full">
            <label for="unit">Đơn vị</label>
            <input
              type="text"
              pInputText
              id="unit"
              formControlName="unitId"
              placeholder="Chọn nguyên liệu trước..."
              readonly="true"
              [class.bg-gray-50]="true"
            />
            <app-validation-error [control]="itemForm.get('unitId')" fieldName="Đơn vị" />
          </div>
        </div>

        <!-- Đơn giá và Thành tiền -->
        <div class="flex flex-row gap-4 mb-2">
          <div class="flex flex-col gap-1 w-full">
            <label for="unitPrice">Đơn giá</label>
            <p-inputnumber
              formControlName="unitPrice"
              mode="currency"
              currency="VND"
              locale="vi-VN"
              [min]="0"
              [minFractionDigits]="0"
              [maxFractionDigits]="0"
              class="w-full"
              (onInput)="onCalculateTotal()"
              [readonly]="isViewOnly"
            />
            <app-validation-error [control]="itemForm.get('unitPrice')" fieldName="Đơn giá" />
          </div>
          <div class="flex flex-col gap-1 w-full">
            <label for="totalPrice">Thành tiền</label>
            <p-inputnumber
              formControlName="totalPrice"
              mode="currency"
              currency="VND"
              locale="vi-VN"
              [min]="0"
              [minFractionDigits]="0"
              [maxFractionDigits]="0"
              class="w-full"
              [readonly]="isViewOnly"
            />
            <app-validation-error [control]="itemForm.get('totalPrice')" fieldName="Thành tiền" />
          </div>
        </div>

        <!-- Nhà cung cấp và Ghi chú -->
        <div class="flex flex-row gap-4 mb-2">
          <div class="flex flex-col gap-1 w-full">
            <label for="supplier">Nhà cung cấp</label>
            <input
              pInputText
              id="supplier"
              type="text"
              formControlName="supplierInfo"
              placeholder="Thông tin nhà cung cấp..."
              [readonly]="isViewOnly"
            />
          </div>
          <div class="flex flex-col gap-1 w-full">
            <label for="notes">Ghi chú</label>
            <input
              type="text"
              pInputText
              id="notes"
              formControlName="notes"
              placeholder="Ghi chú cho mặt hàng này..."
              [readonly]="isViewOnly"
            />
          </div>
        </div>
      </div>
    </div>
  </div>
</p-fluid>
