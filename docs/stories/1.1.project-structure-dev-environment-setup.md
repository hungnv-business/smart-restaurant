# Story 1.1: Project Structure & Development Environment Setup (Thiết lập Cấu trúc Dự án & Môi trường Phát triển)

## Status (Trạng thái)
Done

## Story (Câu chuyện)
**As a** developer (lập trình viên),  
**I want** to establish ABP Framework project structure with proper configuration (tôi muốn thiết lập cấu trúc dự án ABP Framework với cấu hình phù hợp),  
**so that** development can proceed efficiently with all necessary tools (để quá trình phát triển có thể tiếp diễn hiệu quả với đầy đủ các công cụ cần thiết).

## Acceptance Criteria (Tiêu chí Chấp nhận)
1. ABP Framework solution created with .NET 8 and Angular 19 templates (Tạo giải pháp ABP Framework với mẫu .NET 8 và Angular 19)
2. PostgreSQL database connection configured with Vietnamese collation (Cấu hình kết nối cơ sở dữ liệu PostgreSQL với sắp xếp tiếng Việt)
3. Docker containerization setup completed with docker-compose (Hoàn thành thiết lập đóng gói Docker với docker-compose)
4. Development environment documented in CLAUDE.md (Tài liệu hóa môi trường phát triển trong CLAUDE.md)
5. Initial CI/CD pipeline configured with basic build and test stages (Cấu hình pipeline CI/CD ban đầu với các giai đoạn build và test cơ bản)

## Tasks / Subtasks (Nhiệm vụ / Nhiệm vụ con)

- [x] Thiết lập Giải pháp ABP Framework (AC: 1)
  - [x] Tạo giải pháp ABP Framework mới với lệnh CLI: `abp new SmartRestaurant -t app --ui angular --mobile none --database-provider ef --database-management-system postgresql --connection-string "User ID=postgres;Password=postgres;Host=localhost;Port=5432;Database=SmartRestaurant;"`
  - [x] Đọc lại cấu trúc source code rồi cập nhật lại vào các file cần thiết
  - [x] Chạy `abp install-libs` trong project HttpApi.Host để cài đặt các thư viện frontend cần thiết

- [x] Cấu hình Cơ sở Dữ liệu PostgreSQL (AC: 2)
  - [x] Cấu hình appsettings.json trong project SmartRestaurant.DbMigrator với chuỗi kết nối PostgreSQL
  - [x] Chạy project SmartRestaurant.DbMigrator để gen database
  - [x] Thiết lập sắp xếp tiếng Việt trong cấu hình cơ sở dữ liệu để hỗ trợ tìm kiếm văn bản
  - [x] Cập nhật cấu hình Entity Framework Core để sử dụng PostgreSQL provider
  - [x] Kiểm tra kết nối cơ sở dữ liệu và đảm bảo sắp xếp văn bản tiếng Việt hoạt động đúng

- [x] Thiết lập Môi trường Docker (AC: 3)
  - [x] Tạo docker-compose.dev.yml với PostgreSQL, Redis và các dịch vụ ứng dụng
  - [x] Tạo docker-compose.prod.yml để triển khai production trên VPS
  - [x] Cấu hình Dockerfile.api để đóng gói backend .NET 8
  - [x] Cấu hình Dockerfile.web để đóng gói Angular 19 frontend với Nginx
  - [x] Thêm nginx.conf để cấu hình reverse proxy

- [x] Tài liệu Môi trường Phát triển (AC: 4)
  - [x] Cập nhật CLAUDE.md, architecture.md, unified-project-structure.md với các lệnh và vị trí file cụ thể của ABP Framework
  - [x] Cập nhật các đường dẫn src/SmartRestaurant.* thành đường dẫn aspnet-core/src/SmartRestaurant.* cho các file có đường dẫn cũ
  - [x] Tài liệu hóa quy trình phát triển bao gồm tạo proxy và cài đặt thư viện
  - [x] Thêm phần khắc phục sự cố cho các vấn đề thường gặp của ABP và PostgreSQL
  - [x] Tài liệu hóa cấu hình và thiết lập cụ thể cho nhà hàng Việt Nam

- [x] Cấu hình Pipeline CI/CD (AC: 5)
  - [x] Tạo .github/workflows/ci.yaml để tự động hóa build và test
  - [x] Tạo .github/workflows/deploy.yaml cho pipeline triển khai VPS
  - [x] Cấu hình các giai đoạn build cho cả backend .NET và frontend Angular
  - [x] Thiết lập thực thi kiểm thử tự động với cơ sở dữ liệu test PostgreSQL phù hợp

## Dev Notes (Ghi chú Phát triển)

### Architecture Foundation References (Tham chiếu Nền tảng Kiến trúc)

**Tech Stack Configuration [Source: architecture/tech-stack.md]:**
- .NET 8 with C# 12.0 for backend development with ABP Framework 8.0
- Angular 19.x with TypeScript 5.0+ for frontend with PrimeNG 17.x components
- PostgreSQL 14+ as primary database with Vietnamese text search support
- Redis 7.0+ for session and performance caching
- Docker Compose for infrastructure as code and VPS deployment

**Project Structure Requirements [Source: architecture/unified-project-structure.md]:**
- Root level: src/ (ABP backend), angular/ (Angular 19), test/ (backend tests), infrastructure/ (Docker)
- ABP Layer Structure: Domain, Application, EntityFrameworkCore, HttpApi, HttpApi.Host
- Angular Structure: core/ (auth, signalr), shared/ (components, services), features/ (restaurant modules)
- Package.json scripts for ABP workflow: dev, generate-proxy, install-libs, migrate, test

**ABP CLI Commands for Project Setup:**
- Install ABP CLI: `dotnet tool install -g Volo.Abp.Cli`
- Create project: `abp new SmartRestaurant -t app --ui angular --mobile none --database-provider ef --database-management-system postgresql --connection-string "User ID=postgres;Password=postgres;Host=localhost;Port=5432;Database=SmartRestaurant;"`
- Generate Angular proxies: `cd angular && abp generate-proxy -t ng -u https://localhost:44391`
- Install frontend libraries: `cd angular && abp install-libs`
- Run database migrator: `cd aspnet-core && dotnet run --project src/SmartRestaurant.DbMigrator`

**Critical ABP Development Rules [Source: architecture/coding-standards.md]:**
- Always use ABP base classes for entities (FullAuditedEntity, etc.) - never create POCOs
- Use ABP proxy generation for frontend types - never manually create TypeScript interfaces
- Always use auto-generated ABP service proxies - never make direct HTTP calls
- Implement IApplicationService for auto-API generation - never create manual controllers
- Use ABP localization system for Vietnamese text - never hardcode Vietnamese strings

**Database Configuration Requirements:**
- PostgreSQL with Vietnamese collation for proper text sorting and search
- Entity Framework Core Code-First with ABP conventions
- Connection string configuration in appsettings.json for development and production
- Vietnamese text search indexes for menu items and customer data

**Docker Deployment Architecture:**
- Development: docker-compose.dev.yml with local PostgreSQL and Redis
- Production: docker-compose.prod.yml optimized for VPS deployment
- Nginx reverse proxy for Angular frontend serving and API routing
- Automated SSL certificate management with Let's Encrypt for production

### Testing (Kiểm thử)

**Test File Locations [Source: architecture/testing-strategy.md]:**
- Backend Tests: `test/SmartRestaurant.Domain.Tests/`, `test/SmartRestaurant.Application.Tests/`, `test/SmartRestaurant.HttpApi.Tests/`
- Frontend Tests: `angular/tests/unit/`, `angular/tests/integration/`, `angular/tests/e2e/`
- Test Framework: xUnit + Moq for .NET backend, Jasmine + Karma for Angular frontend

**Testing Requirements for This Story:**
- Backend: Verify ABP application services generate correctly and database connection works
- Frontend: Test ABP proxy generation and Angular service integration
- Integration: Verify full stack communication between Angular and ABP API
- E2E: Basic smoke test for application startup and initial page load

**Test Data Standards:**
- Use Vietnamese restaurant test data (menu items like "Phở Bò", "Cơm Tấm")
- Test Vietnamese currency formatting (₫) and date/time formats
- Verify PostgreSQL Vietnamese collation with proper sorting of diacritical marks

## Change Log (Lịch sử Thay đổi)

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-18 | 1.0 | Initial story creation from Epic 1.1 | Bob (Scrum Master) |

## Dev Agent Record (Ghi chép Tác nhân Phát triển)

*This section will be populated by the development agent during implementation*

### Agent Model Used (Mô hình Tác nhân Sử dụng)
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References (Tham chiếu Log Debug)
*No debug log references yet*

### Completion Notes List (Danh sách Ghi chú Hoàn thành)
- ✅ ABP Framework solution successfully created with SmartRestaurant project name
- ✅ PostgreSQL database configured with Vietnamese collation support
- ✅ Entity Framework Core migrations setup completed
- ✅ Database connection verified and working
- ✅ Docker development and production environments configured
- ✅ Docker containers with PostgreSQL Vietnamese collation support
- ✅ Nginx reverse proxy configured for production deployment
- ✅ Development environment documentation completed in CLAUDE.md
- ✅ Project structure documentation updated with actual ABP paths
- ✅ Root package.json with ABP workflow scripts created
- ✅ Comprehensive README.md with Vietnamese restaurant features
- ✅ CI/CD pipeline configured with multi-stage testing
- ✅ Production deployment workflow with VPS integration
- ✅ Security scanning and code quality checks implemented
- ✅ Architecture documentation updated with actual ABP project structure

### File List (Danh sách File)
**Infrastructure Files:**
- infrastructure/docker/docker-compose.dev.yml (Development environment)
- infrastructure/docker/docker-compose.prod.yml (Production environment)  
- infrastructure/docker/Dockerfile.api (Backend container)
- infrastructure/docker/Dockerfile.web (Frontend container with Nginx)
- infrastructure/docker/nginx.conf (Reverse proxy configuration)
- infrastructure/docker/init-scripts/01-vietnamese-collation.sql (DB setup)

**Documentation Files:**
- CLAUDE.md (Complete development guide with ABP commands and troubleshooting)
- README.md (Project overview with Vietnamese restaurant features)
- docs/architecture/unified-project-structure.md (Updated with actual ABP structure)
- docs/architecture.md (Updated with aspnet-core/ path structure)
- docs/architecture/high-level-architecture.md (Updated with complete project structure)
- package.json (Root scripts for ABP workflow)
- .env.example (Environment configuration template)

**CI/CD Files:**
- .github/workflows/ci.yaml (Comprehensive CI pipeline with multi-stage testing)
- .github/workflows/deploy.yaml (VPS deployment with staging and production)
- angular/package.json (Updated with CI test scripts)

## QA Results (Kết quả QA)

### Review Date (Ngày Review): 2025-08-18

### Reviewed By (Người Review): Quinn (Test Architect - Kiến trúc sư Kiểm thử)

### Code Quality Assessment (Đánh giá Chất lượng Mã nguồn)

**Triển khai nền tảng hạ tầng xuất sắc.** Câu chuyện này thiết lập một môi trường phát triển sẵn sàng cho sản xuất với việc đóng gói Docker toàn diện, đường ống CI/CD, và các cấu hình đặc thù cho Việt Nam. Việc triển khai thể hiện sự chú ý mạnh mẽ đến yêu cầu vận hành và tuân theo các phương pháp tốt nhất của ABP Framework.

**Điểm mạnh chính:**
- Môi trường Docker hoàn chỉnh với bản dựng nhiều giai đoạn cho phát triển và sản xuất
- Đường ống CI/CD toàn diện với quét bảo mật và xây dựng đa nền tảng
- Hỗ trợ ngôn ngữ tiếng Việt xuyên suốt hệ thống: PostgreSQL, tìm kiếm văn bản, định dạng
- Tài liệu hướng dẫn chi tiết với khắc phục sự cố cho ABP
- Cấu hình bảo mật được tăng cường: người dùng không có quyền root, kiểm tra sức khỏe, sẵn sàng SSL

### Tái cấu trúc Đã Thực hiện

Không cần tái cấu trúc mã nguồn - đây là câu chuyện tập trung vào hạ tầng và cấu hình. Tất cả cấu hình đều tuân theo các phương pháp hay nhất.

### Kiểm tra Tuân thủ

- **Tiêu chuẩn Mã nguồn**: ✓ Không áp dụng cho câu chuyện hạ tầng
- **Cấu trúc Dự án**: ✓ Triển khai đúng cấu trúc ABP Framework với thư mục aspnet-core/
- **Chiến lược Kiểm thử**: ✓ Đường ống CI bao gồm chiến lược kiểm thử toàn diện với dữ liệu thử nghiệm tiếng Việt
- **Tất cả Tiêu chí Chấp nhận Đạt yêu cầu**: ✓ Cả 5 tiêu chí chấp nhận được triển khai và xác thực đầy đủ

### Requirements Traceability (Truy xuất nguồn gốc Yêu cầu)

**AC1 - ABP Framework Solution (Giải pháp ABP Framework)**: ✓ COVERED (ĐÃ ĐÁNH DẤU)
- **Test (Kiểm thử)**: Backend build validation in CI pipeline (Kiểm tra xây dựng backend trong quy trình CI)
- **Validation (Xác thực)**: Successful .NET solution compilation with all ABP projects (Biên dịch thành công giải pháp .NET với tất cả các dự án ABP)

**AC2 - PostgreSQL Vietnamese Collation (Sắp xếp Tiếng Việt PostgreSQL)**: ✓ COVERED (ĐÃ ĐÁNH DẤU)
- **Test (Kiểm thử)**: Database initialization with vi_VN.UTF-8 locale (Khởi tạo cơ sở dữ liệu với định dạng vi_VN.UTF-8)
- **Validation (Xác thực)**: Vietnamese text search functions and collation verification (Các chức năng tìm kiếm văn bản tiếng Việt và xác minh sắp xếp)

**AC3 - Docker Containerization (Đóng gói Docker)**: ✓ COVERED (ĐÃ ĐÁNH DẤU)
- **Test (Kiểm thử)**: Docker build validation in CI pipeline (Kiểm tra xây dựng Docker trong quy trình CI)
- **Validation (Xác thực)**: Multi-stage builds for dev/prod environments (Xây dựng đa giai đoạn cho môi trường phát triển/sản xuất)

**AC4 - Development Documentation (Tài liệu Phát triển)**: ✓ COVERED (ĐÃ ĐÁNH DẤU)
- **Test (Kiểm thử)**: Manual validation of CLAUDE.md completeness (Xác thực thủ công tính đầy đủ của CLAUDE.md)
- **Validation (Xác thực)**: Comprehensive ABP commands and troubleshooting guide (Hướng dẫn lệnh ABP toàn diện và khắc phục sự cố)

**AC5 - CI/CD Pipeline**: ✓ COVERED (ĐÃ ĐÁNH DẤU)
- **Test (Kiểm thử)**: Pipeline execution with test database setup (Thực thi quy trình với thiết lập cơ sở dữ liệu thử nghiệm)
- **Validation (Xác thực)**: Multi-stage testing including security scans (Kiểm thử đa giai đoạn bao gồm quét bảo mật)

### Security Review (Đánh giá Bảo mật)

**PASS (ĐẠT)** - Strong security posture established (Thiết lập tư thế bảo mật vững chắc):
- Non-root Docker containers with proper user permissions (Các container Docker không phải root với quyền người dùng phù hợp)
- Security scanning integrated in CI pipeline: Trivy (Quét bảo mật tích hợp trong quy trình CI: Trivy)
- Environment variable externalization for secrets (Xuất các biến môi trường cho thông tin bí mật)
- Nginx security headers configured (Cấu hình tiêu đề bảo mật Nginx)
- SSL/TLS ready configuration for production (Cấu hình sẵn sàng SSL/TLS cho môi trường sản xuất)

**Security Enhancements Implemented (Cải tiến Bảo mật Đã triển khai):**
- Rate limiting in nginx configuration (Giới hạn tốc độ trong cấu hình nginx)
- Security headers: HSTS, CSP, X-Frame-Options (Tiêu đề bảo mật: HSTS, CSP, X-Frame-Options)
- Container health checks for reliability (Kiểm tra sức khỏe container để đảm bảo độ tin cậy)
- Secrets management via environment variables (Quản lý thông tin bí mật thông qua biến môi trường)

### Performance Considerations (Cân nhắc về Hiệu suất)

**PASS (ĐẠT)** - Performance optimizations included (Đã bao gồm các tối ưu hóa hiệu suất):
- Multi-stage Docker builds for optimized image sizes (Xây dựng Docker đa giai đoạn để tối ưu kích thước hình ảnh)
- Nginx caching and compression configured (Đã cấu hình bộ nhớ đệm và nén Nginx)
- Redis integration for session and performance caching (Tích hợp Redis cho phiên làm việc và bộ nhớ đệm hiệu suất)
- Database connection pooling via Entity Framework (Tổng hợp kết nối cơ sở dữ liệu thông qua Entity Framework)
- Vietnamese-specific optimizations: text search indexes (Tối ưu hóa đặc thù tiếng Việt: chỉ mục tìm kiếm văn bản)

### Non-Functional Requirements Assessment (Đánh giá Yêu cầu Phi chức năng)

**Security (Bảo mật)**: ✓ PASS - Comprehensive security measures implemented (Đã triển khai các biện pháp bảo mật toàn diện)
**Performance (Hiệu suất)**: ✓ PASS - Caching, compression, and optimization configured (Đã cấu hình bộ nhớ đệm, nén và tối ưu hóa)
**Reliability (Độ tin cậy)**: ✓ PASS - Health checks, restart policies, and monitoring ready (Đã sẵn sàng kiểm tra sức khỏe, chính sách khởi động lại và giám sát)
**Maintainability (Khả năng bảo trì)**: ✓ PASS - Excellent documentation and troubleshooting guides (Tài liệu xuất sắc và hướng dẫn khắc phục sự cố)
**Scalability (Khả năng mở rộng)**: ✓ PASS - Container architecture allows horizontal scaling (Kiến trúc container cho phép mở rộng theo chiều ngang)

### Files Modified During Review (File Được Sửa Đổi Trong Review)

None - infrastructure and documentation are correctly implemented (Không có - hạ tầng và tài liệu được triển khai đúng cách).

### Improvements Checklist (Danh sách Cải tiến)

All items handled successfully (Tất cả các mục đã được xử lý thành công):

- [x] Docker multi-environment configuration: dev/prod separation (Cấu hình Docker đa môi trường: phân tách phát triển/sản xuất)
- [x] Vietnamese collation and text search setup (Thiết lập sắp xếp và tìm kiếm văn bản tiếng Việt)
- [x] Security hardening: non-root containers, headers, SSL ready (Tăng cường bảo mật: container không phải root, tiêu đề, sẵn sàng SSL)
- [x] Comprehensive CI/CD with security scanning (CI/CD toàn diện với quét bảo mật)
- [x] Complete documentation with ABP-specific guidance (Tài liệu hoàn chỉnh với hướng dẫn đặc thù ABP)
- [x] Production-ready nginx configuration with caching (Cấu hình nginx sẵn sàng sản xuất với bộ nhớ đệm)
- [x] Environment variable management for secrets (Quản lý biến môi trường cho thông tin bí mật)
- [x] Multi-platform container builds (Xây dựng container đa nền tảng)
- [x] Health checks and monitoring readiness (Sẵn sàng kiểm tra sức khỏe và giám sát)

### Technical Debt Assessment (Đánh giá Nợ Kỹ thuật)

**Minimal technical debt identified (Đã xác định nợ kỹ thuật tối thiểu):**
- SSL certificates need manual configuration for production - documented in deployment guide (Chứng chỉ SSL cần cấu hình thủ công cho sản xuất - đã ghi chép trong hướng dẫn triển khai)
- Monitoring/observability could be enhanced - planned for future stories (Giám sát/khả năng quan sát có thể được cải thiện - dự kiến cho các câu chuyện tương lai)
- Container resource limits could be fine-tuned based on actual usage (Giới hạn tài nguyên container có thể được tinh chỉnh dựa trên việc sử dụng thực tế)

### Gate Status (Trạng thái Gate)

Gate: PASS → docs/qa/gates/1.1-project-structure-dev-environment-setup.yml

### Recommended Status (Trạng thái Đề xuất)

✓ **Ready for Done (Sẵn sàng Hoàn thành)** - All acceptance criteria met, comprehensive infrastructure foundation established with production-grade configurations (Tất cả tiêu chí chấp nhận đã đạt yêu cầu, nền tảng hạ tầng toàn diện được thiết lập với cấu hình cấp độ sản xuất).