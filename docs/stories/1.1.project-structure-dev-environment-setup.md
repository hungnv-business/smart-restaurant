# Story 1.1: Project Structure & Development Environment Setup
**Vietnamese version reference**: [Phiên bản tiếng Việt](vi/1.1.project-structure-dev-environment-setup.md)

## Status
Done

## Story
**As a** developer,  
**I want** to establish ABP Framework project structure with proper configuration,  
**so that** development can proceed efficiently with all necessary tools.

## Acceptance Criteria
1. ABP Framework solution created with .NET 8 and Angular 19 templates
2. PostgreSQL database connection configured with Vietnamese collation
3. Docker containerization setup completed with docker-compose
4. Development environment documented in CLAUDE.md
5. Initial CI/CD pipeline configured with basic build and test stages

## Tasks / Subtasks

- [x] ABP Framework Solution Setup (AC: 1)
  - [x] Create new ABP Framework solution with CLI command: `abp new SmartRestaurant -t app --ui angular --mobile none --database-provider ef --database-management-system postgresql --connection-string "User ID=postgres;Password=postgres;Host=localhost;Port=5432;Database=SmartRestaurant;"`
  - [x] Review source code structure and update necessary files
  - [x] Run `abp install-libs` in HttpApi.Host project to install required frontend libraries

- [x] PostgreSQL Database Configuration (AC: 2)
  - [x] Configure appsettings.json in SmartRestaurant.DbMigrator project with PostgreSQL connection string
  - [x] Run SmartRestaurant.DbMigrator project to generate database
  - [x] Setup Vietnamese collation in database configuration to support text search
  - [x] Update Entity Framework Core configuration to use PostgreSQL provider
  - [x] Test database connection and ensure Vietnamese text collation works correctly

- [x] Docker Environment Setup (AC: 3)
  - [x] Create docker-compose.dev.yml with PostgreSQL and application services
  - [x] Create docker-compose.prod.yml for production deployment on VPS
  - [x] Configure Dockerfile.api to package .NET 8 backend
  - [x] Configure Dockerfile.web to package Angular 19 frontend with Nginx
  - [x] Add nginx.conf for reverse proxy configuration

- [x] Development Environment Documentation (AC: 4)
  - [x] Update CLAUDE.md, architecture.md, unified-project-structure.md with specific ABP Framework commands and file locations
  - [x] Update paths from src/SmartRestaurant.* to aspnet-core/src/SmartRestaurant.* for files with old paths
  - [x] Document development process including proxy generation and library installation
  - [x] Add troubleshooting section for common ABP and PostgreSQL issues
  - [x] Document Vietnam restaurant-specific configurations and setup

- [x] CI/CD Pipeline Configuration (AC: 5)
  - [x] Create .github/workflows/ci.yaml for automated build and test
  - [x] Create .github/workflows/deploy.yaml for VPS deployment pipeline
  - [x] Configure build stages for both .NET backend and Angular frontend
  - [x] Setup automated test execution with appropriate PostgreSQL test database

## Dev Notes

### Architecture Foundation References

**Tech Stack Configuration [Source: architecture/tech-stack.md]:**
- .NET 8 with C# 12.0 for backend development with ABP Framework 8.0
- Angular 19.x with TypeScript 5.0+ for frontend with PrimeNG 17.x components
- PostgreSQL 14+ as primary database with Vietnamese text search support
- In-memory caching for session and performance optimization
- Docker Compose for infrastructure as code and VPS deployment

**Project Structure Requirements [Source: architecture/unified-project-structure.md]:**
- Root level: aspnet-core/ (ABP backend), angular/ (Angular 19), flutter_mobile/ (Flutter app), infrastructure/ (Docker)
- ABP Layer Structure: Domain, Application, EntityFrameworkCore, HttpApi, HttpApi.Host
- Angular Structure: app/ (components), layout/ (Poseidon theme components), assets/ (demo + layout)
- Package.json scripts for ABP workflow: dev, dev:mobile, generate-proxy, install-libs, migrate, test

**ABP CLI Commands for Project Setup:**
- Install ABP CLI: `dotnet tool install -g Volo.Abp.Cli`
- Create project: `abp new SmartRestaurant -t app --ui angular --mobile none --database-provider ef --database-management-system postgresql --connection-string "User ID=postgres;Password=postgres;Host=localhost;Port=5432;Database=SmartRestaurant;"`
- Generate Angular proxies: `cd angular && abp generate-proxy -t ng -u https://localhost:44346`
- Install frontend libraries: `cd angular && abp install-libs`
- Run database migrator: `cd aspnet-core && dotnet run --project src/SmartRestaurant.DbMigrator`

**Critical ABP Development Rules [Source: architecture/coding-standards.md]:**
- Always use ABP base classes for entities (FullAuditedEntity, etc.) - never create POCOs
- Use ABP proxy generation for frontend types - never manually create TypeScript interfaces
- Always use auto-generated ABP service proxies - never make direct HTTP calls
- Implement IApplicationService for auto-API generation - never create manual controllers
- Use ABP localization system for Vietnamese text - never hardcode Vietnamese strings

**Database Configuration Requirements:**
- PostgreSQL with Vietnamese collation for proper text sorting and search
- Entity Framework Core Code-First with ABP conventions
- Connection string configuration in appsettings.json for development and production
- Vietnamese text search indexes for menu items and customer data

**Docker Deployment Architecture:**
- Development: docker-compose.dev.yml with local PostgreSQL
- Production: docker-compose.prod.yml optimized for VPS deployment
- Nginx reverse proxy for Angular frontend serving and API routing
- Automated SSL certificate management with Let's Encrypt for production

### Testing

**Test File Locations [Source: architecture/testing-strategy.md]:**
- Backend Tests: `test/SmartRestaurant.Domain.Tests/`, `test/SmartRestaurant.Application.Tests/`, `test/SmartRestaurant.HttpApi.Tests/`
- Frontend Tests: `angular/tests/unit/`, `angular/tests/integration/`, `angular/tests/e2e/`
- Test Framework: xUnit + Moq for .NET backend, Jasmine + Karma for Angular frontend

**Testing Requirements for This Story:**
- Backend: Verify ABP application services generate correctly and database connection works
- Frontend: Test ABP proxy generation and Angular service integration
- Integration: Verify full stack communication between Angular and ABP API
- E2E: Basic smoke test for application startup and initial page load

**Test Data Standards:**
- Use Vietnamese restaurant test data (menu items like "Phở Bò", "Cơm Tấm")
- Test Vietnamese currency formatting (₫) and date/time formats
- Verify PostgreSQL Vietnamese collation with proper sorting of diacritical marks

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-18 | 1.0 | Initial story creation from Epic 1.1 | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References
*No debug log references yet*

### Completion Notes List
- ✅ ABP Framework solution successfully created with SmartRestaurant project name
- ✅ PostgreSQL database configured with Vietnamese collation support
- ✅ Entity Framework Core migrations setup completed
- ✅ Database connection verified and working
- ✅ Docker development and production environments configured
- ✅ Docker containers with PostgreSQL Vietnamese collation support
- ✅ Nginx reverse proxy configured for production deployment
- ✅ Development environment documentation completed in CLAUDE.md
- ✅ Project structure documentation updated with actual ABP paths
- ✅ Root package.json with ABP workflow scripts created
- ✅ Comprehensive README.md with Vietnamese restaurant features
- ✅ CI/CD pipeline configured with multi-stage testing
- ✅ Production deployment workflow with VPS integration
- ✅ Security scanning and code quality checks implemented
- ✅ Architecture documentation updated with actual ABP project structure

### File List
**Infrastructure Files:**
- infrastructure/docker/docker-compose.dev.yml (Development environment)
- infrastructure/docker/docker-compose.prod.yml (Production environment)  
- infrastructure/docker/Dockerfile.api (Backend container)
- infrastructure/docker/Dockerfile.web (Frontend container with Nginx)
- infrastructure/docker/nginx.conf (Reverse proxy configuration)
- infrastructure/docker/init-scripts/01-vietnamese-collation.sql (DB setup)

**Documentation Files:**
- CLAUDE.md (Complete development guide with ABP commands and troubleshooting)
- README.md (Project overview with Vietnamese restaurant features)
- docs/architecture/unified-project-structure.md (Updated with actual ABP structure)
- docs/architecture.md (Updated with aspnet-core/ path structure)
- docs/architecture/high-level-architecture.md (Updated with complete project structure)
- package.json (Root scripts for ABP workflow)
- .env.example (Environment configuration template)

**CI/CD Files:**
- .github/workflows/ci.yaml (Comprehensive CI pipeline with multi-stage testing)
- .github/workflows/deploy.yaml (VPS deployment with staging and production)
- angular/package.json (Updated with CI test scripts)

## QA Results

### Review Date: 2025-08-18

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Excellent infrastructure foundation implementation.** This story establishes a production-ready development environment with comprehensive Docker packaging, CI/CD pipeline, and Vietnam-specific configurations. The implementation demonstrates strong attention to operational requirements and follows ABP Framework best practices.

**Key Strengths:**
- Complete Docker environment with multi-stage builds for development and production
- Comprehensive CI/CD pipeline with security scanning and multi-platform builds
- Vietnamese language support throughout the system: PostgreSQL, text search, formatting
- Detailed guidance documentation with ABP troubleshooting
- Enhanced security configuration: non-root users, health checks, SSL-ready setup

### Refactoring Performed

No code refactoring required - this is an infrastructure and configuration-focused story. All configurations follow best practices.

### Compliance Check

- **Coding Standards**: ✓ Not applicable for infrastructure story
- **Project Structure**: ✓ Correct ABP Framework structure implementation with aspnet-core/ directory
- **Testing Strategy**: ✓ CI pipeline includes comprehensive testing strategy with Vietnamese test data
- **All Acceptance Criteria Met**: ✓ All 5 acceptance criteria fully implemented and validated

### Requirements Traceability

**AC1 - ABP Framework Solution**: ✓ COVERED
- **Test**: Backend build validation in CI pipeline
- **Validation**: Successful .NET solution compilation with all ABP projects

**AC2 - PostgreSQL Vietnamese Collation**: ✓ COVERED
- **Test**: Database initialization with vi_VN.UTF-8 locale
- **Validation**: Vietnamese text search functions and collation verification

**AC3 - Docker Containerization**: ✓ COVERED
- **Test**: Docker build validation in CI pipeline
- **Validation**: Multi-stage builds for dev/prod environments

**AC4 - Development Documentation**: ✓ COVERED
- **Test**: Manual validation of CLAUDE.md completeness
- **Validation**: Comprehensive ABP commands and troubleshooting guide

**AC5 - CI/CD Pipeline**: ✓ COVERED
- **Test**: Pipeline execution with test database setup
- **Validation**: Multi-stage testing including security scans

### Security Review

**PASS** - Strong security posture established:
- Non-root Docker containers with proper user permissions
- Security scanning integrated in CI pipeline: Trivy
- Environment variable externalization for secrets
- Nginx security headers configured
- SSL/TLS ready configuration for production

**Security Enhancements Implemented:**
- Rate limiting in nginx configuration
- Security headers: HSTS, CSP, X-Frame-Options
- Container health checks for reliability
- Secrets management via environment variables

### Performance Considerations

**PASS** - Performance optimizations included:
- Multi-stage Docker builds for optimized image sizes
- Nginx caching and compression configured
- In-memory caching for session and performance optimization
- Database connection pooling via Entity Framework
- Vietnamese-specific optimizations: text search indexes

### Non-Functional Requirements Assessment

**Security**: ✓ PASS - Comprehensive security measures implemented
**Performance**: ✓ PASS - Caching, compression, and optimization configured
**Reliability**: ✓ PASS - Health checks, restart policies, and monitoring ready
**Maintainability**: ✓ PASS - Excellent documentation and troubleshooting guides
**Scalability**: ✓ PASS - Container architecture allows horizontal scaling

### Files Modified During Review

None - infrastructure and documentation are correctly implemented.

### Improvements Checklist

All items handled successfully:

- [x] Docker multi-environment configuration: dev/prod separation
- [x] Vietnamese collation and text search setup
- [x] Security hardening: non-root containers, headers, SSL ready
- [x] Comprehensive CI/CD with security scanning
- [x] Complete documentation with ABP-specific guidance
- [x] Production-ready nginx configuration with caching
- [x] Environment variable management for secrets
- [x] Multi-platform container builds
- [x] Health checks and monitoring readiness

### Technical Debt Assessment

**Minimal technical debt identified:**
- SSL certificates need manual configuration for production - documented in deployment guide
- Monitoring/observability could be enhanced - planned for future stories
- Container resource limits could be fine-tuned based on actual usage

### Gate Status

Gate: PASS → docs/qa/gates/1.1-project-structure-dev-environment-setup.yml

### Recommended Status

✓ **Ready for Done** - All acceptance criteria met, comprehensive infrastructure foundation established with production-grade configurations.

---
