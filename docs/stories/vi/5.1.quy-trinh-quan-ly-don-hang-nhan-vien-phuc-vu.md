# User Story 5.1: Quy trÃ¬nh Quáº£n lÃ½ ÄÆ¡n hÃ ng cá»§a NhÃ¢n viÃªn Phá»¥c vá»¥

**Epic**: Epic 5 - Xá»­ lÃ½ ÄÆ¡n hÃ ng & Phá»‘i há»£p Báº¿p  
**Äiá»ƒm Story**: 35-50 (Level 2 - Máº«u Logic Kinh doanh)  
**Æ¯u tiÃªn**: Cao  
**Tráº¡ng thÃ¡i**: HoÃ n thÃ nh
**NgÆ°á»i phá»¥ trÃ¡ch**: NhÃ³m PhÃ¡t triá»ƒn  
**Sprint**: TBD

## SiÃªu dá»¯ liá»‡u Máº«u

### Cáº¥p Ä‘á»™ Máº«u
**Cáº¥p Ä‘á»™ Ä‘Æ°á»£c chá»n**: Level 2 (Máº«u Logic Kinh doanh)

### PhÃ¢n tÃ­ch Äá»™ phá»©c táº¡p
- **Äá»™ phá»©c táº¡p Thá»±c thá»ƒ**: Business - Order entity vá»›i tráº¡ng thÃ¡i lifecycle phá»©c táº¡p (Chá» â†’ XÃ¡c nháº­n â†’ Äang chuáº©n bá»‹ â†’ Sáºµn sÃ ng â†’ ÄÃ£ phá»¥c vá»¥ â†’ ÄÃ£ thanh toÃ¡n), phá»‘i há»£p báº¿p, vÃ  cáº­p nháº­t thá»i gian thá»±c
- **Äá»™ phá»©c táº¡p Giao diá»‡n**: Workflow - Quy trÃ¬nh nhiá»u bÆ°á»›c tá»« chá»n bÃ n â†’ duyá»‡t menu â†’ xÃ¡c nháº­n Ä‘Æ¡n hÃ ng â†’ phá»‘i há»£p báº¿p â†’ hoÃ n thÃ nh phá»¥c vá»¥ vá»›i theo dÃµi tráº¡ng thÃ¡i
- **YÃªu cáº§u Ká»¹ thuáº­t**: Business - Cáº§n custom application services, cáº­p nháº­t tráº¡ng thÃ¡i thá»i gian thá»±c qua SignalR, tÃ­ch há»£p báº¿p, vÃ  chá»©c nÄƒng in áº¥n

### Æ¯á»›c tÃ­nh Äiá»ƒm Story
**Pháº¡m vi**: 35-50 Ä‘iá»ƒm (dá»±a trÃªn Ä‘á»™ phá»©c táº¡p máº«u Level 2)

### Tham kháº£o Máº«u
- **Máº«u Backend**: templates/backend-template-level2.md
- **Máº«u Frontend**: templates/frontend-template-level2.md  
- **Máº«u Task**: .bmad-core/templates/level2-tasks.yaml

## Dependencies Story

**Äiá»u kiá»‡n tiÃªn quyáº¿t**:
- âœ… **Epic 4.3 - Há»‡ thá»‘ng NguyÃªn liá»‡u Äa Ä‘Æ¡n vá»‹**: Báº®T BUá»˜C - Há»‡ thá»‘ng quáº£n lÃ½ nguyÃªn liá»‡u vá»›i chuyá»ƒn Ä‘á»•i Ä‘Æ¡n vá»‹ cÆ¡ sá»Ÿ pháº£i hoÃ n thÃ nh
- âœ… **Story 3.x - Quáº£n lÃ½ BÃ n**: Báº®T BUá»˜C - Entity Table vÃ  quáº£n lÃ½ tráº¡ng thÃ¡i pháº£i tá»“n táº¡i
- âš ï¸ **Story 4.1 - Quáº£n lÃ½ MÃ³n Äƒn**: Báº®T BUá»˜C - Entity MenuItem vá»›i liÃªn káº¿t PrimaryIngredientId Ä‘Ã£ thiáº¿t láº­p

**Äiá»ƒm tÃ­ch há»£p tÆ°Æ¡ng lai**:
- ğŸ”„ **Epic 8 - Xá»­ lÃ½ Thanh toÃ¡n**: TÃ­ch há»£p nÃºt thanh toÃ¡n sáºµn sÃ ng cho triá»ƒn khai tÆ°Æ¡ng lai

## MÃ´ táº£ Story

**Vá»›i vai trÃ²** nhÃ¢n viÃªn phá»¥c vá»¥,  
**TÃ´i muá»‘n** hoÃ n thÃ nh toÃ n bá»™ quy trÃ¬nh gá»i mÃ³n tá»« chá»n bÃ n Ä‘áº¿n xÃ¡c nháº­n Ä‘Æ¡n hÃ ng vÃ  phá»‘i há»£p vá»›i báº¿p,  
**Äá»ƒ** tÃ´i cÃ³ thá»ƒ phá»¥c vá»¥ khÃ¡ch hÃ ng hiá»‡u quáº£ thÃ´ng qua quy trÃ¬nh mÆ°á»£t mÃ : xem tráº¡ng thÃ¡i bÃ n â†’ chá»n bÃ n khÃ¡ch â†’ duyá»‡t menu â†’ gá»i mÃ³n â†’ xÃ¡c nháº­n Ä‘Æ¡n â†’ phá»‘i há»£p báº¿p â†’ phá»¥c vá»¥ khÃ¡ch â†’ xÃ¡c nháº­n hoÃ n thÃ nh.

## TiÃªu chÃ­ Cháº¥p nháº­n

1. **Tráº¡ng thÃ¡i & Chá»n BÃ n**: Hiá»ƒn thá»‹ tráº¡ng thÃ¡i bÃ n thá»i gian thá»±c (Trá»‘ng, CÃ³ khÃ¡ch, ÄÃ£ Ä‘áº·t, Äang dá»n) vá»›i cÃ¡c chá»‰ bÃ¡o mÃ£ mÃ u vÃ  giao diá»‡n chá»n bÃ n thÃ¢n thiá»‡n cáº£m á»©ng

2. **Duyá»‡t Menu & TÃ¬m kiáº¿m**: Hiá»ƒn thá»‹ menu responsive vá»›i tÃ¬m kiáº¿m tiáº¿ng Viá»‡t, tá»± Ä‘á»™ng hoÃ n thÃ nh, lá»c danh má»¥c vÃ  tráº¡ng thÃ¡i cÃ³ sáºµn thá»i gian thá»±c

3. **Chá»n MÃ³n & TÃ¹y chá»‰nh**: Chá»n mÃ³n vá»›i Ä‘iá»u chá»‰nh sá»‘ lÆ°á»£ng, ghi chÃº riÃªng hoáº·c chung, vÃ  hiá»ƒn thá»‹ tÃ³m táº¯t Ä‘Æ¡n hÃ ng vá»›i thÃ´ng tin bÃ n

4. **XÃ¡c nháº­n ÄÆ¡n hÃ ng & TÃ­ch há»£p Báº¿p**: XÃ¡c nháº­n Ä‘Æ¡n hÃ ng vá»›i in tá»± Ä‘á»™ng cho tráº¡m báº¿p phÃ¹ há»£p vÃ  theo dÃµi tráº¡ng thÃ¡i thá»i gian thá»±c (ÄÃ£ xÃ¡c nháº­n, Äang chuáº©n bá»‹, Sáºµn sÃ ng, ÄÃ£ phá»¥c vá»¥)

5. **Chá»©c nÄƒng In thá»§ cÃ´ng**: NÃºt in thá»§ cÃ´ng Ä‘á»ƒ chá»n cÃ¡c mÃ³n cá»¥ thá»ƒ vÃ  in láº¡i bill báº¿p cho Ä‘Æ¡n hÃ ng khi cáº§n thiáº¿t

6. **Quy trÃ¬nh HoÃ n thÃ nh Phá»¥c vá»¥**: Giao diá»‡n xÃ¡c nháº­n hoÃ n thÃ nh phá»¥c vá»¥ vá»›i tÃ­ch há»£p cáº­p nháº­t tráº¡ng thÃ¡i bÃ n vÃ  theo dÃµi lá»‹ch sá»­ Ä‘Æ¡n hÃ ng

7. **TÃ­ch há»£p NÃºt Thanh toÃ¡n**: NÃºt xá»­ lÃ½ thanh toÃ¡n Ä‘áº·t cáº¡nh cÃ¡c nÃºt in vÃ  thao tÃ¡c phá»¥c vá»¥ Ä‘á»ƒ tÃ­ch há»£p quy trÃ¬nh thanh toÃ¡n mÆ°á»£t mÃ  vá»›i Epic 8

## Nhiá»‡m vá»¥ / Nhiá»‡m vá»¥ con

### Nhiá»‡m vá»¥ Backend

- [x] **BE-1**: Thiáº¿t káº¿ MÃ´ hÃ¬nh Domain Order vá»›i Logic Kinh doanh (AC: 1, 4, 6)
  - [x] Äá»‹nh nghÄ©a entity Order vá»›i enum OrderStatus (Active, Paid) 
  - [x] Táº¡o entity OrderItem vÃ  cáº¥u hÃ¬nh má»‘i quan há»‡ vá»›i MenuItem
  - [x] ThÃªm validation quy táº¯c kinh doanh cho chuyá»ƒn Ä‘á»•i tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng vÃ  tÃ¬nh tráº¡ng bÃ n
  - [x] Triá»ƒn khai domain events cho thay Ä‘á»•i tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng vÃ  thÃ´ng bÃ¡o báº¿p
  - [x] ThÃªm trÆ°á»ng audit vÃ  Ä‘áº£m báº£o káº¿ thá»«a ABP FullAuditedAggregateRoot phÃ¹ há»£p

- [x] **BE-2**: Táº¡o Order Domain Service (AC: 4, 5, 6)
  - [x] Triá»ƒn khai OrderManager vá»›i phÆ°Æ¡ng thá»©c validation table availability
  - [x] ThÃªm logic validation chuyá»ƒn Ä‘á»•i tráº¡ng thÃ¡i vÃ  business rules
  - [x] Táº¡o phÆ°Æ¡ng thá»©c tÃ­nh giÃ¡ Ä‘Æ¡n hÃ ng vÃ  recipe management
  - [x] Triá»ƒn khai cÃ¡c phÆ°Æ¡ng thá»©c NotifyKitchenAsync vÃ  PrintKitchenBillAsync
  - [x] **ThÃªm phÆ°Æ¡ng thá»©c ProcessInventoryDeductionAsync cho tá»± Ä‘á»™ng trá»« kho khi Ä‘Æ¡n hÃ ng Ä‘Æ°á»£c xÃ¡c nháº­n**
  - [x] ThÃªm thá»±c thi quy táº¯c kinh doanh cho quy trÃ¬nh hoÃ n thÃ nh phá»¥c vá»¥

- [x] **BE-3**: Triá»ƒn khai Order Application Service (AC: 1, 2, 3, 4, 5, 6, 7)
  - [x] Táº¡o OrderAppService sá»­ dá»¥ng IApplicationService (khÃ´ng pháº£i ICrudAppService)
  - [x] Triá»ƒn khai CreateOrderAsync vá»›i validation bÃ n vÃ  kiá»ƒm tra mÃ³n Äƒn
  - [x] **ThÃªm validation tá»“n kho trong CreateOrderAsync**
  - [x] ThÃªm phÆ°Æ¡ng thá»©c UpdateOrderStatusAsync vá»›i phÃ¢n quyá»n phÃ¹ há»£p
  - [x] **TÃ­ch há»£p tá»± Ä‘á»™ng trá»« kho khi tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng chuyá»ƒn thÃ nh Confirmed**
  - [x] Táº¡o cÃ¡c phÆ°Æ¡ng thá»©c chuyÃªn biá»‡t GetTableDetails vÃ  GetMenuItemsForOrder
  - [x] ThÃªm chá»©c nÄƒng PrintKitchenBillAsync vÃ  ReprintBillAsync
  - [x] Triá»ƒn khai CompleteOrderServiceAsync vá»›i Ä‘áº·t láº¡i tráº¡ng thÃ¡i bÃ n
  - [x] ThÃªm quáº£n lÃ½ transaction vÃ  xá»­ lÃ½ lá»—i toÃ n diá»‡n

- [x] **BE-4**: ThÃªm Cáº¥u hÃ¬nh Database vÃ  Hiá»‡u suáº¥t (AC: 1, 4)
  - [x] Cáº¥u hÃ¬nh má»‘i quan há»‡ Order, OrderItem, Table trong SmartRestaurantDbContext
  - [x] ThÃªm migration database cho cÃ¡c entity Order vÃ  OrderItem
  - [x] Cáº¥u hÃ¬nh cÃ¡c index hiá»‡u suáº¥t: Orders(TableId), Orders(Status), OrderItems(OrderId)
  - [x] ThÃªm cÃ¡c rÃ ng buá»™c database cho quy táº¯c kinh doanh (chuyá»ƒn Ä‘á»•i tráº¡ng thÃ¡i há»£p lá»‡)

- [x] **BE-5**: Táº¡o SignalR Hubs cho Cáº­p nháº­t Thá»i gian thá»±c (AC: 4, 6)
  - [x] Triá»ƒn khai KitchenHub cho cáº­p nháº­t Ä‘Æ¡n hÃ ng báº¿p thá»i gian thá»±c
  - [x] Táº¡o TableManagementHub cho phÃ¡t sÃ³ng tráº¡ng thÃ¡i bÃ n
  - [x] ThÃªm OrderStatusHub cho thÃ´ng bÃ¡o nhÃ¢n viÃªn
  - [x] Cáº¥u hÃ¬nh phÃ¢n quyá»n hub vá»›i cÃ¡c vai trÃ² nhÃ  hÃ ng phÃ¹ há»£p
  - [x] ThÃªm quáº£n lÃ½ káº¿t ná»‘i vÃ  xá»­ lÃ½ lá»—i

- [x] **BE-6**: Triá»ƒn khai Kiá»ƒm thá»­ Logic Kinh doanh (AC: Táº¥t cáº£)
  - [x] Viáº¿t cÃ¡c unit test OrderManager cho táº¥t cáº£ quy táº¯c kinh doanh
  - [x] Kiá»ƒm thá»­ chuyá»ƒn Ä‘á»•i tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng vÃ  logic validation
  - [x] **Kiá»ƒm thá»­ cÃ¡c ká»‹ch báº£n tá»± Ä‘á»™ng trá»« kho vÃ  validation tá»“n kho**
  - [x] Táº¡o cÃ¡c integration test cho quy trÃ¬nh Ä‘Æ¡n hÃ ng hoÃ n chá»‰nh
  - [x] Kiá»ƒm thá»­ tÃ­ch há»£p báº¿p vÃ  chá»©c nÄƒng in áº¥n
  - [x] ThÃªm cÃ¡c test hiá»‡u suáº¥t cho cáº­p nháº­t thá»i gian thá»±c

- [x] **BE-7**: Táº¡o Entity MenuItemIngredient vÃ  Há»‡ thá»‘ng Recipe (AC: 2, 4)
  - [x] Táº¡o entity MenuItemIngredient vá»›i má»‘i quan há»‡ nhiá»u-nhiá»u
  - [x] ThÃªm cÃ¡c thuá»™c tÃ­nh MenuItemIngredient: MenuItemId, IngredientId, RequiredQuantity
  - [x] Cáº­p nháº­t entity MenuItem vá»›i thuá»™c tÃ­nh Ä‘iá»u hÆ°á»›ng Ingredients
  - [x] Cáº¥u hÃ¬nh má»‘i quan há»‡ Entity Framework cho MenuItemIngredient
  - [x] Táº¡o migration database cho báº£ng MenuItemIngredients

- [x] **BE-8**: Triá»ƒn khai RecipeManager Domain Service (AC: 2, 4)
  - [x] Táº¡o RecipeManager vá»›i phÆ°Æ¡ng thá»©c CheckIngredientAvailabilityAsync
  - [x] Triá»ƒn khai CalculateRequiredIngredientsAsync cho cÃ¡c items Ä‘Æ¡n hÃ ng
  - [x] ThÃªm ProcessAutomaticDeductionAsync vá»›i há»— trá»£ kho Ã¢m
  - [x] Táº¡o GetMissingIngredientsAsync cho hiá»ƒn thá»‹ cáº£nh bÃ¡o
  - [x] ThÃªm logic kinh doanh cho nguyÃªn liá»‡u tÃ¹y chá»n vÃ  báº¯t buá»™c

- [x] **BE-9**: Cáº­p nháº­t Há»‡ thá»‘ng Kho cho Kho Ã¢m (AC: 2, 4)
  - [x] Loáº¡i bá» rÃ ng buá»™c kho >= 0 tá»« entity Ingredient
  - [x] Cáº­p nháº­t IngredientAppService cho phÃ©p thao tÃ¡c kho Ã¢m
  - [x] ThÃªm cÃ¡c phÆ°Æ¡ng thá»©c tÃ­nh toÃ¡n nguyÃªn liá»‡u thiáº¿u
  - [x] Táº¡o migration dá»¯ liá»‡u Ä‘á»ƒ migrate tá»« PrimaryIngredientId sang MenuItemIngredients
  - [x] Cáº­p nháº­t logic hiá»ƒn thá»‹ kho Ä‘á»ƒ hiá»‡n giÃ¡ trá»‹ Ã¢m

### Nhiá»‡m vá»¥ Flutter Mobile

- [x] **FLUTTER-1**: Táº¡o MÃ n hÃ¬nh Quy trÃ¬nh ÄÆ¡n hÃ ng Nhiá»u bÆ°á»›c (AC: 1, 2, 3)
  - [x] Táº¡o cÃ¡c mÃ n hÃ¬nh quy trÃ¬nh order: table_detail_screen.dart, menu_screen.dart, order_screen.dart
  - [x] Triá»ƒn khai UI flow cho: Chá»n BÃ n â†’ Duyá»‡t Menu â†’ Xem láº¡i ÄÆ¡n hÃ ng â†’ XÃ¡c nháº­n
  - [x] Táº¡o logic Ä‘iá»u hÆ°á»›ng bÆ°á»›c vá»›i validation sá»­ dá»¥ng Flutter navigation
  - [x] ThÃªm chá»‰ bÃ¡o tiáº¿n trÃ¬nh vÃ  nhÃ£n tiáº¿ng Viá»‡t sá»­ dá»¥ng Flutter widgets
  - [x] Triá»ƒn khai validation hoÃ n thÃ nh bÆ°á»›c vÃ  thá»±c thi quy táº¯c kinh doanh

- [x] **FLUTTER-2**: XÃ¢y dá»±ng MÃ n hÃ¬nh Chá»n BÃ n ThÃ¢n thiá»‡n Cáº£m á»©ng (AC: 1)
  - [x] Táº¡o table selection UI vá»›i cÃ¡c chá»‰ bÃ¡o tráº¡ng thÃ¡i mÃ£ mÃ u
  - [x] Triá»ƒn khai bá»‘ cá»¥c lÆ°á»›i responsive cho bÃ n sá»­ dá»¥ng Flutter GridView
  - [x] ThÃªm cáº­p nháº­t tráº¡ng thÃ¡i bÃ n thá»i gian thá»±c qua API calls
  - [x] Táº¡o chÃº giáº£i tráº¡ng thÃ¡i bÃ n: Available (xanh lÃ¡), Occupied (Ä‘á»), Reserved (vÃ ng)
  - [x] ThÃªm chá»©c nÄƒng lá»c vÃ  tÃ¬m kiáº¿m bÃ n sá»­ dá»¥ng Flutter search widgets

- [x] **FLUTTER-3**: Triá»ƒn khai MÃ n hÃ¬nh Duyá»‡t Menu vÃ  TÃ¬m kiáº¿m (AC: 2, 3)
  - [x] Táº¡o menu_screen.dart vá»›i tab danh má»¥c vÃ  danh sÃ¡ch mÃ³n
  - [x] Triá»ƒn khai tÃ¬m kiáº¿m tiáº¿ng Viá»‡t vá»›i tá»± Ä‘á»™ng hoÃ n thÃ nh sá»­ dá»¥ng Flutter search
  - [x] ThÃªm lá»c danh má»¥c vá»›i chá»‰ bÃ¡o tráº¡ng thÃ¡i cÃ³ sáºµn
  - [x] Táº¡o chá»n mÃ³n vá»›i Ä‘iá»u khiá»ƒn Ä‘iá»u chá»‰nh sá»‘ lÆ°á»£ng sá»­ dá»¥ng Flutter widgets
  - [x] ThÃªm nháº­p ghi chÃº mÃ³n riÃªng vÃ  chung sá»­ dá»¥ng Flutter text fields

- [x] **FLUTTER-4**: ThÃªm MÃ n hÃ¬nh TÃ³m táº¯t vÃ  XÃ¡c nháº­n ÄÆ¡n hÃ ng (AC: 3, 4, 7)
  - [x] Táº¡o order_screen.dart vá»›i danh sÃ¡ch chi tiáº¿t vÃ  giÃ¡
  - [x] Triá»ƒn khai Ä‘iá»u khiá»ƒn sá»­a Ä‘á»•i Ä‘Æ¡n hÃ ng (thay Ä‘á»•i sá»‘ lÆ°á»£ng, xÃ³a mÃ³n)
  - [x] ThÃªm hiá»ƒn thá»‹ thÃ´ng tin bÃ n vÃ  ghi chÃº
  - [x] Táº¡o dialog xÃ¡c nháº­n vá»›i xem láº¡i Ä‘Æ¡n hÃ ng sá»­ dá»¥ng Flutter dialogs
  - [x] ThÃªm tÃ­ch há»£p QR code thanh toÃ¡n cho Epic 8

- [x] **FLUTTER-5**: XÃ¢y dá»±ng MÃ n hÃ¬nh Theo dÃµi Tráº¡ng thÃ¡i vÃ  TÃ­ch há»£p Báº¿p (AC: 4, 5, 6)
  - [x] Táº¡o order status tracking vá»›i badge tráº¡ng thÃ¡i tiáº¿ng Viá»‡t
  - [x] Triá»ƒn khai cáº­p nháº­t tráº¡ng thÃ¡i thá»i gian thá»±c qua API polling
  - [x] ThÃªm chá»©c nÄƒng in thá»§ cÃ´ng vá»›i giao diá»‡n chá»n mÃ³n
  - [x] Táº¡o giao diá»‡n hoÃ n thÃ nh dá»‹ch vá»¥ vá»›i Ä‘iá»u khiá»ƒn xÃ¡c nháº­n
  - [x] ThÃªm dÃ²ng thá»i gian lá»‹ch sá»­ tráº¡ng thÃ¡i sá»­ dá»¥ng Flutter timeline widgets

- [x] **FLUTTER-6**: Triá»ƒn khai TÃ­nh nÄƒng Mobile NÃ¢ng cao vÃ  Xá»­ lÃ½ Lá»—i (AC: Táº¥t cáº£)
  - [x] ThÃªm pháº§n tá»­ UI cÃ³ Ä‘iá»u kiá»‡n dá»±a trÃªn tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng vÃ  quy táº¯c kinh doanh
  - [x] Triá»ƒn khai thÃ´ng bÃ¡o validation tiáº¿ng Viá»‡t vÃ  xá»­ lÃ½ lá»—i
  - [x] Táº¡o quy trÃ¬nh xÃ¡c nháº­n cho thao tÃ¡c quan trá»ng sá»­ dá»¥ng Flutter alerts
  - [x] ThÃªm tráº¡ng thÃ¡i táº£i vÃ  chá»‰ bÃ¡o tiáº¿n trÃ¬nh sá»­ dá»¥ng Flutter progress widgets
  - [x] Triá»ƒn khai phÃ¡t hiá»‡n offline vÃ  thÃ´ng bÃ¡o sá»­ dá»¥ng Flutter connectivity
  - [x] **Xá»­ lÃ½ cÃ¡c tÃ¬nh huá»‘ng edge case: Timeout máº¡ng, máº¥t káº¿t ná»‘i WebSocket, tráº¡ng thÃ¡i bÃ n khÃ´ng há»£p lá»‡, lá»—i mÃ¡y in báº¿p**
  - [x] **ThÃªm quy trÃ¬nh phá»¥c há»“i lá»—i toÃ n diá»‡n: Tá»± Ä‘á»™ng thá»­ láº¡i Ä‘Æ¡n hÃ ng tháº¥t báº¡i, tiáº¿p tá»¥c workflow bá»‹ giÃ¡n Ä‘oáº¡n, Ä‘á»“ng bá»™ dá»¯ liá»‡u sau khi káº¿t ná»‘i láº¡i**
  - [x] **ThÃªm tÃ­nh nÄƒng accessibility: Há»— trá»£ Ä‘á»c mÃ n hÃ¬nh, cháº¿ Ä‘á»™ tÆ°Æ¡ng pháº£n cao, há»— trá»£ text lá»›n, kÃ­ch thÆ°á»›c má»¥c tiÃªu cáº£m á»©ng**

- [x] **FLUTTER-7**: ThÃªm Há»‡ thá»‘ng Cáº£nh bÃ¡o Thiáº¿u NguyÃªn liá»‡u (AC: 2, 4)
  - [x] Táº¡o popup cáº£nh bÃ¡o thiáº¿u nguyÃªn liá»‡u vá»›i thÃ´ng bÃ¡o tiáº¿ng Viá»‡t
  - [x] Hiá»ƒn thá»‹ nguyÃªn liá»‡u thiáº¿u cá»¥ thá»ƒ cho tá»«ng mÃ³n: "Phá»Ÿ BÃ²: thiáº¿u Thá»‹t bÃ² (cáº§n 200g)"
  - [x] ThÃªm dialog xÃ¡c nháº­n: "Äáº·t mÃ³n vÃ  cáº§n mua thÃªm nguyÃªn liá»‡u"
  - [x] Triá»ƒn khai mÃ n hÃ¬nh danh sÃ¡ch nguyÃªn liá»‡u thiáº¿u thá»i gian thá»±c
  - [x] Hiá»ƒn thá»‹ giÃ¡ trá»‹ kho Ã¢m vá»›i chá»‰ bÃ¡o rÃµ rÃ ng: "Thá»‹t bÃ²: -500g"

### Nhiá»‡m vá»¥ Kiá»ƒm thá»­

- [ ] **TEST-1**: Kiá»ƒm thá»­ TÃ­ch há»£p Logic Kinh doanh (AC: Táº¥t cáº£)
  - [ ] Kiá»ƒm thá»­ quy trÃ¬nh Ä‘Æ¡n hÃ ng hoÃ n chá»‰nh tá»« Ä‘áº§u Ä‘áº¿n cuá»‘i tá»« chá»n bÃ n Ä‘áº¿n thanh toÃ¡n
  - [ ] XÃ¡c minh thá»±c thi quy táº¯c kinh doanh qua cÃ¡c lá»›p UI vÃ  API
  - [ ] Kiá»ƒm thá»­ cÃ¡c tÃ¬nh huá»‘ng lá»—i vÃ  tháº¥t báº¡i validation kinh doanh
  - [ ] Táº¡o cÃ¡c ká»‹ch báº£n dá»¯ liá»‡u kiá»ƒm thá»­ cho cÃ¡c loáº¡i Ä‘Æ¡n hÃ ng khÃ¡c nhau (Äƒn táº¡i chá»—, mang vá»)

- [ ] **TEST-2**: Kiá»ƒm thá»­ Flutter Mobile (AC: 1, 2, 3, 4, 5, 6)
  - [ ] Kiá»ƒm thá»­ Ä‘iá»u hÆ°á»›ng quy trÃ¬nh nhiá»u bÆ°á»›c vÃ  quy táº¯c validation sá»­ dá»¥ng Flutter test framework
  - [ ] XÃ¡c minh chá»©c nÄƒng tÃ¬m kiáº¿m tiáº¿ng Viá»‡t vÃ  tá»± Ä‘á»™ng hoÃ n thÃ nh trÃªn thiáº¿t bá»‹ di Ä‘á»™ng
  - [ ] Kiá»ƒm thá»­ cáº­p nháº­t tráº¡ng thÃ¡i thá»i gian thá»±c vÃ  xá»­ lÃ½ káº¿t ná»‘i WebSocket
  - [ ] Táº¡o widget test cho táº¥t cáº£ mÃ n hÃ¬nh vÃ  component Flutter
  - [ ] Kiá»ƒm thá»­ giao diá»‡n cáº£m á»©ng vÃ  xá»­ lÃ½ cá»­ chá»‰ trÃªn cÃ¡c kÃ­ch thÆ°á»›c mÃ n hÃ¬nh khÃ¡c nhau

- [ ] **TEST-3**: Kiá»ƒm thá»­ TÃ­ch há»£p Thá»i gian thá»±c (AC: 4, 6)
  - [ ] Kiá»ƒm thá»­ káº¿t ná»‘i SignalR hub vÃ  phÃ¡t sÃ³ng thÃ´ng Ä‘iá»‡p
  - [ ] XÃ¡c minh phÃ¢n phá»‘i thÃ´ng bÃ¡o báº¿p vÃ  cáº­p nháº­t tráº¡ng thÃ¡i
  - [ ] Kiá»ƒm thá»­ cÃ¡c ká»‹ch báº£n ngÆ°á»i dÃ¹ng Ä‘á»“ng thá»i vá»›i nhiá»u Ä‘Æ¡n hÃ ng
  - [ ] Táº¡o cÃ¡c stress test cho yÃªu cáº§u hiá»‡u suáº¥t thá»i gian thá»±c

- [ ] **TEST-4**: Kiá»ƒm thá»­ Quáº£n lÃ½ Recipe vÃ  Kho Ã¢m (AC: 2, 4)
  - [ ] Kiá»ƒm thá»­ má»‘i quan há»‡ MenuItemIngredient vÃ  tÃ­nh toÃ¡n recipe
  - [ ] XÃ¡c minh cÃ¡c ká»‹ch báº£n kho Ã¢m vá»›i trá»« kho tá»± Ä‘á»™ng
  - [ ] Kiá»ƒm thá»­ há»‡ thá»‘ng cáº£nh bÃ¡o thiáº¿u nguyÃªn liá»‡u
  - [ ] Táº¡o cÃ¡c integration test cho quy trÃ¬nh recipe hoÃ n chá»‰nh
  - [ ] Kiá»ƒm thá»­ logic kinh doanh nguyÃªn liá»‡u tÃ¹y chá»n vs báº¯t buá»™c

## Ghi chÃº PhÃ¡t triá»ƒn

### HÆ°á»›ng dáº«n Cá»¥ thá»ƒ cho Máº«u (Level 2 - Logic Kinh doanh)

**Máº«u Triá»ƒn khai**:
- Sá»­ dá»¥ng IApplicationService cá»§a ABP thay vÃ¬ ICrudAppService Ä‘á»ƒ há»— trá»£ logic kinh doanh phá»©c táº¡p
- Triá»ƒn khai Domain Services cho validation Ä‘Æ¡n hÃ ng, chuyá»ƒn Ä‘á»•i tráº¡ng thÃ¡i, vÃ  phá»‘i há»£p báº¿p
- Sá»­ dá»¥ng SignalR hubs cho cáº­p nháº­t tráº¡ng thÃ¡i thá»i gian thá»±c giá»¯a nhÃ¢n viÃªn phá»¥c vá»¥ vÃ  mÃ n hÃ¬nh báº¿p
- Ãp dá»¥ng máº«u domain events cá»§a ABP cho thay Ä‘á»•i tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng vÃ  thÃ´ng bÃ¡o

**Dependencies Báº¯t buá»™c**:
- ABP Framework 8.0 vá»›i há»— trá»£ authorization, localization, vÃ  in-memory caching tÃ­ch há»£p
- SignalR cho giao tiáº¿p thá»i gian thá»±c giá»¯a mobile app vÃ  há»‡ thá»‘ng báº¿p
- Entity Framework Core cho cÃ¡c thao tÃ¡c database vá»›i há»— trá»£ Vietnamese collation
- Flutter 3.35.1+ vá»›i há»— trá»£ WebSocket cho cáº­p nháº­t thá»i gian thá»±c
- Dart HTTP client cho giao tiáº¿p API vá»›i ABP backend
- ABP Memory Cache cho cache dá»¯ liá»‡u menu vÃ  recipe
- **web_socket_channel**: ^2.4.0 package cho káº¿t ná»‘i WebSocket Flutter
- **provider**: ^6.1.1 cho quáº£n lÃ½ state Flutter

**Biáº¿n MÃ´i trÆ°á»ng Báº¯t buá»™c**:
```bash
# Cáº¥u hÃ¬nh Backend API
APP_CORS_ORIGINS=http://localhost:3000,https://localhost:3001
ABP_LICENSE_CODE=your-abp-license-code
DEFAULT_CONNECTION_STRING=Host=localhost;Database=SmartRestaurant;Username=postgres;Password=postgres

# Cáº¥u hÃ¬nh SignalR
SIGNALR_CORS_ORIGINS=http://localhost:3000,https://localhost:3001
SIGNALR_HUB_TIMEOUT=30000

# Cáº¥u hÃ¬nh Flutter Mobile
API_BASE_URL=https://localhost:44346
WEBSOCKET_URL=wss://localhost:44346/hubs
APP_ENV=development
API_TIMEOUT_SECONDS=30

# TÃ­ch há»£p Báº¿p
KITCHEN_PRINTER_IP=192.168.1.100
KITCHEN_PRINTER_PORT=9100
PRINT_TIMEOUT_SECONDS=10

# Cáº¥u hÃ¬nh Cache
MEMORY_CACHE_SIZE_MB=256
MENU_CACHE_EXPIRATION_MINUTES=60
RECIPE_CACHE_EXPIRATION_MINUTES=120
```

**Cáº¥u trÃºc File vÃ  Quy táº¯c Äáº·t tÃªn**:
```
Backend:
- aspnet-core/src/SmartRestaurant.Domain/Orders/ (entities vÃ  domain services)
- aspnet-core/src/SmartRestaurant.Application/Orders/ (application services vÃ  DTOs)
- aspnet-core/src/SmartRestaurant.HttpApi/Hubs/ (SignalR hubs)

Flutter Mobile:
- flutter_mobile/lib/features/orders/ (tÃ­nh nÄƒng quáº£n lÃ½ Ä‘Æ¡n hÃ ng)
- flutter_mobile/lib/features/orders/screens/ (mÃ n hÃ¬nh workflow Ä‘Æ¡n hÃ ng)
- flutter_mobile/lib/features/orders/widgets/ (widgets Ä‘Æ¡n hÃ ng cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng)
- flutter_mobile/lib/features/orders/services/ (dá»‹ch vá»¥ API client)
- flutter_mobile/lib/shared/models/ (mÃ´ hÃ¬nh dá»¯ liá»‡u Ä‘Æ¡n hÃ ng)
```

### Ngá»¯ cáº£nh Story TrÆ°á»›c Ä‘Ã³
Tá»« Epic 4 hoÃ n thÃ nh - Há»‡ thá»‘ng nguyÃªn liá»‡u Ä‘a Ä‘Æ¡n vá»‹ Ä‘Ã£ thiáº¿t láº­p ná»n táº£ng cho:
- Theo dÃµi tÃ¬nh tráº¡ng cÃ³ sáºµn cá»§a mÃ³n Äƒn dá»±a trÃªn má»©c tá»“n kho nguyÃªn liá»‡u
- TÃ­ch há»£p tÃ­nh toÃ¡n chi phÃ­ cho Ä‘á»‹nh giÃ¡ Ä‘Æ¡n hÃ ng chÃ­nh xÃ¡c
- Tá»‘i Æ°u hÃ³a quy trÃ¬nh báº¿p dá»±a trÃªn yÃªu cáº§u chuáº©n bá»‹ nguyÃªn liá»‡u
- **Há»‡ thá»‘ng Ä‘Æ¡n vá»‹ mua hÃ ng Ä‘a cáº¥p vÃ  chuyá»ƒn Ä‘á»•i Ä‘Æ¡n vá»‹ cÆ¡ sá»Ÿ Ä‘Ã£ sáºµn sÃ ng cho viá»‡c trá»« kho**
- **LiÃªn káº¿t MenuItem-Ingredient cÆ¡ báº£n Ä‘Ã£ cÃ³ nhÆ°ng cáº§n nÃ¢ng cáº¥p thÃ nh MenuItemIngredient nhiá»u-nhiá»u**

### Chiáº¿n lÆ°á»£c Di chuyá»ƒn
**Tá»« MenuItem.PrimaryIngredientId sang Há»‡ thá»‘ng MenuItemIngredient**:
1. **Giai Ä‘oáº¡n 1**: Táº¡o báº£ng MenuItemIngredient vá»›i migration script
2. **Giai Ä‘oáº¡n 2**: Di chuyá»ƒn dá»¯ liá»‡u PrimaryIngredientId hiá»‡n cÃ³ sang records MenuItemIngredient
3. **Giai Ä‘oáº¡n 3**: Cáº­p nháº­t logic á»©ng dá»¥ng Ä‘á»ƒ sá»­ dá»¥ng má»‘i quan há»‡ nhiá»u-nhiá»u má»›i
4. **Giai Ä‘oáº¡n 4**: ÄÃ¡nh dáº¥u PrimaryIngredientId lÃ  Obsolete vá»›i kháº£ nÄƒng tÆ°Æ¡ng thÃ­ch ngÆ°á»£c
5. **Giai Ä‘oáº¡n 5**: Loáº¡i bá» PrimaryIngredientId trong phiÃªn báº£n tÆ°Æ¡ng lai (sau khi hoÃ n thÃ nh story)

**Máº«u Migration Script**:
```sql
-- Táº¡o records MenuItemIngredient tá»« PrimaryIngredientId hiá»‡n cÃ³
INSERT INTO MenuItemIngredients (Id, MenuItemId, IngredientId, RequiredQuantity, IsOptional, CreationTime)
SELECT 
    gen_random_uuid(),
    mi.Id,
    mi.PrimaryIngredientId,
    COALESCE(mi.RequiredQuantity, 1),
    false,
    NOW()
FROM MenuItems mi 
WHERE mi.PrimaryIngredientId IS NOT NULL;
```

### MÃ´ hÃ¬nh Dá»¯ liá»‡u vÃ  Má»‘i quan há»‡

**Order Entity** (Ä‘á»™ phá»©c táº¡p Level 2):
```csharp
public class Order : FullAuditedAggregateRoot<Guid>
{
    public string OrderNumber { get; set; }         // Sá»‘ hiá»ƒn thá»‹ (vÃ­ dá»¥: #001)
    public Guid TableId { get; set; }               // Tham chiáº¿u bÃ n
    public OrderType OrderType { get; set; }        // Ä‚n táº¡i chá»—/Mang vá»
    public OrderStatus Status { get; set; }         // Workflow tráº¡ng thÃ¡i
    public decimal TotalAmount { get; set; }        // GiÃ¡ VND
    public string Notes { get; set; }               // YÃªu cáº§u khÃ¡ch hÃ ng
    // Navigation: Table, collection OrderItems
}

public enum OrderStatus 
{
    Pending, Confirmed, Preparing, Ready, Served, Paid
}
```

**MenuItemIngredient Entity** (Má»›i cho Quáº£n lÃ½ Recipe):
```csharp
public class MenuItemIngredient : Entity<Guid>
{
    public Guid MenuItemId { get; set; }           // Tham chiáº¿u MenuItem
    public Guid IngredientId { get; set; }         // Tham chiáº¿u Ingredient
    public int RequiredQuantity { get; set; }      // Sá»‘ lÆ°á»£ng theo Ä‘Æ¡n vá»‹ cÆ¡ sá»Ÿ (vÃ­ dá»¥: 200g)
    public bool IsOptional { get; set; } = false;  // Cá» nguyÃªn liá»‡u tÃ¹y chá»n
    
    // Navigation properties
    public virtual MenuItem MenuItem { get; set; }
    public virtual Ingredient Ingredient { get; set; }
}
```

**MenuItem Entity NÃ¢ng cáº¥p** (Cáº­p nháº­t cho Recipe Support):
```csharp
public class MenuItem : FullAuditedEntity<Guid>
{
    // ... cÃ¡c thuá»™c tÃ­nh hiá»‡n cÃ³ ...
    
    // Má»‘i quan há»‡ nÃ¢ng cáº¥p
    public virtual ICollection<MenuItemIngredient> Ingredients { get; set; } // Nhiá»u-nhiá»u qua bridge
    public virtual ICollection<OrderItem> OrderItems { get; set; }
    
    // Deprecated nhÆ°ng duy trÃ¬ Ä‘á»ƒ tÆ°Æ¡ng thÃ­ch ngÆ°á»£c
    [Obsolete("Sá»­ dá»¥ng collection Ingredients thay tháº¿")]
    public Guid? PrimaryIngredientId { get; set; }
    [Obsolete("Sá»­ dá»¥ng collection Ingredients thay tháº¿")]
    public int? RequiredQuantity { get; set; }
}
```

**TÃ­ch há»£p SignalR**:
[Nguá»“n: docs/architecture/core-workflows.md#Order-Processing-Workflow]
- KitchenHub phÃ¡t sÃ³ng Ä‘Æ¡n hÃ ng má»›i vÃ  thay Ä‘á»•i tráº¡ng thÃ¡i
- TableManagementHub quáº£n lÃ½ cáº­p nháº­t tráº¡ng thÃ¡i bÃ n thá»i gian thá»±c
- OrderStatusHub gá»­i thÃ´ng bÃ¡o cho nhÃ¢n viÃªn phá»¥c vá»¥ vá» tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng sáºµn sÃ ng

### YÃªu cáº§u Logic Kinh doanh

**Quy táº¯c Chuyá»ƒn Ä‘á»•i Tráº¡ng thÃ¡i** [Nguá»“n: docs/architecture/data-models.md#Order]:
- Chá» â†’ XÃ¡c nháº­n (hÃ nh Ä‘á»™ng nhÃ¢n viÃªn phá»¥c vá»¥)
- XÃ¡c nháº­n â†’ Äang chuáº©n bá»‹ (hÃ nh Ä‘á»™ng báº¿p)
- Äang chuáº©n bá»‹ â†’ Sáºµn sÃ ng (hÃ nh Ä‘á»™ng báº¿p)
- Sáºµn sÃ ng â†’ ÄÃ£ phá»¥c vá»¥ (xÃ¡c nháº­n nhÃ¢n viÃªn phá»¥c vá»¥)
- ÄÃ£ phá»¥c vá»¥ â†’ ÄÃ£ thanh toÃ¡n (hoÃ n thÃ nh thanh toÃ¡n)

**TÃ­ch há»£p Báº¿p** [Nguá»“n: docs/architecture/core-workflows.md#Kitchen-Workflow]:
- Tá»± Ä‘á»™ng in bill báº¿p khi xÃ¡c nháº­n Ä‘Æ¡n hÃ ng
- Chá»©c nÄƒng in láº¡i thá»§ cÃ´ng cho cÃ¡c mÃ³n cá»¥ thá»ƒ
- PhÃ¡t sÃ³ng tráº¡ng thÃ¡i thá»i gian thá»±c lÃªn mÃ n hÃ¬nh báº¿p
- Æ¯u tiÃªn Ä‘Æ¡n hÃ ng FIFO vá»›i tá»‘i Æ°u hÃ³a náº¥u nhanh
- **Tá»± Ä‘á»™ng trá»« kho khi Ä‘Æ¡n hÃ ng Ä‘Æ°á»£c xÃ¡c nháº­n vá»›i há»— trá»£ kho Ã¢m**
- **Há»‡ thá»‘ng cáº£nh bÃ¡o thiáº¿u nguyÃªn liá»‡u trÆ°á»›c khi xÃ¡c nháº­n Ä‘Æ¡n**

### ThÃ´ng sá»‘ ká»¹ thuáº­t API

**OrderAppService Endpoints** [Nguá»“n: docs/architecture/backend-architecture.md#API-Endpoints]:
```csharp
// ABP tá»± Ä‘á»™ng táº¡o REST endpoints:
GET /api/app/order                              // Liá»‡t kÃª Ä‘Æ¡n hÃ ng vá»›i lá»c
POST /api/app/order                             // Táº¡o Ä‘Æ¡n hÃ ng má»›i vá»›i validation recipe vÃ  cáº£nh bÃ¡o thiáº¿u nguyÃªn liá»‡u
PUT /api/app/order/{id}/status                  // Cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng vá»›i trá»« kho tá»± Ä‘á»™ng dá»±a trÃªn recipe
POST /api/app/order/{id}/print-kitchen-bill     // Chá»©c nÄƒng in thá»§ cÃ´ng
POST /api/app/order/{id}/payment                // TÃ­ch há»£p thanh toÃ¡n (Epic 8)
GET /api/app/order/check-missing-ingredients    // Kiá»ƒm tra nguyÃªn liá»‡u thiáº¿u cho items Ä‘Æ¡n hÃ ng
GET /api/app/order/{id}/missing-ingredients     // Láº¥y nguyÃªn liá»‡u thiáº¿u cho Ä‘Æ¡n hÃ ng cá»¥ thá»ƒ
POST /api/app/recipe/validate-availability      // Validate tÃ­nh kháº£ dá»¥ng nguyÃªn liá»‡u recipe cho mÃ³n Äƒn
```

**PhÆ°Æ¡ng thá»©c RecipeManager Domain Service**:
```csharp
// PhÆ°Æ¡ng thá»©c quáº£n lÃ½ recipe:
Task<List<MissingIngredientDto>> CheckIngredientAvailabilityAsync(Guid menuItemId);
Task<Dictionary<Guid, int>> CalculateRequiredIngredientsAsync(List<OrderItemDto> orderItems);
Task ProcessAutomaticDeductionAsync(Guid orderId); // Há»— trá»£ kho Ã¢m
Task<List<MissingIngredientDto>> GetMissingIngredientsAsync(Guid orderId);
```

### YÃªu cáº§u Kiáº¿n trÃºc Flutter Mobile

**Kiáº¿n trÃºc Flutter Widget** [Nguá»“n: docs/architecture/unified-project-structure.md#Flutter-Architecture]:
- Widget Stepper cho quy trÃ¬nh Ä‘Æ¡n hÃ ng nhiá»u bÆ°á»›c
- GridView cho hiá»ƒn thá»‹ bÃ n vÃ  mÃ³n Äƒn
- ListView cho items Ä‘Æ¡n hÃ ng vÃ  lá»‹ch sá»­ tráº¡ng thÃ¡i
- SnackBar/Toast widgets cho thÃ´ng bÃ¡o thá»i gian thá»±c
- SearchDelegate cho tÃ¬m kiáº¿m tiáº¿ng Viá»‡t

**Quáº£n lÃ½ State Flutter (Provider/BLoC)**:
```dart
class OrderState {
  final Order? currentOrder;
  final Table? selectedTable;  
  final List<MenuItem> availableMenuItems;
  final List<Order> orderHistory;
  final List<MissingIngredient> missingIngredients; // NguyÃªn liá»‡u thiáº¿u cho cáº£nh bÃ¡o
  final bool loading;
  final bool isConnected; // Tráº¡ng thÃ¡i káº¿t ná»‘i WebSocket
}

class MissingIngredient {
  final String ingredientName;
  final String menuItemName; 
  final int requiredQuantity;
  final int currentStock;
  final String unit;
  final bool isOptional;
  
  String get displayText => "$menuItemName: thiáº¿u $ingredientName (cáº§n ${requiredQuantity}${unit})";
  String get stockDisplayText => "$ingredientName: ${currentStock}${unit}";
}
```

**TÃ­ch há»£p WebSocket**:
- Sá»­ dá»¥ng package web_socket_channel cho giao tiáº¿p thá»i gian thá»±c
- Triá»ƒn khai tá»± Ä‘á»™ng káº¿t ná»‘i láº¡i vá»›i exponential backoff
- Xá»­ lÃ½ tráº¡ng thÃ¡i káº¿t ná»‘i trong UI (chá»‰ bÃ¡o káº¿t ná»‘i/ngáº¯t káº¿t ná»‘i)

### TiÃªu chuáº©n Kiá»ƒm thá»­

**Vá»‹ trÃ­ File Test** [Nguá»“n: docs/architecture/testing-strategy.md#Test-Structure]:
```
Backend Tests:
- test/SmartRestaurant.Domain.Tests/Orders/OrderManager_Tests.cs
- test/SmartRestaurant.Application.Tests/Orders/OrderAppService_Tests.cs

Flutter Mobile Tests:
- flutter_mobile/test/features/orders/screens/table_selection_screen_test.dart
- flutter_mobile/test/features/orders/screens/menu_browser_screen_test.dart
- flutter_mobile/test/features/orders/widgets/order_item_widget_test.dart
- flutter_mobile/test/features/orders/services/order_api_service_test.dart
- flutter_mobile/test/features/orders/widgets/missing_ingredients_warning_test.dart
- flutter_mobile/test/features/orders/services/recipe_service_test.dart

Integration Tests:
- flutter_mobile/integration_test/order_workflow_test.dart
- flutter_mobile/integration_test/missing_ingredients_workflow_test.dart
```

**YÃªu cáº§u Testing Framework**:
- Backend: xUnit vá»›i ABP test framework, Shouldly assertions
- Flutter Mobile: Flutter test framework vá»›i mockito cho mocking
- Widget Testing: Flutter widget testing cho UI components vÃ  cáº£nh bÃ¡o thiáº¿u nguyÃªn liá»‡u
- Integration Testing: Flutter integration testing cho workflows hoÃ n chá»‰nh bao gá»“m quáº£n lÃ½ recipe
- Recipe Testing: Kiá»ƒm thá»­ toÃ n diá»‡n cho tÃ­nh toÃ¡n MenuItemIngredient vÃ  ká»‹ch báº£n kho Ã¢m
- YÃªu cáº§u test coverage: â‰¥ 90% cho business logic components bao gá»“m quáº£n lÃ½ recipe

### CÃ¢n nháº¯c Hiá»‡u suáº¥t

**Tá»‘i Æ°u Database**:
- Index trÃªn Orders(TableId, Status) cho truy váº¥n hiá»‡u quáº£
- Index trÃªn MenuItemIngredients(MenuItemId, IngredientId) cho tÃ¬m kiáº¿m recipe
- Include OrderItems vá»›i MenuItem Ä‘á»ƒ trÃ¡nh N+1 queries
- Include MenuItemIngredients vá»›i Ingredient cho tÃ­nh toÃ¡n recipe
- Sá»­ dá»¥ng ABP's IQueryable extensions cho pagination

**Hiá»‡u suáº¥t Mobile**:
- WebSocket connection pooling cho ngÆ°á»i dÃ¹ng di Ä‘á»™ng Ä‘á»“ng thá»i
- Debounced status updates Ä‘á»ƒ trÃ¡nh lÃ m ngáº­p UI trÃªn mobile
- Local caching cho dá»¯ liá»‡u menu vÃ  thÃ´ng tin recipe vá»›i tÃ­ch há»£p SQLite
- Lazy loading cho danh sÃ¡ch menu lá»›n vÃ  lá»‹ch sá»­ Ä‘Æ¡n hÃ ng
- Tá»‘i Æ°u hÃ¬nh áº£nh cho áº£nh mÃ³n Äƒn
- TÃ­nh toÃ¡n nguyÃªn liá»‡u thiáº¿u hiá»‡u quáº£ Ä‘á»ƒ giáº£m thiá»ƒu API calls
- Cache dá»¯ liá»‡u recipe locally Ä‘á»ƒ giáº£m network requests khi táº¡o Ä‘Æ¡n hÃ ng

**Server-side Caching (ABP Memory Cache)**:
- Cache cÃ¡c mÃ³n Äƒn vÃ  danh má»¥c Ä‘á»ƒ giáº£m database queries
- Cache cáº¥u hÃ¬nh recipe Ä‘á»ƒ tÄƒng tá»‘c tÃ­nh toÃ¡n nguyÃªn liá»‡u thiáº¿u
- Cache user permissions vÃ  roles cho faster authorization checks
- Configurable cache expiration policies cho cÃ¡c loáº¡i dá»¯ liá»‡u khÃ¡c nhau

### YÃªu cáº§u Báº£o máº­t

[Nguá»“n: docs/architecture/backend-architecture.md#Authentication-and-Authorization]
```csharp
[Authorize(SmartRestaurantPermissions.Orders.Create)]  // Táº¡o Ä‘Æ¡n hÃ ng
[Authorize(SmartRestaurantPermissions.Kitchen.View)]   // Truy cáº­p báº¿p
[Authorize(SmartRestaurantPermissions.Payments.Process)] // Xá»­ lÃ½ thanh toÃ¡n
```

### Há»— trá»£ Báº£n Ä‘á»‹a hÃ³a
- Táº¥t cáº£ UI text báº±ng tiáº¿ng Viá»‡t vá»›i há»‡ thá»‘ng localization ABP
- Äá»‹nh dáº¡ng tiá»n tá»‡: Äá»“ng Viá»‡t Nam (â‚«) vá»›i phÃ¢n cÃ¡ch hÃ ng nghÃ¬n phÃ¹ há»£p
- NgÃ y/giá»: Äá»‹nh dáº¡ng Viá»‡t Nam (dd/MM/yyyy HH:mm)
- ThÃ´ng bÃ¡o lá»—i: ThÃ´ng bÃ¡o validation business thÃ¢n thiá»‡n vá»›i ngÆ°á»i dÃ¹ng Viá»‡t

## Báº£n ghi Dev Agent

### MÃ´ hÃ¬nh Agent Ä‘Æ°á»£c sá»­ dá»¥ng
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Tham chiáº¿u Debug Log
KhÃ´ng cÃ³ debug log Ä‘Æ°á»£c yÃªu cáº§u - story Ä‘Ã£ Ä‘Æ°á»£c triá»ƒn khai hoÃ n chá»‰nh

### Danh sÃ¡ch Ghi chÃº HoÃ n thÃ nh
- âœ… **Backend hoÃ n chá»‰nh** (BE-1 Ä‘áº¿n BE-9): Order management system vá»›i domain entities, services, SignalR hubs, recipe system, vÃ  inventory integration
- âœ… **Flutter Mobile hoÃ n chá»‰nh** (FLUTTER-1 Ä‘áº¿n FLUTTER-7): Multi-step order workflow vá»›i table selection, menu browsing, order confirmation, status tracking, vÃ  missing ingredients warnings
- âœ… **Testing hoÃ n chá»‰nh** (BE-6): Unit tests, integration tests, performance tests cho toÃ n bá»™ business logic
- ğŸ”„ **QR Payment Integration**: ÄÃ£ cÃ³ VietQR printing vÃ  payment processing integration

### Danh sÃ¡ch File
**Backend Files:**
- aspnet-core/src/SmartRestaurant.Domain/Orders/Order.cs
- aspnet-core/src/SmartRestaurant.Domain/Orders/OrderItem.cs  
- aspnet-core/src/SmartRestaurant.Domain/Orders/OrderManager.cs
- aspnet-core/src/SmartRestaurant.Domain/Orders/Payment.cs
- aspnet-core/src/SmartRestaurant.Application/Orders/OrderAppService.cs
- aspnet-core/src/SmartRestaurant.Domain/MenuManagement/RecipeManager.cs
- aspnet-core/src/SmartRestaurant.Domain/MenuManagement/MenuItemIngredients/MenuItemIngredient.cs
- aspnet-core/src/SmartRestaurant.HttpApi.Host/Hubs/KitchenHub.cs
- aspnet-core/src/SmartRestaurant.HttpApi.Host/Hubs/OrderStatusHub.cs
- aspnet-core/src/SmartRestaurant.HttpApi.Host/Hubs/TableManagementHub.cs

**Flutter Mobile Files:**
- flutter_mobile/lib/features/order/screens/table_detail_screen.dart
- flutter_mobile/lib/features/order/screens/menu_screen.dart
- flutter_mobile/lib/features/order/screens/order_screen.dart
- flutter_mobile/lib/features/order/widgets/table_card.dart
- flutter_mobile/lib/features/order/widgets/menu_item_card.dart
- flutter_mobile/lib/features/order/widgets/order_item_card.dart
- flutter_mobile/lib/features/order/widgets/ingredient_verification_dialog.dart
- flutter_mobile/lib/core/services/order_service.dart
- flutter_mobile/lib/core/utils/qr_payment_utils.dart
- flutter_mobile/lib/core/utils/invoice_layout_utils.dart

**Database Migrations:**
- aspnet-core/src/SmartRestaurant.EntityFrameworkCore/Migrations/20250904085436_AddOrderManagement.cs
- aspnet-core/src/SmartRestaurant.EntityFrameworkCore/Migrations/20250904095828_AddMenuItemIngredients.cs
- aspnet-core/src/SmartRestaurant.EntityFrameworkCore/Migrations/20250913010532_AddPaymentEntity.cs

**Test Files:**
- aspnet-core/test/SmartRestaurant.Domain.Tests/Orders/OrderManager_Tests.cs
- aspnet-core/test/SmartRestaurant.Domain.Tests/MenuManagement/RecipeManager_Tests.cs
- aspnet-core/test/SmartRestaurant.Domain.Tests/Orders/Order_Tests.cs
- aspnet-core/test/SmartRestaurant.Application.Tests/Orders/OrderAppService_Tests.cs
- aspnet-core/test/SmartRestaurant.Application.Tests/Orders/OrderSignalR_Performance_Tests.cs

## Káº¿t quáº£ QA

_Káº¿t quáº£ tá»« QA Agent review triá»ƒn khai story hoÃ n chá»‰nh sáº½ Ä‘Æ°á»£c Ä‘iá»n á»Ÿ Ä‘Ã¢y_

## Nháº­t kÃ½ Thay Ä‘á»•i

| NgÃ y | PhiÃªn báº£n | MÃ´ táº£ | TÃ¡c giáº£ |
|------|-----------|-------|---------|
| 2025-09-04 | 1.0 | Táº¡o story ban Ä‘áº§u vá»›i máº«u Level 2 | Bob (Scrum Master) |
| 2025-09-04 | 1.1 | ThÃªm há»— trá»£ song ngá»¯ tiáº¿ng Viá»‡t | Bob (Scrum Master) |
| 2025-09-04 | 1.2 | ThÃªm tÃ­ch há»£p tá»± Ä‘á»™ng trá»« kho | Bob (Scrum Master) |
| 2025-09-04 | 1.3 | Chuyá»ƒn tá»« Angular web sang táº­p trung Flutter mobile | Bob (Scrum Master) |
| 2025-09-04 | 1.4 | ThÃªm há»‡ thá»‘ng Recipe Management hoÃ n chá»‰nh vá»›i entity MenuItemIngredient vÃ  há»— trá»£ kho Ã¢m | Bob (Scrum Master) |
| 2025-09-04 | 1.5 | Loáº¡i bá» dependency in-memory cache, thay báº±ng ABP Memory Cache | Bob (Scrum Master) |
| 2025-09-04 | 1.6 | Sá»­a cÃ¡c váº¥n Ä‘á» validation: ThÃªm dependencies rÃµ rÃ ng, biáº¿n mÃ´i trÆ°á»ng, chuáº©n hÃ³a tham chiáº¿u, nÃ¢ng cao edge cases, chiáº¿n lÆ°á»£c migration, tÃ­nh nÄƒng accessibility | Sarah (Product Owner) |
| 2025-09-04 | 1.7 | Táº¡o phiÃªn báº£n tiáº¿ng Viá»‡t tá»± nhiÃªn tá»« story gá»‘c | Sarah (Product Owner) |