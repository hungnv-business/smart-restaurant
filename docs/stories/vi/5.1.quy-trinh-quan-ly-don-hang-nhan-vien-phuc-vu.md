# User Story 5.1: Quy tr√¨nh Qu·∫£n l√Ω ƒê∆°n h√†ng c·ªßa Nh√¢n vi√™n Ph·ª•c v·ª•

**Epic**: Epic 5 - X·ª≠ l√Ω ƒê∆°n h√†ng & Ph·ªëi h·ª£p B·∫øp  
**ƒêi·ªÉm Story**: 35-50 (Level 2 - M·∫´u Logic Kinh doanh)  
**∆Øu ti√™n**: Cao  
**Tr·∫°ng th√°i**: Ho√†n th√†nh
**Ng∆∞·ªùi ph·ª• tr√°ch**: Nh√≥m Ph√°t tri·ªÉn  
**Sprint**: TBD

## Si√™u d·ªØ li·ªáu M·∫´u

### C·∫•p ƒë·ªô M·∫´u
**C·∫•p ƒë·ªô ƒë∆∞·ª£c ch·ªçn**: Level 2 (M·∫´u Logic Kinh doanh)

### Ph√¢n t√≠ch ƒê·ªô ph·ª©c t·∫°p
- **ƒê·ªô ph·ª©c t·∫°p Th·ª±c th·ªÉ**: Business - Order entity v·ªõi tr·∫°ng th√°i lifecycle ph·ª©c t·∫°p (Ch·ªù ‚Üí X√°c nh·∫≠n ‚Üí ƒêang chu·∫©n b·ªã ‚Üí S·∫µn s√†ng ‚Üí ƒê√£ ph·ª•c v·ª• ‚Üí ƒê√£ thanh to√°n), ph·ªëi h·ª£p b·∫øp, v√† c·∫≠p nh·∫≠t th·ªùi gian th·ª±c
- **ƒê·ªô ph·ª©c t·∫°p Giao di·ªán**: Workflow - Quy tr√¨nh nhi·ªÅu b∆∞·ªõc t·ª´ ch·ªçn b√†n ‚Üí duy·ªát menu ‚Üí x√°c nh·∫≠n ƒë∆°n h√†ng ‚Üí ph·ªëi h·ª£p b·∫øp ‚Üí ho√†n th√†nh ph·ª•c v·ª• v·ªõi theo d√µi tr·∫°ng th√°i
- **Y√™u c·∫ßu K·ªπ thu·∫≠t**: Business - C·∫ßn custom application services, c·∫≠p nh·∫≠t tr·∫°ng th√°i th·ªùi gian th·ª±c qua SignalR, t√≠ch h·ª£p b·∫øp, v√† ch·ª©c nƒÉng in ·∫•n

### ∆Ø·ªõc t√≠nh ƒêi·ªÉm Story
**Ph·∫°m vi**: 35-50 ƒëi·ªÉm (d·ª±a tr√™n ƒë·ªô ph·ª©c t·∫°p m·∫´u Level 2)

### Tham kh·∫£o M·∫´u
- **M·∫´u Backend**: templates/backend-template-level2.md
- **M·∫´u Frontend**: templates/frontend-template-level2.md  
- **M·∫´u Task**: .bmad-core/templates/level2-tasks.yaml

## Dependencies Story

**ƒêi·ªÅu ki·ªán ti√™n quy·∫øt**:
- ‚úÖ **Epic 4.3 - H·ªá th·ªëng Nguy√™n li·ªáu ƒêa ƒë∆°n v·ªã**: B·∫ÆT BU·ªòC - H·ªá th·ªëng qu·∫£n l√Ω nguy√™n li·ªáu v·ªõi chuy·ªÉn ƒë·ªïi ƒë∆°n v·ªã c∆° s·ªü ph·∫£i ho√†n th√†nh
- ‚úÖ **Story 3.x - Qu·∫£n l√Ω B√†n**: B·∫ÆT BU·ªòC - Entity Table v√† qu·∫£n l√Ω tr·∫°ng th√°i ph·∫£i t·ªìn t·∫°i
- ‚ö†Ô∏è **Story 4.1 - Qu·∫£n l√Ω M√≥n ƒÉn**: B·∫ÆT BU·ªòC - Entity MenuItem v·ªõi li√™n k·∫øt PrimaryIngredientId ƒë√£ thi·∫øt l·∫≠p

**ƒêi·ªÉm t√≠ch h·ª£p t∆∞∆°ng lai**:
- üîÑ **Epic 8 - X·ª≠ l√Ω Thanh to√°n**: T√≠ch h·ª£p n√∫t thanh to√°n s·∫µn s√†ng cho tri·ªÉn khai t∆∞∆°ng lai

## M√¥ t·∫£ Story

**V·ªõi vai tr√≤** nh√¢n vi√™n ph·ª•c v·ª•,  
**T√¥i mu·ªën** ho√†n th√†nh to√†n b·ªô quy tr√¨nh g·ªçi m√≥n t·ª´ ch·ªçn b√†n ƒë·∫øn x√°c nh·∫≠n ƒë∆°n h√†ng v√† ph·ªëi h·ª£p v·ªõi b·∫øp,  
**ƒê·ªÉ** t√¥i c√≥ th·ªÉ ph·ª•c v·ª• kh√°ch h√†ng hi·ªáu qu·∫£ th√¥ng qua quy tr√¨nh m∆∞·ª£t m√†: xem tr·∫°ng th√°i b√†n ‚Üí ch·ªçn b√†n kh√°ch ‚Üí duy·ªát menu ‚Üí g·ªçi m√≥n ‚Üí x√°c nh·∫≠n ƒë∆°n ‚Üí ph·ªëi h·ª£p b·∫øp ‚Üí ph·ª•c v·ª• kh√°ch ‚Üí x√°c nh·∫≠n ho√†n th√†nh.

## Ti√™u ch√≠ Ch·∫•p nh·∫≠n

1. **Tr·∫°ng th√°i & Ch·ªçn B√†n**: Hi·ªÉn th·ªã tr·∫°ng th√°i b√†n th·ªùi gian th·ª±c (Tr·ªëng, C√≥ kh√°ch, ƒê√£ ƒë·∫∑t, ƒêang d·ªçn) v·ªõi c√°c ch·ªâ b√°o m√£ m√†u v√† giao di·ªán ch·ªçn b√†n th√¢n thi·ªán c·∫£m ·ª©ng

2. **Duy·ªát Menu & T√¨m ki·∫øm**: Hi·ªÉn th·ªã menu responsive v·ªõi t√¨m ki·∫øm ti·∫øng Vi·ªát, t·ª± ƒë·ªông ho√†n th√†nh, l·ªçc danh m·ª•c v√† tr·∫°ng th√°i c√≥ s·∫µn th·ªùi gian th·ª±c

3. **Ch·ªçn M√≥n & T√πy ch·ªânh**: Ch·ªçn m√≥n v·ªõi ƒëi·ªÅu ch·ªânh s·ªë l∆∞·ª£ng, ghi ch√∫ ri√™ng ho·∫∑c chung, v√† hi·ªÉn th·ªã t√≥m t·∫Øt ƒë∆°n h√†ng v·ªõi th√¥ng tin b√†n

4. **X√°c nh·∫≠n ƒê∆°n h√†ng & T√≠ch h·ª£p B·∫øp**: X√°c nh·∫≠n ƒë∆°n h√†ng v·ªõi in t·ª± ƒë·ªông cho tr·∫°m b·∫øp ph√π h·ª£p v√† theo d√µi tr·∫°ng th√°i th·ªùi gian th·ª±c (ƒê√£ x√°c nh·∫≠n, ƒêang chu·∫©n b·ªã, S·∫µn s√†ng, ƒê√£ ph·ª•c v·ª•)

5. **Ch·ª©c nƒÉng In th·ªß c√¥ng**: N√∫t in th·ªß c√¥ng ƒë·ªÉ ch·ªçn c√°c m√≥n c·ª• th·ªÉ v√† in l·∫°i bill b·∫øp cho ƒë∆°n h√†ng khi c·∫ßn thi·∫øt

6. **Quy tr√¨nh Ho√†n th√†nh Ph·ª•c v·ª•**: Giao di·ªán x√°c nh·∫≠n ho√†n th√†nh ph·ª•c v·ª• v·ªõi t√≠ch h·ª£p c·∫≠p nh·∫≠t tr·∫°ng th√°i b√†n v√† theo d√µi l·ªãch s·ª≠ ƒë∆°n h√†ng

7. **T√≠ch h·ª£p N√∫t Thanh to√°n**: N√∫t x·ª≠ l√Ω thanh to√°n ƒë·∫∑t c·∫°nh c√°c n√∫t in v√† thao t√°c ph·ª•c v·ª• ƒë·ªÉ t√≠ch h·ª£p quy tr√¨nh thanh to√°n m∆∞·ª£t m√† v·ªõi Epic 8

## Nhi·ªám v·ª• / Nhi·ªám v·ª• con

### Nhi·ªám v·ª• Backend

- [x] **BE-1**: Thi·∫øt k·∫ø M√¥ h√¨nh Domain Order v·ªõi Logic Kinh doanh (AC: 1, 4, 6)
  - [x] ƒê·ªãnh nghƒ©a entity Order v·ªõi enum OrderStatus (Active, Paid) 
  - [x] T·∫°o entity OrderItem v√† c·∫•u h√¨nh m·ªëi quan h·ªá v·ªõi MenuItem
  - [x] Th√™m validation quy t·∫Øc kinh doanh cho chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i ƒë∆°n h√†ng v√† t√¨nh tr·∫°ng b√†n
  - [x] Tri·ªÉn khai domain events cho thay ƒë·ªïi tr·∫°ng th√°i ƒë∆°n h√†ng v√† th√¥ng b√°o b·∫øp
  - [x] Th√™m tr∆∞·ªùng audit v√† ƒë·∫£m b·∫£o k·∫ø th·ª´a ABP FullAuditedAggregateRoot ph√π h·ª£p

- [x] **BE-2**: T·∫°o Order Domain Service (AC: 4, 5, 6)
  - [x] Tri·ªÉn khai OrderManager v·ªõi ph∆∞∆°ng th·ª©c validation table availability
  - [x] Th√™m logic validation chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i v√† business rules
  - [x] T·∫°o ph∆∞∆°ng th·ª©c t√≠nh gi√° ƒë∆°n h√†ng v√† recipe management
  - [x] Tri·ªÉn khai c√°c ph∆∞∆°ng th·ª©c NotifyKitchenAsync v√† PrintKitchenBillAsync
  - [x] **Th√™m ph∆∞∆°ng th·ª©c ProcessInventoryDeductionAsync cho t·ª± ƒë·ªông tr·ª´ kho khi ƒë∆°n h√†ng ƒë∆∞·ª£c x√°c nh·∫≠n**
  - [x] Th√™m th·ª±c thi quy t·∫Øc kinh doanh cho quy tr√¨nh ho√†n th√†nh ph·ª•c v·ª•

- [x] **BE-3**: Tri·ªÉn khai Order Application Service (AC: 1, 2, 3, 4, 5, 6, 7)
  - [x] T·∫°o OrderAppService s·ª≠ d·ª•ng IApplicationService (kh√¥ng ph·∫£i ICrudAppService)
  - [x] Tri·ªÉn khai CreateOrderAsync v·ªõi validation b√†n v√† ki·ªÉm tra m√≥n ƒÉn
  - [x] **Th√™m validation t·ªìn kho trong CreateOrderAsync**
  - [x] Th√™m ph∆∞∆°ng th·ª©c UpdateOrderStatusAsync v·ªõi ph√¢n quy·ªÅn ph√π h·ª£p
  - [x] **T√≠ch h·ª£p t·ª± ƒë·ªông tr·ª´ kho khi tr·∫°ng th√°i ƒë∆°n h√†ng chuy·ªÉn th√†nh Confirmed**
  - [x] T·∫°o c√°c ph∆∞∆°ng th·ª©c chuy√™n bi·ªát GetTableDetails v√† GetMenuItemsForOrder
  - [x] Th√™m ch·ª©c nƒÉng PrintKitchenBillAsync v√† ReprintBillAsync
  - [x] Tri·ªÉn khai CompleteOrderServiceAsync v·ªõi ƒë·∫∑t l·∫°i tr·∫°ng th√°i b√†n
  - [x] Th√™m qu·∫£n l√Ω transaction v√† x·ª≠ l√Ω l·ªói to√†n di·ªán

- [x] **BE-4**: Th√™m C·∫•u h√¨nh Database v√† Hi·ªáu su·∫•t (AC: 1, 4)
  - [x] C·∫•u h√¨nh m·ªëi quan h·ªá Order, OrderItem, Table trong SmartRestaurantDbContext
  - [x] Th√™m migration database cho c√°c entity Order v√† OrderItem
  - [x] C·∫•u h√¨nh c√°c index hi·ªáu su·∫•t: Orders(TableId), Orders(Status), OrderItems(OrderId)
  - [x] Th√™m c√°c r√†ng bu·ªôc database cho quy t·∫Øc kinh doanh (chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i h·ª£p l·ªá)

- [x] **BE-5**: T·∫°o SignalR Hubs cho C·∫≠p nh·∫≠t Th·ªùi gian th·ª±c (AC: 4, 6)
  - [x] Tri·ªÉn khai KitchenHub cho c·∫≠p nh·∫≠t ƒë∆°n h√†ng b·∫øp th·ªùi gian th·ª±c
  - [x] T·∫°o TableManagementHub cho ph√°t s√≥ng tr·∫°ng th√°i b√†n
  - [x] Th√™m OrderStatusHub cho th√¥ng b√°o nh√¢n vi√™n
  - [x] C·∫•u h√¨nh ph√¢n quy·ªÅn hub v·ªõi c√°c vai tr√≤ nh√† h√†ng ph√π h·ª£p
  - [x] Th√™m qu·∫£n l√Ω k·∫øt n·ªëi v√† x·ª≠ l√Ω l·ªói

- [x] **BE-6**: Tri·ªÉn khai Ki·ªÉm th·ª≠ Logic Kinh doanh (AC: T·∫•t c·∫£)
  - [x] Vi·∫øt c√°c unit test OrderManager cho t·∫•t c·∫£ quy t·∫Øc kinh doanh
  - [x] Ki·ªÉm th·ª≠ chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i ƒë∆°n h√†ng v√† logic validation
  - [x] **Ki·ªÉm th·ª≠ c√°c k·ªãch b·∫£n t·ª± ƒë·ªông tr·ª´ kho v√† validation t·ªìn kho**
  - [x] T·∫°o c√°c integration test cho quy tr√¨nh ƒë∆°n h√†ng ho√†n ch·ªânh
  - [x] Ki·ªÉm th·ª≠ t√≠ch h·ª£p b·∫øp v√† ch·ª©c nƒÉng in ·∫•n
  - [x] Th√™m c√°c test hi·ªáu su·∫•t cho c·∫≠p nh·∫≠t th·ªùi gian th·ª±c

- [x] **BE-7**: T·∫°o Entity MenuItemIngredient v√† H·ªá th·ªëng Recipe (AC: 2, 4)
  - [x] T·∫°o entity MenuItemIngredient v·ªõi m·ªëi quan h·ªá nhi·ªÅu-nhi·ªÅu
  - [x] Th√™m c√°c thu·ªôc t√≠nh MenuItemIngredient: MenuItemId, IngredientId, RequiredQuantity
  - [x] C·∫≠p nh·∫≠t entity MenuItem v·ªõi thu·ªôc t√≠nh ƒëi·ªÅu h∆∞·ªõng Ingredients
  - [x] C·∫•u h√¨nh m·ªëi quan h·ªá Entity Framework cho MenuItemIngredient
  - [x] T·∫°o migration database cho b·∫£ng MenuItemIngredients

- [x] **BE-8**: Tri·ªÉn khai RecipeManager Domain Service (AC: 2, 4)
  - [x] T·∫°o RecipeManager v·ªõi ph∆∞∆°ng th·ª©c CheckIngredientAvailabilityAsync
  - [x] Tri·ªÉn khai CalculateRequiredIngredientsAsync cho c√°c items ƒë∆°n h√†ng
  - [x] Th√™m ProcessAutomaticDeductionAsync v·ªõi h·ªó tr·ª£ kho √¢m
  - [x] T·∫°o GetMissingIngredientsAsync cho hi·ªÉn th·ªã c·∫£nh b√°o
  - [x] Th√™m logic kinh doanh cho nguy√™n li·ªáu t√πy ch·ªçn v√† b·∫Øt bu·ªôc

- [x] **BE-9**: C·∫≠p nh·∫≠t H·ªá th·ªëng Kho cho Kho √¢m (AC: 2, 4)
  - [x] Lo·∫°i b·ªè r√†ng bu·ªôc kho >= 0 t·ª´ entity Ingredient
  - [x] C·∫≠p nh·∫≠t IngredientAppService cho ph√©p thao t√°c kho √¢m
  - [x] Th√™m c√°c ph∆∞∆°ng th·ª©c t√≠nh to√°n nguy√™n li·ªáu thi·∫øu
  - [x] T·∫°o migration d·ªØ li·ªáu ƒë·ªÉ migrate t·ª´ PrimaryIngredientId sang MenuItemIngredients
  - [x] C·∫≠p nh·∫≠t logic hi·ªÉn th·ªã kho ƒë·ªÉ hi·ªán gi√° tr·ªã √¢m

### Nhi·ªám v·ª• Flutter Mobile

- [x] **FLUTTER-1**: T·∫°o M√†n h√¨nh Quy tr√¨nh ƒê∆°n h√†ng Nhi·ªÅu b∆∞·ªõc (AC: 1, 2, 3)
  - [x] T·∫°o c√°c m√†n h√¨nh quy tr√¨nh order: table_detail_screen.dart, menu_screen.dart, order_screen.dart
  - [x] Tri·ªÉn khai UI flow cho: Ch·ªçn B√†n ‚Üí Duy·ªát Menu ‚Üí Xem l·∫°i ƒê∆°n h√†ng ‚Üí X√°c nh·∫≠n
  - [x] T·∫°o logic ƒëi·ªÅu h∆∞·ªõng b∆∞·ªõc v·ªõi validation s·ª≠ d·ª•ng Flutter navigation
  - [x] Th√™m ch·ªâ b√°o ti·∫øn tr√¨nh v√† nh√£n ti·∫øng Vi·ªát s·ª≠ d·ª•ng Flutter widgets
  - [x] Tri·ªÉn khai validation ho√†n th√†nh b∆∞·ªõc v√† th·ª±c thi quy t·∫Øc kinh doanh

- [x] **FLUTTER-2**: X√¢y d·ª±ng M√†n h√¨nh Ch·ªçn B√†n Th√¢n thi·ªán C·∫£m ·ª©ng (AC: 1)
  - [x] T·∫°o table selection UI v·ªõi c√°c ch·ªâ b√°o tr·∫°ng th√°i m√£ m√†u
  - [x] Tri·ªÉn khai b·ªë c·ª•c l∆∞·ªõi responsive cho b√†n s·ª≠ d·ª•ng Flutter GridView
  - [x] Th√™m c·∫≠p nh·∫≠t tr·∫°ng th√°i b√†n th·ªùi gian th·ª±c qua API calls
  - [x] T·∫°o ch√∫ gi·∫£i tr·∫°ng th√°i b√†n: Available (xanh l√°), Occupied (ƒë·ªè), Reserved (v√†ng)
  - [x] Th√™m ch·ª©c nƒÉng l·ªçc v√† t√¨m ki·∫øm b√†n s·ª≠ d·ª•ng Flutter search widgets

- [x] **FLUTTER-3**: Tri·ªÉn khai M√†n h√¨nh Duy·ªát Menu v√† T√¨m ki·∫øm (AC: 2, 3)
  - [x] T·∫°o menu_screen.dart v·ªõi tab danh m·ª•c v√† danh s√°ch m√≥n
  - [x] Tri·ªÉn khai t√¨m ki·∫øm ti·∫øng Vi·ªát v·ªõi t·ª± ƒë·ªông ho√†n th√†nh s·ª≠ d·ª•ng Flutter search
  - [x] Th√™m l·ªçc danh m·ª•c v·ªõi ch·ªâ b√°o tr·∫°ng th√°i c√≥ s·∫µn
  - [x] T·∫°o ch·ªçn m√≥n v·ªõi ƒëi·ªÅu khi·ªÉn ƒëi·ªÅu ch·ªânh s·ªë l∆∞·ª£ng s·ª≠ d·ª•ng Flutter widgets
  - [x] Th√™m nh·∫≠p ghi ch√∫ m√≥n ri√™ng v√† chung s·ª≠ d·ª•ng Flutter text fields

- [x] **FLUTTER-4**: Th√™m M√†n h√¨nh T√≥m t·∫Øt v√† X√°c nh·∫≠n ƒê∆°n h√†ng (AC: 3, 4, 7)
  - [x] T·∫°o order_screen.dart v·ªõi danh s√°ch chi ti·∫øt v√† gi√°
  - [x] Tri·ªÉn khai ƒëi·ªÅu khi·ªÉn s·ª≠a ƒë·ªïi ƒë∆°n h√†ng (thay ƒë·ªïi s·ªë l∆∞·ª£ng, x√≥a m√≥n)
  - [x] Th√™m hi·ªÉn th·ªã th√¥ng tin b√†n v√† ghi ch√∫
  - [x] T·∫°o dialog x√°c nh·∫≠n v·ªõi xem l·∫°i ƒë∆°n h√†ng s·ª≠ d·ª•ng Flutter dialogs
  - [x] Th√™m t√≠ch h·ª£p QR code thanh to√°n cho Epic 8

- [x] **FLUTTER-5**: X√¢y d·ª±ng M√†n h√¨nh Theo d√µi Tr·∫°ng th√°i v√† T√≠ch h·ª£p B·∫øp (AC: 4, 5, 6)
  - [x] T·∫°o order status tracking v·ªõi badge tr·∫°ng th√°i ti·∫øng Vi·ªát
  - [x] Tri·ªÉn khai c·∫≠p nh·∫≠t tr·∫°ng th√°i th·ªùi gian th·ª±c qua API polling
  - [x] Th√™m ch·ª©c nƒÉng in th·ªß c√¥ng v·ªõi giao di·ªán ch·ªçn m√≥n
  - [x] T·∫°o giao di·ªán ho√†n th√†nh d·ªãch v·ª• v·ªõi ƒëi·ªÅu khi·ªÉn x√°c nh·∫≠n
  - [x] Th√™m d√≤ng th·ªùi gian l·ªãch s·ª≠ tr·∫°ng th√°i s·ª≠ d·ª•ng Flutter timeline widgets

- [x] **FLUTTER-6**: Tri·ªÉn khai T√≠nh nƒÉng Mobile N√¢ng cao v√† X·ª≠ l√Ω L·ªói (AC: T·∫•t c·∫£)
  - [x] Th√™m ph·∫ßn t·ª≠ UI c√≥ ƒëi·ªÅu ki·ªán d·ª±a tr√™n tr·∫°ng th√°i ƒë∆°n h√†ng v√† quy t·∫Øc kinh doanh
  - [x] Tri·ªÉn khai th√¥ng b√°o validation ti·∫øng Vi·ªát v√† x·ª≠ l√Ω l·ªói
  - [x] T·∫°o quy tr√¨nh x√°c nh·∫≠n cho thao t√°c quan tr·ªçng s·ª≠ d·ª•ng Flutter alerts
  - [x] Th√™m tr·∫°ng th√°i t·∫£i v√† ch·ªâ b√°o ti·∫øn tr√¨nh s·ª≠ d·ª•ng Flutter progress widgets
  - [x] Tri·ªÉn khai ph√°t hi·ªán offline v√† th√¥ng b√°o s·ª≠ d·ª•ng Flutter connectivity
  - [x] **X·ª≠ l√Ω c√°c t√¨nh hu·ªëng edge case: Timeout m·∫°ng, m·∫•t k·∫øt n·ªëi WebSocket, tr·∫°ng th√°i b√†n kh√¥ng h·ª£p l·ªá, l·ªói m√°y in b·∫øp**
  - [x] **Th√™m quy tr√¨nh ph·ª•c h·ªìi l·ªói to√†n di·ªán: T·ª± ƒë·ªông th·ª≠ l·∫°i ƒë∆°n h√†ng th·∫•t b·∫°i, ti·∫øp t·ª•c workflow b·ªã gi√°n ƒëo·∫°n, ƒë·ªìng b·ªô d·ªØ li·ªáu sau khi k·∫øt n·ªëi l·∫°i**
  - [x] **Th√™m t√≠nh nƒÉng accessibility: H·ªó tr·ª£ ƒë·ªçc m√†n h√¨nh, ch·∫ø ƒë·ªô t∆∞∆°ng ph·∫£n cao, h·ªó tr·ª£ text l·ªõn, k√≠ch th∆∞·ªõc m·ª•c ti√™u c·∫£m ·ª©ng**

- [x] **FLUTTER-7**: Th√™m H·ªá th·ªëng C·∫£nh b√°o Thi·∫øu Nguy√™n li·ªáu (AC: 2, 4)
  - [x] T·∫°o popup c·∫£nh b√°o thi·∫øu nguy√™n li·ªáu v·ªõi th√¥ng b√°o ti·∫øng Vi·ªát
  - [x] Hi·ªÉn th·ªã nguy√™n li·ªáu thi·∫øu c·ª• th·ªÉ cho t·ª´ng m√≥n: "Ph·ªü B√≤: thi·∫øu Th·ªãt b√≤ (c·∫ßn 200g)"
  - [x] Th√™m dialog x√°c nh·∫≠n: "ƒê·∫∑t m√≥n v√† c·∫ßn mua th√™m nguy√™n li·ªáu"
  - [x] Tri·ªÉn khai m√†n h√¨nh danh s√°ch nguy√™n li·ªáu thi·∫øu th·ªùi gian th·ª±c
  - [x] Hi·ªÉn th·ªã gi√° tr·ªã kho √¢m v·ªõi ch·ªâ b√°o r√µ r√†ng: "Th·ªãt b√≤: -500g"

### Nhi·ªám v·ª• Ki·ªÉm th·ª≠

- [ ] **TEST-1**: Ki·ªÉm th·ª≠ T√≠ch h·ª£p Logic Kinh doanh (AC: T·∫•t c·∫£)
  - [ ] Ki·ªÉm th·ª≠ quy tr√¨nh ƒë∆°n h√†ng ho√†n ch·ªânh t·ª´ ƒë·∫ßu ƒë·∫øn cu·ªëi t·ª´ ch·ªçn b√†n ƒë·∫øn thanh to√°n
  - [ ] X√°c minh th·ª±c thi quy t·∫Øc kinh doanh qua c√°c l·ªõp UI v√† API
  - [ ] Ki·ªÉm th·ª≠ c√°c t√¨nh hu·ªëng l·ªói v√† th·∫•t b·∫°i validation kinh doanh
  - [ ] T·∫°o c√°c k·ªãch b·∫£n d·ªØ li·ªáu ki·ªÉm th·ª≠ cho c√°c lo·∫°i ƒë∆°n h√†ng kh√°c nhau (ƒÉn t·∫°i ch·ªó, mang v·ªÅ)

- [ ] **TEST-2**: Ki·ªÉm th·ª≠ Flutter Mobile (AC: 1, 2, 3, 4, 5, 6)
  - [ ] Ki·ªÉm th·ª≠ ƒëi·ªÅu h∆∞·ªõng quy tr√¨nh nhi·ªÅu b∆∞·ªõc v√† quy t·∫Øc validation s·ª≠ d·ª•ng Flutter test framework
  - [ ] X√°c minh ch·ª©c nƒÉng t√¨m ki·∫øm ti·∫øng Vi·ªát v√† t·ª± ƒë·ªông ho√†n th√†nh tr√™n thi·∫øt b·ªã di ƒë·ªông
  - [ ] Ki·ªÉm th·ª≠ c·∫≠p nh·∫≠t tr·∫°ng th√°i th·ªùi gian th·ª±c v√† x·ª≠ l√Ω k·∫øt n·ªëi WebSocket
  - [ ] T·∫°o widget test cho t·∫•t c·∫£ m√†n h√¨nh v√† component Flutter
  - [ ] Ki·ªÉm th·ª≠ giao di·ªán c·∫£m ·ª©ng v√† x·ª≠ l√Ω c·ª≠ ch·ªâ tr√™n c√°c k√≠ch th∆∞·ªõc m√†n h√¨nh kh√°c nhau

- [ ] **TEST-3**: Ki·ªÉm th·ª≠ T√≠ch h·ª£p Th·ªùi gian th·ª±c (AC: 4, 6)
  - [ ] Ki·ªÉm th·ª≠ k·∫øt n·ªëi SignalR hub v√† ph√°t s√≥ng th√¥ng ƒëi·ªáp
  - [ ] X√°c minh ph√¢n ph·ªëi th√¥ng b√°o b·∫øp v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i
  - [ ] Ki·ªÉm th·ª≠ c√°c k·ªãch b·∫£n ng∆∞·ªùi d√πng ƒë·ªìng th·ªùi v·ªõi nhi·ªÅu ƒë∆°n h√†ng
  - [ ] T·∫°o c√°c stress test cho y√™u c·∫ßu hi·ªáu su·∫•t th·ªùi gian th·ª±c

- [ ] **TEST-4**: Ki·ªÉm th·ª≠ Qu·∫£n l√Ω Recipe v√† Kho √¢m (AC: 2, 4)
  - [ ] Ki·ªÉm th·ª≠ m·ªëi quan h·ªá MenuItemIngredient v√† t√≠nh to√°n recipe
  - [ ] X√°c minh c√°c k·ªãch b·∫£n kho √¢m v·ªõi tr·ª´ kho t·ª± ƒë·ªông
  - [ ] Ki·ªÉm th·ª≠ h·ªá th·ªëng c·∫£nh b√°o thi·∫øu nguy√™n li·ªáu
  - [ ] T·∫°o c√°c integration test cho quy tr√¨nh recipe ho√†n ch·ªânh
  - [ ] Ki·ªÉm th·ª≠ logic kinh doanh nguy√™n li·ªáu t√πy ch·ªçn vs b·∫Øt bu·ªôc

## Ghi ch√∫ Ph√°t tri·ªÉn

### H∆∞·ªõng d·∫´n C·ª• th·ªÉ cho M·∫´u (Level 2 - Logic Kinh doanh)

**M·∫´u Tri·ªÉn khai**:
- S·ª≠ d·ª•ng IApplicationService c·ªßa ABP thay v√¨ ICrudAppService ƒë·ªÉ h·ªó tr·ª£ logic kinh doanh ph·ª©c t·∫°p
- Tri·ªÉn khai Domain Services cho validation ƒë∆°n h√†ng, chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i, v√† ph·ªëi h·ª£p b·∫øp
- S·ª≠ d·ª•ng SignalR hubs cho c·∫≠p nh·∫≠t tr·∫°ng th√°i th·ªùi gian th·ª±c gi·ªØa nh√¢n vi√™n ph·ª•c v·ª• v√† m√†n h√¨nh b·∫øp
- √Åp d·ª•ng m·∫´u domain events c·ªßa ABP cho thay ƒë·ªïi tr·∫°ng th√°i ƒë∆°n h√†ng v√† th√¥ng b√°o

**Dependencies B·∫Øt bu·ªôc**:
- ABP Framework 8.0 v·ªõi h·ªó tr·ª£ authorization, localization, v√† in-memory caching t√≠ch h·ª£p
- SignalR cho giao ti·∫øp th·ªùi gian th·ª±c gi·ªØa mobile app v√† h·ªá th·ªëng b·∫øp
- Entity Framework Core cho c√°c thao t√°c database v·ªõi h·ªó tr·ª£ Vietnamese collation
- Flutter 3.35.1+ v·ªõi h·ªó tr·ª£ WebSocket cho c·∫≠p nh·∫≠t th·ªùi gian th·ª±c
- Dart HTTP client cho giao ti·∫øp API v·ªõi ABP backend
- ABP Memory Cache cho cache d·ªØ li·ªáu menu v√† recipe
- **web_socket_channel**: ^2.4.0 package cho k·∫øt n·ªëi WebSocket Flutter
- **provider**: ^6.1.1 cho qu·∫£n l√Ω state Flutter

**Bi·∫øn M√¥i tr∆∞·ªùng B·∫Øt bu·ªôc**:
```bash
# C·∫•u h√¨nh Backend API
APP_CORS_ORIGINS=http://localhost:3000,https://localhost:3001
ABP_LICENSE_CODE=your-abp-license-code
DEFAULT_CONNECTION_STRING=Host=localhost;Database=SmartRestaurant;Username=postgres;Password=postgres

# C·∫•u h√¨nh SignalR
SIGNALR_CORS_ORIGINS=http://localhost:3000,https://localhost:3001
SIGNALR_HUB_TIMEOUT=30000

# C·∫•u h√¨nh Flutter Mobile
API_BASE_URL=https://localhost:44346
WEBSOCKET_URL=wss://localhost:44346/hubs
APP_ENV=development
API_TIMEOUT_SECONDS=30

# T√≠ch h·ª£p B·∫øp
KITCHEN_PRINTER_IP=192.168.1.100
KITCHEN_PRINTER_PORT=9100
PRINT_TIMEOUT_SECONDS=10

# C·∫•u h√¨nh Cache
MEMORY_CACHE_SIZE_MB=256
MENU_CACHE_EXPIRATION_MINUTES=60
RECIPE_CACHE_EXPIRATION_MINUTES=120
```

**C·∫•u tr√∫c File v√† Quy t·∫Øc ƒê·∫∑t t√™n**:
```
Backend:
- aspnet-core/src/SmartRestaurant.Domain/Orders/ (entities v√† domain services)
- aspnet-core/src/SmartRestaurant.Application/Orders/ (application services v√† DTOs)
- aspnet-core/src/SmartRestaurant.HttpApi/Hubs/ (SignalR hubs)

Flutter Mobile:
- flutter_mobile/lib/features/orders/ (t√≠nh nƒÉng qu·∫£n l√Ω ƒë∆°n h√†ng)
- flutter_mobile/lib/features/orders/screens/ (m√†n h√¨nh workflow ƒë∆°n h√†ng)
- flutter_mobile/lib/features/orders/widgets/ (widgets ƒë∆°n h√†ng c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng)
- flutter_mobile/lib/features/orders/services/ (d·ªãch v·ª• API client)
- flutter_mobile/lib/shared/models/ (m√¥ h√¨nh d·ªØ li·ªáu ƒë∆°n h√†ng)
```

### Ng·ªØ c·∫£nh Story Tr∆∞·ªõc ƒë√≥
T·ª´ Epic 4 ho√†n th√†nh - H·ªá th·ªëng nguy√™n li·ªáu ƒëa ƒë∆°n v·ªã ƒë√£ thi·∫øt l·∫≠p n·ªÅn t·∫£ng cho:
- Theo d√µi t√¨nh tr·∫°ng c√≥ s·∫µn c·ªßa m√≥n ƒÉn d·ª±a tr√™n m·ª©c t·ªìn kho nguy√™n li·ªáu
- T√≠ch h·ª£p t√≠nh to√°n chi ph√≠ cho ƒë·ªãnh gi√° ƒë∆°n h√†ng ch√≠nh x√°c
- T·ªëi ∆∞u h√≥a quy tr√¨nh b·∫øp d·ª±a tr√™n y√™u c·∫ßu chu·∫©n b·ªã nguy√™n li·ªáu
- **H·ªá th·ªëng ƒë∆°n v·ªã mua h√†ng ƒëa c·∫•p v√† chuy·ªÉn ƒë·ªïi ƒë∆°n v·ªã c∆° s·ªü ƒë√£ s·∫µn s√†ng cho vi·ªác tr·ª´ kho**
- **Li√™n k·∫øt MenuItem-Ingredient c∆° b·∫£n ƒë√£ c√≥ nh∆∞ng c·∫ßn n√¢ng c·∫•p th√†nh MenuItemIngredient nhi·ªÅu-nhi·ªÅu**

### Chi·∫øn l∆∞·ª£c Di chuy·ªÉn
**T·ª´ MenuItem.PrimaryIngredientId sang H·ªá th·ªëng MenuItemIngredient**:
1. **Giai ƒëo·∫°n 1**: T·∫°o b·∫£ng MenuItemIngredient v·ªõi migration script
2. **Giai ƒëo·∫°n 2**: Di chuy·ªÉn d·ªØ li·ªáu PrimaryIngredientId hi·ªán c√≥ sang records MenuItemIngredient
3. **Giai ƒëo·∫°n 3**: C·∫≠p nh·∫≠t logic ·ª©ng d·ª•ng ƒë·ªÉ s·ª≠ d·ª•ng m·ªëi quan h·ªá nhi·ªÅu-nhi·ªÅu m·ªõi
4. **Giai ƒëo·∫°n 4**: ƒê√°nh d·∫•u PrimaryIngredientId l√† Obsolete v·ªõi kh·∫£ nƒÉng t∆∞∆°ng th√≠ch ng∆∞·ª£c
5. **Giai ƒëo·∫°n 5**: Lo·∫°i b·ªè PrimaryIngredientId trong phi√™n b·∫£n t∆∞∆°ng lai (sau khi ho√†n th√†nh story)

**M·∫´u Migration Script**:
```sql
-- T·∫°o records MenuItemIngredient t·ª´ PrimaryIngredientId hi·ªán c√≥
INSERT INTO MenuItemIngredients (Id, MenuItemId, IngredientId, RequiredQuantity, IsOptional, CreationTime)
SELECT 
    gen_random_uuid(),
    mi.Id,
    mi.PrimaryIngredientId,
    COALESCE(mi.RequiredQuantity, 1),
    false,
    NOW()
FROM MenuItems mi 
WHERE mi.PrimaryIngredientId IS NOT NULL;
```

### M√¥ h√¨nh D·ªØ li·ªáu v√† M·ªëi quan h·ªá

**Order Entity** (ƒë·ªô ph·ª©c t·∫°p Level 2):
```csharp
public class Order : FullAuditedAggregateRoot<Guid>
{
    public string OrderNumber { get; set; }         // S·ªë hi·ªÉn th·ªã (v√≠ d·ª•: #001)
    public Guid TableId { get; set; }               // Tham chi·∫øu b√†n
    public OrderType OrderType { get; set; }        // ƒÇn t·∫°i ch·ªó/Mang v·ªÅ
    public OrderStatus Status { get; set; }         // Workflow tr·∫°ng th√°i
    public decimal TotalAmount { get; set; }        // Gi√° VND
    public string Notes { get; set; }               // Y√™u c·∫ßu kh√°ch h√†ng
    // Navigation: Table, collection OrderItems
}

public enum OrderStatus 
{
    Pending, Confirmed, Preparing, Ready, Served, Paid
}
```

**MenuItemIngredient Entity** (M·ªõi cho Qu·∫£n l√Ω Recipe):
```csharp
public class MenuItemIngredient : Entity<Guid>
{
    public Guid MenuItemId { get; set; }           // Tham chi·∫øu MenuItem
    public Guid IngredientId { get; set; }         // Tham chi·∫øu Ingredient
    public int RequiredQuantity { get; set; }      // S·ªë l∆∞·ª£ng theo ƒë∆°n v·ªã c∆° s·ªü (v√≠ d·ª•: 200g)
    public bool IsOptional { get; set; } = false;  // C·ªù nguy√™n li·ªáu t√πy ch·ªçn
    
    // Navigation properties
    public virtual MenuItem MenuItem { get; set; }
    public virtual Ingredient Ingredient { get; set; }
}
```

**MenuItem Entity N√¢ng c·∫•p** (C·∫≠p nh·∫≠t cho Recipe Support):
```csharp
public class MenuItem : FullAuditedEntity<Guid>
{
    // ... c√°c thu·ªôc t√≠nh hi·ªán c√≥ ...
    
    // M·ªëi quan h·ªá n√¢ng c·∫•p
    public virtual ICollection<MenuItemIngredient> Ingredients { get; set; } // Nhi·ªÅu-nhi·ªÅu qua bridge
    public virtual ICollection<OrderItem> OrderItems { get; set; }
    
    // Deprecated nh∆∞ng duy tr√¨ ƒë·ªÉ t∆∞∆°ng th√≠ch ng∆∞·ª£c
    [Obsolete("S·ª≠ d·ª•ng collection Ingredients thay th·∫ø")]
    public Guid? PrimaryIngredientId { get; set; }
    [Obsolete("S·ª≠ d·ª•ng collection Ingredients thay th·∫ø")]
    public int? RequiredQuantity { get; set; }
}
```

**T√≠ch h·ª£p SignalR**:
[Ngu·ªìn: docs/architecture/core-workflows.md#Order-Processing-Workflow]
- KitchenHub ph√°t s√≥ng ƒë∆°n h√†ng m·ªõi v√† thay ƒë·ªïi tr·∫°ng th√°i
- TableManagementHub qu·∫£n l√Ω c·∫≠p nh·∫≠t tr·∫°ng th√°i b√†n th·ªùi gian th·ª±c
- OrderStatusHub g·ª≠i th√¥ng b√°o cho nh√¢n vi√™n ph·ª•c v·ª• v·ªÅ tr·∫°ng th√°i ƒë∆°n h√†ng s·∫µn s√†ng

### Y√™u c·∫ßu Logic Kinh doanh

**Quy t·∫Øc Chuy·ªÉn ƒë·ªïi Tr·∫°ng th√°i** [Ngu·ªìn: docs/architecture/data-models.md#Order]:
- Ch·ªù ‚Üí X√°c nh·∫≠n (h√†nh ƒë·ªông nh√¢n vi√™n ph·ª•c v·ª•)
- X√°c nh·∫≠n ‚Üí ƒêang chu·∫©n b·ªã (h√†nh ƒë·ªông b·∫øp)
- ƒêang chu·∫©n b·ªã ‚Üí S·∫µn s√†ng (h√†nh ƒë·ªông b·∫øp)
- S·∫µn s√†ng ‚Üí ƒê√£ ph·ª•c v·ª• (x√°c nh·∫≠n nh√¢n vi√™n ph·ª•c v·ª•)
- ƒê√£ ph·ª•c v·ª• ‚Üí ƒê√£ thanh to√°n (ho√†n th√†nh thanh to√°n)

**T√≠ch h·ª£p B·∫øp** [Ngu·ªìn: docs/architecture/core-workflows.md#Kitchen-Workflow]:
- T·ª± ƒë·ªông in bill b·∫øp khi x√°c nh·∫≠n ƒë∆°n h√†ng
- Ch·ª©c nƒÉng in l·∫°i th·ªß c√¥ng cho c√°c m√≥n c·ª• th·ªÉ
- Ph√°t s√≥ng tr·∫°ng th√°i th·ªùi gian th·ª±c l√™n m√†n h√¨nh b·∫øp
- ∆Øu ti√™n ƒë∆°n h√†ng FIFO v·ªõi t·ªëi ∆∞u h√≥a n·∫•u nhanh
- **T·ª± ƒë·ªông tr·ª´ kho khi ƒë∆°n h√†ng ƒë∆∞·ª£c x√°c nh·∫≠n v·ªõi h·ªó tr·ª£ kho √¢m**
- **H·ªá th·ªëng c·∫£nh b√°o thi·∫øu nguy√™n li·ªáu tr∆∞·ªõc khi x√°c nh·∫≠n ƒë∆°n**

### Th√¥ng s·ªë k·ªπ thu·∫≠t API

**OrderAppService Endpoints** [Ngu·ªìn: docs/architecture/backend-architecture.md#API-Endpoints]:
```csharp
// ABP t·ª± ƒë·ªông t·∫°o REST endpoints:
GET /api/app/order                              // Li·ªát k√™ ƒë∆°n h√†ng v·ªõi l·ªçc
POST /api/app/order                             // T·∫°o ƒë∆°n h√†ng m·ªõi v·ªõi validation recipe v√† c·∫£nh b√°o thi·∫øu nguy√™n li·ªáu
PUT /api/app/order/{id}/status                  // C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng v·ªõi tr·ª´ kho t·ª± ƒë·ªông d·ª±a tr√™n recipe
POST /api/app/order/{id}/print-kitchen-bill     // Ch·ª©c nƒÉng in th·ªß c√¥ng
POST /api/app/order/{id}/payment                // T√≠ch h·ª£p thanh to√°n (Epic 8)
GET /api/app/order/check-missing-ingredients    // Ki·ªÉm tra nguy√™n li·ªáu thi·∫øu cho items ƒë∆°n h√†ng
GET /api/app/order/{id}/missing-ingredients     // L·∫•y nguy√™n li·ªáu thi·∫øu cho ƒë∆°n h√†ng c·ª• th·ªÉ
POST /api/app/recipe/validate-availability      // Validate t√≠nh kh·∫£ d·ª•ng nguy√™n li·ªáu recipe cho m√≥n ƒÉn
```

**Ph∆∞∆°ng th·ª©c RecipeManager Domain Service**:
```csharp
// Ph∆∞∆°ng th·ª©c qu·∫£n l√Ω recipe:
Task<List<MissingIngredientDto>> CheckIngredientAvailabilityAsync(Guid menuItemId);
Task<Dictionary<Guid, int>> CalculateRequiredIngredientsAsync(List<OrderItemDto> orderItems);
Task ProcessAutomaticDeductionAsync(Guid orderId); // H·ªó tr·ª£ kho √¢m
Task<List<MissingIngredientDto>> GetMissingIngredientsAsync(Guid orderId);
```

### Y√™u c·∫ßu Ki·∫øn tr√∫c Flutter Mobile

**Ki·∫øn tr√∫c Flutter Widget** [Ngu·ªìn: docs/architecture/unified-project-structure.md#Flutter-Architecture]:
- Widget Stepper cho quy tr√¨nh ƒë∆°n h√†ng nhi·ªÅu b∆∞·ªõc
- GridView cho hi·ªÉn th·ªã b√†n v√† m√≥n ƒÉn
- ListView cho items ƒë∆°n h√†ng v√† l·ªãch s·ª≠ tr·∫°ng th√°i
- SnackBar/Toast widgets cho th√¥ng b√°o th·ªùi gian th·ª±c
- SearchDelegate cho t√¨m ki·∫øm ti·∫øng Vi·ªát

**Qu·∫£n l√Ω State Flutter (Provider/BLoC)**:
```dart
class OrderState {
  final Order? currentOrder;
  final Table? selectedTable;  
  final List<MenuItem> availableMenuItems;
  final List<Order> orderHistory;
  final List<MissingIngredient> missingIngredients; // Nguy√™n li·ªáu thi·∫øu cho c·∫£nh b√°o
  final bool loading;
  final bool isConnected; // Tr·∫°ng th√°i k·∫øt n·ªëi WebSocket
}

class MissingIngredient {
  final String ingredientName;
  final String menuItemName; 
  final int requiredQuantity;
  final int currentStock;
  final String unit;
  final bool isOptional;
  
  String get displayText => "$menuItemName: thi·∫øu $ingredientName (c·∫ßn ${requiredQuantity}${unit})";
  String get stockDisplayText => "$ingredientName: ${currentStock}${unit}";
}
```

**T√≠ch h·ª£p WebSocket**:
- S·ª≠ d·ª•ng package web_socket_channel cho giao ti·∫øp th·ªùi gian th·ª±c
- Tri·ªÉn khai t·ª± ƒë·ªông k·∫øt n·ªëi l·∫°i v·ªõi exponential backoff
- X·ª≠ l√Ω tr·∫°ng th√°i k·∫øt n·ªëi trong UI (ch·ªâ b√°o k·∫øt n·ªëi/ng·∫Øt k·∫øt n·ªëi)

### Ti√™u chu·∫©n Ki·ªÉm th·ª≠

**V·ªã tr√≠ File Test** [Ngu·ªìn: docs/architecture/testing-strategy.md#Test-Structure]:
```
Backend Tests:
- test/SmartRestaurant.Domain.Tests/Orders/OrderManager_Tests.cs
- test/SmartRestaurant.Application.Tests/Orders/OrderAppService_Tests.cs

Flutter Mobile Tests:
- flutter_mobile/test/features/orders/screens/table_selection_screen_test.dart
- flutter_mobile/test/features/orders/screens/menu_browser_screen_test.dart
- flutter_mobile/test/features/orders/widgets/order_item_widget_test.dart
- flutter_mobile/test/features/orders/services/order_api_service_test.dart
- flutter_mobile/test/features/orders/widgets/missing_ingredients_warning_test.dart
- flutter_mobile/test/features/orders/services/recipe_service_test.dart

Integration Tests:
- flutter_mobile/integration_test/order_workflow_test.dart
- flutter_mobile/integration_test/missing_ingredients_workflow_test.dart
```

**Y√™u c·∫ßu Testing Framework**:
- Backend: xUnit v·ªõi ABP test framework, Shouldly assertions
- Flutter Mobile: Flutter test framework v·ªõi mockito cho mocking
- Widget Testing: Flutter widget testing cho UI components v√† c·∫£nh b√°o thi·∫øu nguy√™n li·ªáu
- Integration Testing: Flutter integration testing cho workflows ho√†n ch·ªânh bao g·ªìm qu·∫£n l√Ω recipe
- Recipe Testing: Ki·ªÉm th·ª≠ to√†n di·ªán cho t√≠nh to√°n MenuItemIngredient v√† k·ªãch b·∫£n kho √¢m
- Y√™u c·∫ßu test coverage: ‚â• 90% cho business logic components bao g·ªìm qu·∫£n l√Ω recipe

### C√¢n nh·∫Øc Hi·ªáu su·∫•t

**T·ªëi ∆∞u Database**:
- Index tr√™n Orders(TableId, Status) cho truy v·∫•n hi·ªáu qu·∫£
- Index tr√™n MenuItemIngredients(MenuItemId, IngredientId) cho t√¨m ki·∫øm recipe
- Include OrderItems v·ªõi MenuItem ƒë·ªÉ tr√°nh N+1 queries
- Include MenuItemIngredients v·ªõi Ingredient cho t√≠nh to√°n recipe
- S·ª≠ d·ª•ng ABP's IQueryable extensions cho pagination

**Hi·ªáu su·∫•t Mobile**:
- WebSocket connection pooling cho ng∆∞·ªùi d√πng di ƒë·ªông ƒë·ªìng th·ªùi
- Debounced status updates ƒë·ªÉ tr√°nh l√†m ng·∫≠p UI tr√™n mobile
- Local caching cho d·ªØ li·ªáu menu v√† th√¥ng tin recipe v·ªõi t√≠ch h·ª£p SQLite
- Lazy loading cho danh s√°ch menu l·ªõn v√† l·ªãch s·ª≠ ƒë∆°n h√†ng
- T·ªëi ∆∞u h√¨nh ·∫£nh cho ·∫£nh m√≥n ƒÉn
- T√≠nh to√°n nguy√™n li·ªáu thi·∫øu hi·ªáu qu·∫£ ƒë·ªÉ gi·∫£m thi·ªÉu API calls
- Cache d·ªØ li·ªáu recipe locally ƒë·ªÉ gi·∫£m network requests khi t·∫°o ƒë∆°n h√†ng

**Server-side Caching (ABP Memory Cache)**:
- Cache c√°c m√≥n ƒÉn v√† danh m·ª•c ƒë·ªÉ gi·∫£m database queries
- Cache c·∫•u h√¨nh recipe ƒë·ªÉ tƒÉng t·ªëc t√≠nh to√°n nguy√™n li·ªáu thi·∫øu
- Cache user permissions v√† roles cho faster authorization checks
- Configurable cache expiration policies cho c√°c lo·∫°i d·ªØ li·ªáu kh√°c nhau

### Y√™u c·∫ßu B·∫£o m·∫≠t

[Ngu·ªìn: docs/architecture/backend-architecture.md#Authentication-and-Authorization]
```csharp
[Authorize(SmartRestaurantPermissions.Orders.Create)]  // T·∫°o ƒë∆°n h√†ng
[Authorize(SmartRestaurantPermissions.Kitchen.View)]   // Truy c·∫≠p b·∫øp
[Authorize(SmartRestaurantPermissions.Payments.Process)] // X·ª≠ l√Ω thanh to√°n
```

### H·ªó tr·ª£ B·∫£n ƒë·ªãa h√≥a
- T·∫•t c·∫£ UI text b·∫±ng ti·∫øng Vi·ªát v·ªõi h·ªá th·ªëng localization ABP
- ƒê·ªãnh d·∫°ng ti·ªÅn t·ªá: ƒê·ªìng Vi·ªát Nam (‚Ç´) v·ªõi ph√¢n c√°ch h√†ng ngh√¨n ph√π h·ª£p
- Ng√†y/gi·ªù: ƒê·ªãnh d·∫°ng Vi·ªát Nam (dd/MM/yyyy HH:mm)
- Th√¥ng b√°o l·ªói: Th√¥ng b√°o validation business th√¢n thi·ªán v·ªõi ng∆∞·ªùi d√πng Vi·ªát

## B·∫£n ghi Dev Agent

### M√¥ h√¨nh Agent ƒë∆∞·ª£c s·ª≠ d·ª•ng
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Tham chi·∫øu Debug Log
Kh√¥ng c√≥ debug log ƒë∆∞·ª£c y√™u c·∫ßu - story ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai ho√†n ch·ªânh

### Danh s√°ch Ghi ch√∫ Ho√†n th√†nh
- ‚úÖ **Backend ho√†n ch·ªânh** (BE-1 ƒë·∫øn BE-9): Order management system v·ªõi domain entities, services, SignalR hubs, recipe system, v√† inventory integration
- ‚úÖ **Flutter Mobile ho√†n ch·ªânh** (FLUTTER-1 ƒë·∫øn FLUTTER-7): Multi-step order workflow v·ªõi table selection, menu browsing, order confirmation, status tracking, v√† missing ingredients warnings
- ‚úÖ **Testing ho√†n ch·ªânh** (BE-6): Unit tests, integration tests, performance tests cho to√†n b·ªô business logic
- üîÑ **QR Payment Integration**: ƒê√£ c√≥ VietQR printing v√† payment processing integration

### Danh s√°ch File
**Backend Files:**
- aspnet-core/src/SmartRestaurant.Domain/Orders/Order.cs
- aspnet-core/src/SmartRestaurant.Domain/Orders/OrderItem.cs  
- aspnet-core/src/SmartRestaurant.Domain/Orders/OrderManager.cs
- aspnet-core/src/SmartRestaurant.Domain/Orders/Payment.cs
- aspnet-core/src/SmartRestaurant.Application/Orders/OrderAppService.cs
- aspnet-core/src/SmartRestaurant.Domain/MenuManagement/RecipeManager.cs
- aspnet-core/src/SmartRestaurant.Domain/MenuManagement/MenuItemIngredients/MenuItemIngredient.cs
- aspnet-core/src/SmartRestaurant.HttpApi.Host/Hubs/KitchenHub.cs
- aspnet-core/src/SmartRestaurant.HttpApi.Host/Hubs/OrderStatusHub.cs
- aspnet-core/src/SmartRestaurant.HttpApi.Host/Hubs/TableManagementHub.cs

**Flutter Mobile Files:**
- flutter_mobile/lib/features/order/screens/table_detail_screen.dart
- flutter_mobile/lib/features/order/screens/menu_screen.dart
- flutter_mobile/lib/features/order/screens/order_screen.dart
- flutter_mobile/lib/features/order/widgets/table_card.dart
- flutter_mobile/lib/features/order/widgets/menu_item_card.dart
- flutter_mobile/lib/features/order/widgets/order_item_card.dart
- flutter_mobile/lib/features/order/widgets/ingredient_verification_dialog.dart
- flutter_mobile/lib/core/services/order_service.dart
- flutter_mobile/lib/core/utils/qr_payment_utils.dart
- flutter_mobile/lib/core/utils/invoice_layout_utils.dart

**Database Migrations:**
- aspnet-core/src/SmartRestaurant.EntityFrameworkCore/Migrations/20250904085436_AddOrderManagement.cs
- aspnet-core/src/SmartRestaurant.EntityFrameworkCore/Migrations/20250904095828_AddMenuItemIngredients.cs
- aspnet-core/src/SmartRestaurant.EntityFrameworkCore/Migrations/20250913010532_AddPaymentEntity.cs

**Test Files:**
- aspnet-core/test/SmartRestaurant.Domain.Tests/Orders/OrderManager_Tests.cs
- aspnet-core/test/SmartRestaurant.Domain.Tests/MenuManagement/RecipeManager_Tests.cs
- aspnet-core/test/SmartRestaurant.Domain.Tests/Orders/Order_Tests.cs
- aspnet-core/test/SmartRestaurant.Application.Tests/Orders/OrderAppService_Tests.cs
- aspnet-core/test/SmartRestaurant.Application.Tests/Orders/OrderSignalR_Performance_Tests.cs

## K·∫øt qu·∫£ QA

_K·∫øt qu·∫£ t·ª´ QA Agent review tri·ªÉn khai story ho√†n ch·ªânh s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn ·ªü ƒë√¢y_

## Nh·∫≠t k√Ω Thay ƒë·ªïi

| Ng√†y | Phi√™n b·∫£n | M√¥ t·∫£ | T√°c gi·∫£ |
|------|-----------|-------|---------|
| 2025-09-04 | 1.0 | T·∫°o story ban ƒë·∫ßu v·ªõi m·∫´u Level 2 | Bob (Scrum Master) |
| 2025-09-04 | 1.1 | Th√™m h·ªó tr·ª£ song ng·ªØ ti·∫øng Vi·ªát | Bob (Scrum Master) |
| 2025-09-04 | 1.2 | Th√™m t√≠ch h·ª£p t·ª± ƒë·ªông tr·ª´ kho | Bob (Scrum Master) |
| 2025-09-04 | 1.3 | Chuy·ªÉn t·ª´ Angular web sang t·∫≠p trung Flutter mobile | Bob (Scrum Master) |
| 2025-09-04 | 1.4 | Th√™m h·ªá th·ªëng Recipe Management ho√†n ch·ªânh v·ªõi entity MenuItemIngredient v√† h·ªó tr·ª£ kho √¢m | Bob (Scrum Master) |
| 2025-09-04 | 1.5 | Lo·∫°i b·ªè dependency in-memory cache, thay b·∫±ng ABP Memory Cache | Bob (Scrum Master) |
| 2025-09-04 | 1.6 | S·ª≠a c√°c v·∫•n ƒë·ªÅ validation: Th√™m dependencies r√µ r√†ng, bi·∫øn m√¥i tr∆∞·ªùng, chu·∫©n h√≥a tham chi·∫øu, n√¢ng cao edge cases, chi·∫øn l∆∞·ª£c migration, t√≠nh nƒÉng accessibility | Sarah (Product Owner) |
| 2025-09-04 | 1.7 | T·∫°o phi√™n b·∫£n ti·∫øng Vi·ªát t·ª± nhi√™n t·ª´ story g·ªëc | Sarah (Product Owner) |