# CÃ¢u chuyá»‡n ngÆ°á»i dÃ¹ng 5.2: Báº£ng Ä‘iá»u khiá»ƒn Quáº£n lÃ½ Æ¯u tiÃªn Báº¿p

**Epic**: Epic 5 - Xá»­ lÃ½ ÄÆ¡n hÃ ng & Phá»‘i há»£p Báº¿p  
**Äiá»ƒm Story**: 35-50 (Template cáº¥p 2 - Logic Nghiá»‡p vá»¥)  
**Æ¯u tiÃªn**: Cao  
**Tráº¡ng thÃ¡i**: Báº£n nhÃ¡p
**NgÆ°á»i Ä‘Æ°á»£c giao**: NhÃ³m PhÃ¡t triá»ƒn  
**Sprint**: ChÆ°a xÃ¡c Ä‘á»‹nh

## ThÃ´ng tin Template

### Cáº¥p Ä‘á»™ Template
**Cáº¥p Ä‘á»™ Ä‘Ã£ chá»n**: Cáº¥p 2 (Template Logic Nghiá»‡p vá»¥)

### PhÃ¢n tÃ­ch Äá»™ phá»©c táº¡p
- **Äá»™ phá»©c táº¡p Entity**: Logic Nghiá»‡p vá»¥ - Dashboard báº¿p vá»›i logic Æ°u tiÃªn Ä‘Æ¡n giáº£n, sáº¯p xáº¿p theo thá»i gian vÃ  loáº¡i mÃ³n
- **Äá»™ phá»©c táº¡p UI**: Quy trÃ¬nh lÃ m viá»‡c - Hiá»ƒn thá»‹ danh sÃ¡ch Ä‘Æ¡n hÃ ng vá»›i tráº¡ng thÃ¡i vÃ  lá»c theo tráº¡m báº¿p
- **YÃªu cáº§u Ká»¹ thuáº­t**: Logic Nghiá»‡p vá»¥ - CÃ¡c dá»‹ch vá»¥ á»©ng dá»¥ng tÃ¹y chá»‰nh vá»›i logic tÃ­nh toÃ¡n Æ°u tiÃªn Ä‘Æ¡n giáº£n

### Æ¯á»›c tÃ­nh Äiá»ƒm Story
**Pháº¡m vi**: 35-50 Ä‘iá»ƒm dá»±a trÃªn Ä‘á»™ phá»©c táº¡p template cáº¥p 2

### Tham chiáº¿u Template
- **Template Backend**: templates/backend-template-level2.md
- **Template Frontend**: templates/frontend-template-level2.md  
- **Template Task**: .bmad-core/templates/level2-tasks.yaml

## Phá»¥ thuá»™c Story

**Äiá»u kiá»‡n tiÃªn quyáº¿t**:
- âœ… **Story 5.1 - Quy trÃ¬nh Quáº£n lÃ½ ÄÆ¡n hÃ ng NhÃ¢n viÃªn Phá»¥c vá»¥**: Báº®T BUá»˜C - CÃ¡c entity Ä‘Æ¡n hÃ ng, quy trÃ¬nh OrderStatus, vÃ  SignalR hubs pháº£i hoáº¡t Ä‘á»™ng
- âš ï¸ **Dá»¯ liá»‡u MenuItem vá»›i TrÆ°á»ng Boolean**: PHá»¤ THUá»˜C CHÆ¯A XÃC NHáº¬N - Entity MenuItem cáº§n 2 trÆ°á»ng boolean: IsQuickCook vÃ  RequiresCooking (Task BE-0 sáº½ thÃªm cÃ¡c trÆ°á»ng nÃ y náº¿u chÆ°a cÃ³ tá»« Story 5.1)

**Äiá»ƒm tÃ­ch há»£p tÆ°Æ¡ng lai**:
- ğŸ”„ **Epic 8 - Xá»­ lÃ½ Thanh toÃ¡n**: TÃ­ch há»£p tÆ°Æ¡ng lai cho quy trÃ¬nh hoÃ n thÃ nh Ä‘Æ¡n hÃ ng
- ğŸ”„ **Epic 9 - BÃ¡o cÃ¡o PhÃ¢n tÃ­ch**: Sá»‘ liá»‡u hiá»‡u suáº¥t vÃ  bÃ¡o cÃ¡o hiá»‡u quáº£ báº¿p

## MÃ´ táº£ Story

**Vá»›i tÆ° cÃ¡ch lÃ ** nhÃ¢n viÃªn báº¿p,  
**TÃ´i muá»‘n** xem cÃ¡c bÃ n cÃ³ mÃ³n cáº§n náº¥u (RequiresCooking=true) chÆ°a phá»¥c vá»¥ Ä‘Æ°á»£c Æ°u tiÃªn theo thá»i gian gá»i mÃ³n vÃ  tá»‘c Ä‘á»™ cháº¿ biáº¿n,  
**Äá»ƒ** tÃ´i cÃ³ thá»ƒ táº­p trung vÃ o cháº¿ biáº¿n nhá»¯ng mÃ³n pháº£i náº¥u, bá» qua mÃ³n láº¥y sáºµn, vÃ  tá»‘i Æ°u thá»© tá»± náº¥u Äƒn theo Ä‘á»™ Æ°u tiÃªn.

## TiÃªu chÃ­ Cháº¥p nháº­n

1. **Hiá»ƒn thá»‹ ÄÆ¡n hÃ ng theo BÃ n**: Hiá»ƒn thá»‹ Ä‘Æ¡n hÃ ng theo bÃ n cho cÃ¡c mÃ³n cÃ³ RequiresCooking=true chÆ°a phá»¥c vá»¥, sáº¯p xáº¿p theo thá»i gian gá»i

2. **Chá»‰ bÃ¡o MÃ³n náº¥u nhanh**: ÄÃ¡nh dáº¥u mÃ³n náº¥u nhanh (rau, Ä‘áº­u phá»¥, mÃ³n nháº¹) vá»›i chá»‰ bÃ¡o Æ°u tiÃªn trá»±c quan

3. **Æ¯á»›c tÃ­nh Thá»i gian Náº¥u**: Æ¯á»›c tÃ­nh thá»i gian náº¥u cho tá»«ng mÃ³n vá»›i má»©c Ä‘á»™ kháº©n cáº¥p Ä‘Æ°á»£c mÃ£ hÃ³a mÃ u sáº¯c

4. **Gá»£i Ã½ Chuáº©n bá»‹ ThÃ´ng minh**: Gá»£i Ã½ chuáº©n bá»‹ thÃ´ng minh cÃ¢n báº±ng Æ°u tiÃªn Ä‘Æ¡n hÃ ng Ä‘áº¿n trÆ°á»›c vá»›i cÆ¡ há»™i phá»¥c vá»¥ nhanh

5. **Cáº­p nháº­t Thá»i gian thá»±c**: Cáº­p nháº­t thá»i gian thá»±c khi mÃ³n Ä‘Æ°á»£c hoÃ n thÃ nh vÃ  phá»¥c vá»¥ cho bÃ n

6. **Æ¯u tiÃªn BÃ n Trá»‘ng**: BÃ n chÆ°a cÃ³ mÃ³n nÃ o hoáº·c chá»‰ cÃ³ 1 mÃ³n Ä‘Æ°á»£c Æ°u tiÃªn Ä‘á»ƒ trÃ¡nh khÃ¡ch chá» mÃ  khÃ´ng cÃ³ gÃ¬ Äƒn

7. **Sáº¯p xáº¿p NÃ¢ng cao**: Thuáº­t toÃ¡n sáº¯p xáº¿p Ä‘a cáº¥p theo thá»© tá»± Æ°u tiÃªn: mÃ³n náº¥u nhanh â†’ bÃ n chÆ°a cÃ³ mÃ³n â†’ bÃ n tá»›i trÆ°á»›c

## Nhiá»‡m vá»¥ / Nhiá»‡m vá»¥ phá»¥

### Nhiá»‡m vá»¥ Backend (Cáº¥p 2 - Logic Nghiá»‡p vá»¥)

- [ ] **BE-0**: Cáº­p nháº­t MenuItem Entity vá»›i TrÆ°á»ng Boolean (TC: 2, 4, 6, 7)
  - [ ] ThÃªm thuá»™c tÃ­nh IsQuickCook (bool) vÃ o MenuItem entity
  - [ ] ThÃªm thuá»™c tÃ­nh RequiresCooking (bool) vÃ o MenuItem entity  
  - [ ] Táº¡o migration cho 2 trÆ°á»ng má»›i
  - [ ] Cáº­p nháº­t dá»¯ liá»‡u máº«u cho cÃ¡c mÃ³n Äƒn vá»›i giÃ¡ trá»‹ boolean phÃ¹ há»£p
  - [ ] Cháº¡y migration Ä‘á»ƒ cáº­p nháº­t database schema

- [ ] **BE-1**: Táº¡o Domain Services cho Logic Æ¯u tiÃªn Báº¿p (TC: 1, 4, 6, 7)
  - [ ] Táº¡o KitchenPriorityService vá»›i logic lá»c vÃ  tÃ­nh toÃ¡n Æ°u tiÃªn
  - [ ] Triá»ƒn khai logic lá»c chá»‰ hiá»ƒn thá»‹ mÃ³n RequiresCooking=true
  - [ ] Triá»ƒn khai thuáº­t toÃ¡n sáº¯p xáº¿p Ä‘a cáº¥p cho mÃ³n cáº§n náº¥u:
    - Cáº¥p 1: MÃ³n náº¥u nhanh (IsQuickCook=true) trong danh sÃ¡ch cáº§n náº¥u
    - Cáº¥p 2: BÃ n chÆ°a cÃ³ mÃ³n nÃ o lÃªn trÆ°á»›c  
    - Cáº¥p 3: BÃ n tá»›i trÆ°á»›c (FIFO theo OrderTime)
  - [ ] Táº¡o method CalculateCookingPriorityScore() cho OrderItem cÃ³ RequiresCooking=true
  - [ ] Triá»ƒn khai logic Ä‘áº¿m sá»‘ mÃ³n Ä‘Ã£ phá»¥c vá»¥ cho má»—i bÃ n
  - [ ] Táº¡o method GetCookingOrderItemsSequence() chá»‰ tráº£ vá» mÃ³n cáº§n náº¥u Ä‘Ã£ sáº¯p xáº¿p

- [ ] **BE-2**: Triá»ƒn khai Application Services cho Dashboard Báº¿p (TC: 1, 2, 3, 5, 7)
  - [ ] Táº¡o KitchenDashboardAppService vá»›i cÃ¡c method cho mÃ³n cáº§n náº¥u
  - [ ] ThÃªm GetCookingOrdersAsync() - láº¥y danh sÃ¡ch mÃ³n RequiresCooking=true Ä‘Ã£ sáº¯p xáº¿p
  - [ ] ThÃªm UpdateOrderItemStatusAsync() - cáº­p nháº­t tráº¡ng thÃ¡i mÃ³n cáº§n náº¥u
  - [ ] ThÃªm GetCookingOrdersByStationAsync() - lá»c mÃ³n cáº§n náº¥u theo tráº¡m báº¿p vá»›i sáº¯p xáº¿p Æ°u tiÃªn
  - [ ] Táº¡o GetCookingPriorityOrdersAsync() - Ã¡p dá»¥ng thuáº­t toÃ¡n sáº¯p xáº¿p Ä‘a cáº¥p chá»‰ cho mÃ³n cáº§n náº¥u

- [ ] **BE-3**: Thiáº¿t láº­p SignalR Hub cÆ¡ báº£n (TC: 5)
  - [ ] Táº¡o KitchenHub cho thÃ´ng bÃ¡o thá»i gian thá»±c
  - [ ] ThÃªm method NotifyOrderStatusChanged() 
  - [ ] ThÃªm method NotifyNewOrderReceived()
  - [ ] Cáº¥u hÃ¬nh authorization cho nhÃ¢n viÃªn báº¿p
  - [ ] Thiáº¿t láº­p connection groups theo tráº¡m báº¿p

### Nhiá»‡m vá»¥ Frontend (Cáº¥p 2 - Quy trÃ¬nh lÃ m viá»‡c)

- [ ] **FE-1**: Táº¡o Components cÆ¡ báº£n cho Dashboard Báº¿p (TC: 1, 2, 3)
  - [ ] Táº¡o KitchenDashboardComponent hiá»ƒn thá»‹ danh sÃ¡ch Ä‘Æ¡n hÃ ng
  - [ ] Táº¡o OrderItemCard vá»›i thÃ´ng tin mÃ³n Äƒn vÃ  tráº¡ng thÃ¡i
  - [ ] ThÃªm chá»‰ bÃ¡o mÃ u sáº¯c cho mÃ³n náº¥u nhanh (badge xanh)
  - [ ] ThÃªm chá»‰ bÃ¡o Æ°u tiÃªn bÃ n trá»‘ng (badge Ä‘á»)
  - [ ] Táº¡o filter dropdown cho tráº¡m báº¿p

- [ ] **FE-2**: Triá»ƒn khai SignalR Client Ä‘Æ¡n giáº£n (TC: 5)
  - [ ] Thiáº¿t láº­p SignalR connection service
  - [ ] Láº¯ng nghe sá»± kiá»‡n cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng
  - [ ] Cáº­p nháº­t UI khi cÃ³ Ä‘Æ¡n hÃ ng má»›i
  - [ ] Hiá»ƒn thá»‹ thÃ´ng bÃ¡o khi mÃ³n Ä‘Ã£ hoÃ n thÃ nh
  - [ ] Xá»­ lÃ½ lá»—i káº¿t ná»‘i cÆ¡ báº£n

- [ ] **FE-3**: TÃ­nh nÄƒng Cáº­p nháº­t Tráº¡ng thÃ¡i (TC: 5)
  - [ ] ThÃªm buttons "Báº¯t Ä‘áº§u náº¥u", "HoÃ n thÃ nh" cho má»—i mÃ³n
  - [ ] Táº¡o modal xÃ¡c nháº­n thay Ä‘á»•i tráº¡ng thÃ¡i
  - [ ] Cáº­p nháº­t mÃ u sáº¯c vÃ  tráº¡ng thÃ¡i real-time
  - [ ] Hiá»ƒn thá»‹ thá»i gian Æ°á»›c tÃ­nh hoÃ n thÃ nh
  - [ ] ThÃªm ghi chÃº cho tá»«ng mÃ³n náº¿u cáº§n

### Nhiá»‡m vá»¥ Kiá»ƒm thá»­ (Cáº¥p 2 - Kiá»ƒm thá»­ CÆ¡ báº£n)

- [ ] **TEST-1**: Unit Tests cho Logic Nghiá»‡p vá»¥ (TC: Táº¥t cáº£)
  - [ ] Test KitchenPriorityService - thuáº­t toÃ¡n sáº¯p xáº¿p Ä‘a cáº¥p
  - [ ] Test CalculateAdvancedPriorityScore() vá»›i nhiá»u scenarios
  - [ ] Test sáº¯p xáº¿p: mÃ³n náº¥u nhanh â†’ bÃ n trá»‘ng â†’ bÃ n tá»›i trÆ°á»›c
  - [ ] Test KitchenDashboardAppService methods vá»›i dá»¯ liá»‡u Ä‘Ã£ sáº¯p xáº¿p
  - [ ] Test cases cho cÃ¡c trÆ°á»ng há»£p Ä‘áº·c biá»‡t: bÃ n cÃ³ cÃ¹ng thá»i gian, cÃ¹ng loáº¡i mÃ³n

- [ ] **TEST-2**: Component Tests cho Frontend (TC: 1, 2, 3, 5)
  - [ ] Test KitchenDashboardComponent hiá»ƒn thá»‹ Ä‘Ãºng
  - [ ] Test OrderItemCard vá»›i cÃ¡c tráº¡ng thÃ¡i khÃ¡c nhau
  - [ ] Test filter theo tráº¡m báº¿p hoáº¡t Ä‘á»™ng
  - [ ] Test cáº­p nháº­t tráº¡ng thÃ¡i mÃ³n Äƒn
  - [ ] Test SignalR connection service

## Kiá»ƒm thá»­

### Chiáº¿n lÆ°á»£c Kiá»ƒm thá»­
**PhÆ°Æ¡ng phÃ¡p Kiá»ƒm thá»­ Cáº¥p 2**: Táº­p trung vÃ o validation logic nghiá»‡p vá»¥ vÃ  kiá»ƒm thá»­ chá»©c nÄƒng UI cÆ¡ báº£n

**YÃªu cáº§u Test Coverage**: â‰¥80% cho Domain Services, â‰¥70% cho Application Services, â‰¥60% cho Components

### Framework Unit Testing
- **Backend**: xUnit vá»›i ABP Test Framework, assertions Shouldly
- **Frontend**: Angular TestBed vá»›i Jasmine/Karma
- **Mocking**: NSubstitute cho .NET services, Angular testing utilities cho components

### Integration Testing
- **SignalR Hub Testing**: Mock connections Ä‘á»ƒ validation tÃ­nh nÄƒng real-time
- **Database Integration**: In-memory database cho repository testing
- **API Integration**: ABP Test framework cho application service testing

### Quáº£n lÃ½ Test Data
- **Seed Data**: CÃ¡c MenuItem entities test-specific vá»›i giÃ¡ trá»‹ IsQuickCook/RequiresCooking Ä‘Ã£ biáº¿t
- **Test Scenarios**: CÃ¡c káº¿t há»£p Ä‘Æ¡n hÃ ng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÆ°á»›c cho priority algorithm testing
- **Mock Data**: Cáº¥u hÃ¬nh kitchen station vÃ  table setups

### CÃ¢n nháº¯c Performance Testing
- **Load Testing**: MÃ´ phá»ng nhiá»u kitchen displays káº¿t ná»‘i Ä‘á»“ng thá»i
- **Priority Calculation Performance**: Test thuáº­t toÃ¡n sorting vá»›i datasets Ä‘Æ¡n hÃ ng lá»›n (500+ items)
- **SignalR Connection Handling**: Test cÃ¡c scenarios reconnection vÃ  message queuing

## Ghi chÃº Dev

### HÆ°á»›ng dáº«n Cá»¥ thá»ƒ Template (Cáº¥p 2 - Logic Nghiá»‡p vá»¥)

**Patterns Triá»ƒn khai cho Dashboard Báº¿p:**
- Sá»­ dá»¥ng ABP Application Services vá»›i Domain Services Ä‘Æ¡n giáº£n cho logic Æ°u tiÃªn
- Triá»ƒn khai logic nghiá»‡p vá»¥ tÃ­nh toÃ¡n Æ°u tiÃªn: FIFO + mÃ³n náº¥u nhanh + bÃ n trá»‘ng
- Sá»­ dá»¥ng SignalR Hub cÆ¡ báº£n cho thÃ´ng bÃ¡o real-time
- Entity Framework Core vá»›i queries Ä‘Æ¡n giáº£n cho danh sÃ¡ch Ä‘Æ¡n hÃ ng
- Angular components vá»›i PrimeNG cho hiá»ƒn thá»‹ danh sÃ¡ch

**Dependencies Báº¯t buá»™c cho Há»‡ thá»‘ng Báº¿p:**
- ABP Framework 8.0 vá»›i há»— trá»£ authorization vÃ  localization
- SignalR cho thÃ´ng bÃ¡o thá»i gian thá»±c cÆ¡ báº£n
- Entity Framework Core cho truy váº¥n dá»¯ liá»‡u
- Angular 19 vá»›i PrimeNG components
- **@microsoft/signalr**: ^8.0.0 cho client-side real-time communication

**Cáº¥u hÃ¬nh CÆ¡ báº£n cho Há»‡ thá»‘ng Báº¿p:**
```bash
# Cáº¥u hÃ¬nh Backend cÆ¡ báº£n
DEFAULT_CONNECTION_STRING=Host=localhost;Database=SmartRestaurant;Username=postgres;Password=postgres

# Cáº¥u hÃ¬nh SignalR Ä‘Æ¡n giáº£n
SIGNALR_CORS_ORIGINS=http://localhost:4200
SIGNALR_HUB_TIMEOUT=30000

# Cáº¥u hÃ¬nh Angular Dashboard
API_BASE_URL=https://localhost:44346
WEBSOCKET_URL=wss://localhost:44346/hubs/kitchen
```

**Cáº¥u trÃºc File vÃ  Quy Æ°á»›c Äáº·t tÃªn cho Há»‡ thá»‘ng Báº¿p:**
```
Kiáº¿n trÃºc Backend Báº¿p:
- aspnet-core/src/SmartRestaurant.Domain/Kitchen/ (kitchen domain entities vÃ  services)
- aspnet-core/src/SmartRestaurant.Application/Kitchen/ (kitchen application services vÃ  DTOs)
- aspnet-core/src/SmartRestaurant.HttpApi.Host/Hubs/KitchenPriorityHub.cs (real-time kitchen communication)

Dashboard Frontend Báº¿p:  
- angular/src/app/restaurant-features/kitchen-management/ (kitchen dashboard feature module)
- angular/src/app/restaurant-features/kitchen-management/components/ (kitchen UI components)
- angular/src/app/restaurant-features/kitchen-management/services/ (kitchen API client services)
- angular/src/app/shared/models/kitchen/ (kitchen data models)
```

### Ngá»¯ cáº£nh Story TrÆ°á»›c tá»« Story 5.1
Tá»« viá»‡c hoÃ n thÃ nh Story 5.1 - Há»‡ thá»‘ng quáº£n lÃ½ Ä‘Æ¡n hÃ ng Ä‘Ã£ táº¡o ná»n táº£ng cho:
- CÃ¡c Order entities vá»›i OrderStatus workflow (Pending, Confirmed, Preparing, Ready, Served, Paid)
- SignalR hubs cho real-time communication (KitchenHub, OrderStatusHub, TableManagementHub)
- OrderManager domain service vá»›i business logic cho order processing
- Real-time status tracking vÃ  notification system
- **OrderItem entities vá»›i MenuItem relationships sáºµn sÃ ng cho kitchen priority calculation**
- **MenuItem entity cáº§n thÃªm 2 boolean fields: IsQuickCook vÃ  RequiresCooking**

### MÃ´ hÃ¬nh Dá»¯ liá»‡u ÄÆ¡n giáº£n cho Dashboard Báº¿p

**Sá»­ dá»¥ng Entities cÃ³ sáºµn tá»« Story 5.1:**
- `Order` - Ä‘Æ¡n hÃ ng vá»›i OrderStatus  
- `OrderItem` - mÃ³n trong Ä‘Æ¡n hÃ ng vá»›i quantity vÃ  notes
- `MenuItem` - thÃ´ng tin mÃ³n Äƒn vá»›i 2 boolean fields: IsQuickCook, RequiresCooking
- `Table` - thÃ´ng tin bÃ n Äƒn

**DTO cho Kitchen Dashboard:**
```csharp
public class KitchenOrderItemDto
{
    public Guid OrderId { get; set; }               
    public Guid OrderItemId { get; set; }            
    public string TableNumber { get; set; }        
    public string MenuItemName { get; set; }       
    public int Quantity { get; set; }              
    public DateTime OrderTime { get; set; }        
    public bool IsQuickCook { get; set; }          // Tá»« MenuItem.IsQuickCook
    public bool RequiresCooking { get; set; }      // Tá»« MenuItem.RequiresCooking
    public bool IsEmptyTablePriority { get; set; } // BÃ n cÃ³ Ã­t mÃ³n
    public int ServedDishesCount { get; set; }     // Sá»‘ mÃ³n Ä‘Ã£ phá»¥c vá»¥ cho bÃ n nÃ y
    public int PriorityScore { get; set; }         // Äiá»ƒm Æ°u tiÃªn tá»•ng (Ä‘á»ƒ sáº¯p xáº¿p)
    public OrderItemStatus Status { get; set; }    
}
```

**KitchenPriorityService Domain Service** (Logic nghiá»‡p vá»¥ nÃ¢ng cao):
```csharp
public class KitchenPriorityService : DomainService
{
    // TÃ­nh Ä‘iá»ƒm Æ°u tiÃªn cho tá»«ng OrderItem theo thuáº­t toÃ¡n Ä‘a cáº¥p
    Task<int> CalculateAdvancedPriorityScoreAsync(Guid orderItemId, Guid tableId, bool isQuickCook, bool requiresCooking, DateTime orderTime);
    
    // Láº¥y danh sÃ¡ch Ä‘Ã£ sáº¯p xáº¿p theo Ä‘iá»ƒm Æ°u tiÃªn (cao xuá»‘ng tháº¥p)
    Task<List<KitchenOrderItemDto>> GetPriorizedOrderItemsAsync();
    
    // Kiá»ƒm tra mÃ³n cÃ³ pháº£i náº¥u nhanh khÃ´ng (tá»« MenuItem.IsQuickCook)
    Task<bool> IsQuickCookItemAsync(Guid menuItemId);
    
    // Äáº¿m sá»‘ mÃ³n Ä‘Ã£ phá»¥c vá»¥ cho bÃ n
    Task<int> GetServedDishesCountAsync(Guid tableId);
    
    // Sáº¯p xáº¿p danh sÃ¡ch theo PriorityScore
    Task<List<KitchenOrderItemDto>> SortByAdvancedPriorityAsync(List<KitchenOrderItemDto> items);
}
```

**TÃ­ch há»£p SignalR cho Cáº­p nháº­t Báº¿p Thá»i gian thá»±c**:  
[Nguá»“n: docs/architecture/core-workflows.md#Kitchen-Priority-Management-Workflow]
- KitchenPriorityHub phÃ¡t sÃ³ng thay Ä‘á»•i Æ°u tiÃªn vÃ  cáº­p nháº­t tráº¡ng thÃ¡i náº¥u Äƒn
- Quáº£n lÃ½ káº¿t ná»‘i thá»i gian thá»±c cho nhiá»u hiá»ƒn thá»‹ báº¿p
- NhÃ³m cá»¥ thá»ƒ tráº¡m báº¿p cho thÃ´ng bÃ¡o cÃ³ má»¥c tiÃªu
- TÃ­nh láº¡i Æ°u tiÃªn tá»± Ä‘á»™ng vá»›i domain events

### Logic Nghiá»‡p vá»¥ NÃ¢ng cao cho Dashboard Báº¿p

**Thuáº­t toÃ¡n Sáº¯p xáº¿p Äa cáº¥p:**

**Cáº¥p 0 - Lá»c mÃ³n cáº§n náº¥u (Äiá»u kiá»‡n báº¯t buá»™c):**
- `MenuItem.RequiresCooking = true` â†’ Hiá»ƒn thá»‹ trÃªn dashboard
- `MenuItem.RequiresCooking = false` â†’ KhÃ´ng hiá»ƒn thá»‹ (mÃ³n láº¥y sáºµn)
- Má»¥c Ä‘Ã­ch: Chá»‰ hiá»ƒn thá»‹ mÃ³n pháº£i cháº¿ biáº¿n, bá» qua mÃ³n láº¥y sáºµn

**Cáº¥p 1 - MÃ³n náº¥u nhanh (Priority Score = 100):**
- `MenuItem.IsQuickCook = true` â†’ Score + 100  
- Má»¥c Ä‘Ã­ch: Náº¥u mÃ³n nhanh trÆ°á»›c Ä‘á»ƒ tÄƒng tá»‘c phá»¥c vá»¥ tá»•ng thá»ƒ

**Cáº¥p 2 - BÃ n chÆ°a cÃ³ mÃ³n (Priority Score = 50):**
- BÃ n cÃ³ 0 mÃ³n Ä‘Ã£ phá»¥c vá»¥ â†’ Score + 50
- BÃ n cÃ³ 1 mÃ³n Ä‘Ã£ phá»¥c vá»¥ â†’ Score + 25  
- Má»¥c Ä‘Ã­ch: TrÃ¡nh khÃ¡ch ngá»“i chá» mÃ  khÃ´ng cÃ³ gÃ¬ Äƒn

**Cáº¥p 3 - FIFO (Priority Score = thá»i gian):**
- TÃ­nh Ä‘iá»ƒm dá»±a trÃªn thá»i gian: (now - OrderTime) / 60 (phÃºt)
- ÄÆ¡n Ä‘áº·t trÆ°á»›c sáº½ cÃ³ Ä‘iá»ƒm cao hÆ¡n
- Má»¥c Ä‘Ã­ch: Äáº£m báº£o cÃ´ng báº±ng, ai tá»›i trÆ°á»›c phá»¥c vá»¥ trÆ°á»›c

**CÃ´ng thá»©c tá»•ng Priority Score:**
```
TotalScore = QuickCookScore + EmptyTableScore + TimeScore
(Chá»‰ Ã¡p dá»¥ng cho mÃ³n cÃ³ RequiresCooking = true)
```

**VÃ­ dá»¥ thá»±c táº¿:**
- MÃ³n A: Trá»©ng chiÃªn (RequiresCooking=true, IsQuickCook=true, 100 Ä‘iá»ƒm) + BÃ n trá»‘ng (50) + 15 phÃºt chá» (15) = **165 Ä‘iá»ƒm**
- MÃ³n B: Phá»Ÿ (RequiresCooking=true, IsQuickCook=false, 0 Ä‘iá»ƒm) + BÃ n cÃ³ mÃ³n (0) + 30 phÃºt chá» (30) = **30 Ä‘iá»ƒm**
- MÃ³n C: Bia (RequiresCooking=false) = **KhÃ´ng hiá»ƒn thá»‹** (nhÃ¢n viÃªn phá»¥c vá»¥ tá»± láº¥y)
â†’ Thá»© tá»± Æ°u tiÃªn trÃªn dashboard: MÃ³n A â†’ MÃ³n B

**Hiá»ƒn thá»‹ Dashboard Báº¿p:**
- Danh sÃ¡ch OrderItem Ä‘Æ°á»£c sáº¯p xáº¿p theo Æ°u tiÃªn
- MÃ u sáº¯c vÃ  badges cho tá»«ng loáº¡i Æ°u tiÃªn  
- Filter dropdown theo tráº¡m báº¿p
- Buttons cáº­p nháº­t tráº¡ng thÃ¡i: "Báº¯t Ä‘áº§u náº¥u", "HoÃ n thÃ nh"
- Cáº­p nháº­t real-time qua SignalR khi cÃ³ Ä‘Æ¡n hÃ ng má»›i hoáº·c thay Ä‘á»•i tráº¡ng thÃ¡i

### API ÄÆ¡n giáº£n cho Dashboard Báº¿p

**KitchenDashboardAppService Endpoints:**
```csharp
// ABP tá»± Ä‘á»™ng táº¡o cÃ¡c REST endpoints (LÆ°u Ã½: ÄÆ°á»ng dáº«n chÃ­nh xÃ¡c tuÃ¢n theo quy Æ°á»›c ABP vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘iá»u chá»‰nh trong quÃ¡ trÃ¬nh triá»ƒn khai):
GET /api/app/kitchen-dashboard/cooking-orders               // Láº¥y danh sÃ¡ch mÃ³n cáº§n náº¥u
GET /api/app/kitchen-dashboard/cooking-orders-by-station/{station}  // Lá»c mÃ³n cáº§n náº¥u theo tráº¡m báº¿p  
PUT /api/app/kitchen-dashboard/order-item/{id}/status       // Cáº­p nháº­t tráº¡ng thÃ¡i mÃ³n
```

**KitchenDashboardAppService Methods:**
```csharp
public class KitchenDashboardAppService : ApplicationService
{
    // Láº¥y danh sÃ¡ch mÃ³n cáº§n náº¥u Ä‘Ã£ sáº¯p xáº¿p theo thuáº­t toÃ¡n Æ°u tiÃªn
    Task<List<KitchenOrderItemDto>> GetCookingOrdersAsync();
    
    // Lá»c mÃ³n cáº§n náº¥u theo tráº¡m báº¿p vá»›i sáº¯p xáº¿p Æ°u tiÃªn
    Task<List<KitchenOrderItemDto>> GetCookingOrdersByStationAsync(KitchenStation station);
    
    // Cáº­p nháº­t tráº¡ng thÃ¡i mÃ³n vÃ  tÃ­nh láº¡i Æ°u tiÃªn cho bÃ n Ä‘Ã³
    Task UpdateOrderItemStatusAsync(Guid orderItemId, OrderItemStatus status);
    
    // Láº¥y thá»‘ng kÃª Æ°u tiÃªn cho dashboard mÃ³n cáº§n náº¥u
    Task<CookingStatsDto> GetCookingStatsAsync();
}

public class CookingStatsDto
{
    public int QuickCookItemsCount { get; set; }     // Sá»‘ mÃ³n náº¥u nhanh cáº§n cháº¿ biáº¿n
    public int EmptyTablesCount { get; set; }        // Sá»‘ bÃ n chÆ°a cÃ³ mÃ³n (trong cÃ¡c mÃ³n cáº§n náº¥u)
    public int TotalCookingItems { get; set; }       // Tá»•ng sá»‘ mÃ³n cáº§n náº¥u
    public double AverageWaitingTime { get; set; }   // Thá»i gian chá» trung bÃ¬nh (phÃºt)
}
```

### Kiáº¿n trÃºc Angular ÄÆ¡n giáº£n

**Components chÃ­nh:**
- `KitchenDashboardComponent` - hiá»ƒn thá»‹ danh sÃ¡ch Ä‘Æ¡n hÃ ng
- `OrderItemCardComponent` - hiá»ƒn thá»‹ tá»«ng mÃ³n vá»›i tráº¡ng thÃ¡i vÃ  buttons
- `KitchenFilterComponent` - dropdown lá»c theo tráº¡m báº¿p

**Services:**
- `KitchenDashboardService` - gá»i API Ä‘á»ƒ láº¥y dá»¯ liá»‡u
- `SignalRService` - káº¿t ná»‘i real-time vá»›i backend

**State Management ÄÆ¡n giáº£n:**
```typescript
interface KitchenDashboardState {
  cookingItems: KitchenOrderItemDto[];    // Danh sÃ¡ch mÃ³n cáº§n náº¥u (RequiresCooking=true)
  selectedStation: KitchenStation | null; // Tráº¡m Ä‘ang lá»c
  isLoading: boolean;                     // Äang táº£i dá»¯ liá»‡u
  isConnected: boolean;                   // Tráº¡ng thÃ¡i SignalR
}
```

**TÃ­ch há»£p SignalR CÆ¡ báº£n:**
- Káº¿t ná»‘i Ä‘áº¿n KitchenHub  
- Láº¯ng nghe sá»± kiá»‡n cáº­p nháº­t tráº¡ng thÃ¡i
- Reload danh sÃ¡ch khi cÃ³ thay Ä‘á»•i

### YÃªu cáº§u Báº£o máº­t vÃ  Báº£n Ä‘á»‹a hÃ³a

**Permissions Cáº§n thiáº¿t:**
```csharp
[Authorize(SmartRestaurantPermissions.Kitchen.View)]         // Xem dashboard báº¿p
[Authorize(SmartRestaurantPermissions.Kitchen.UpdateStatus)] // Cáº­p nháº­t tráº¡ng thÃ¡i mÃ³n
```

**Báº£n Ä‘á»‹a hÃ³a Tiáº¿ng Viá»‡t:**
- Táº¥t cáº£ text hiá»ƒn thá»‹ báº±ng tiáº¿ng Viá»‡t
- TÃªn tráº¡m báº¿p: Chung, Láº©u, NÆ°á»›ng, Äá»“ uá»‘ng  
- Tráº¡ng thÃ¡i mÃ³n: Chá», Äang náº¥u, HoÃ n thÃ nh, ÄÃ£ phá»¥c vá»¥
- ThÃ´ng bÃ¡o lá»—i vÃ  xÃ¡c nháº­n báº±ng tiáº¿ng Viá»‡t

## Há»“ sÆ¡ Dev Agent

### MÃ´ hÃ¬nh Agent
**Agent Triá»ƒn khai**: TBD (Sáº½ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong sprint planning)
**Kháº£ nÄƒng Agent YÃªu cáº§u**: 
- ChuyÃªn mÃ´n ABP Framework 8.0 vá»›i Domain Services vÃ  Application Services
- PhÃ¡t triá»ƒn Angular 19 vá»›i PrimeNG components
- Triá»ƒn khai SignalR real-time communication
- Entity Framework Core migrations vÃ  data modeling
- Triá»ƒn khai thuáº­t toÃ¡n business logic (multi-level sorting)

### Tham chiáº¿u Debug Log
**Vá»‹ trÃ­ Debug Log**: `.ai/debug-log.md` (Sáº½ Ä‘Æ°á»£c Ä‘iá»n trong quÃ¡ trÃ¬nh triá»ƒn khai)
**CÃ¡c pháº§n Debug chÃ­nh**:
- Váº¥n Ä‘á» migration MenuItem entity vÃ  thÃªm boolean fields
- Testing thuáº­t toÃ¡n KitchenPriorityService vÃ  xá»­ lÃ½ edge cases
- Quáº£n lÃ½ káº¿t ná»‘i SignalR vÃ  thiáº¿t láº­p kitchen station groups
- Angular component state management vÃ  real-time updates

### Ghi chÃº HoÃ n thÃ nh
**Tráº¡ng thÃ¡i Triá»ƒn khai**: ChÆ°a báº¯t Ä‘áº§u
**TiÃªu chÃ­ HoÃ n thÃ nh**:
- [ ] Táº¥t cáº£ 7 TiÃªu chÃ­ Cháº¥p nháº­n Ä‘Æ°á»£c validate vÃ  test
- [ ] MenuItem entity Ä‘Æ°á»£c cáº­p nháº­t thÃ nh cÃ´ng vá»›i cÃ¡c trÆ°á»ng IsQuickCook/RequiresCooking
- [ ] Thuáº­t toÃ¡n Æ°u tiÃªn Ä‘a cáº¥p hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c vá»›i dá»¯ liá»‡u test
- [ ] Kitchen dashboard chá»‰ hiá»ƒn thá»‹ mÃ³n RequiresCooking=true
- [ ] Real-time updates hoáº¡t Ä‘á»™ng trÃªn nhiá»u kitchen displays
- [ ] Táº¥t cáº£ test cases pass vá»›i â‰¥80% domain service coverage

### Danh sÃ¡ch File
**Files sáº½ Ä‘Æ°á»£c Táº¡o/Sá»­a Ä‘á»•i**:
```
Backend Files:
- aspnet-core/src/SmartRestaurant.Domain/MenuManagement/MenuItems/MenuItem.cs (UPDATE - thÃªm boolean fields)
- aspnet-core/src/SmartRestaurant.Domain/Kitchen/KitchenPriorityService.cs (CREATE)
- aspnet-core/src/SmartRestaurant.Application/Kitchen/KitchenDashboardAppService.cs (CREATE)
- aspnet-core/src/SmartRestaurant.Application/Kitchen/Dtos/KitchenOrderItemDto.cs (CREATE)
- aspnet-core/src/SmartRestaurant.Application/Kitchen/Dtos/CookingStatsDto.cs (CREATE)
- aspnet-core/src/SmartRestaurant.HttpApi.Host/Hubs/KitchenPriorityHub.cs (CREATE)
- aspnet-core/src/SmartRestaurant.EntityFrameworkCore/Migrations/[Timestamp]_AddMenuItemCookingFields.cs (CREATE)

Frontend Files:
- angular/src/app/restaurant-features/kitchen-management/kitchen-management.module.ts (CREATE)
- angular/src/app/restaurant-features/kitchen-management/components/kitchen-dashboard/kitchen-dashboard.component.ts (CREATE)
- angular/src/app/restaurant-features/kitchen-management/components/kitchen-dashboard/kitchen-dashboard.component.html (CREATE)
- angular/src/app/restaurant-features/kitchen-management/components/order-item-card/order-item-card.component.ts (CREATE)
- angular/src/app/restaurant-features/kitchen-management/services/kitchen-dashboard.service.ts (CREATE)
- angular/src/app/shared/services/signalr.service.ts (UPDATE - thÃªm kitchen hub methods)

Test Files:
- test/SmartRestaurant.Domain.Tests/Kitchen/KitchenPriorityService_Tests.cs (CREATE)
- test/SmartRestaurant.Application.Tests/Kitchen/KitchenDashboardAppService_Tests.cs (CREATE)
- angular/src/app/restaurant-features/kitchen-management/components/kitchen-dashboard/kitchen-dashboard.component.spec.ts (CREATE)
```

## Káº¿t quáº£ QA

### Tráº¡ng thÃ¡i QA
**QA Agent**: TBD (Sáº½ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong giai Ä‘oáº¡n testing)
**Tráº¡ng thÃ¡i QA Execution**: Äang chá» HoÃ n thÃ nh Triá»ƒn khai

### Káº¿t quáº£ Test Execution
**Unit Tests**: ChÆ°a thá»±c hiá»‡n (0/0 passing)
**Integration Tests**: ChÆ°a thá»±c hiá»‡n (0/0 passing)
**Component Tests**: ChÆ°a thá»±c hiá»‡n (0/0 passing)
**E2E Tests**: ChÆ°a thá»±c hiá»‡n (0/0 passing)

### Váº¥n Ä‘á» ÄÃ£ biáº¿t
**Váº¥n Ä‘á» Blocker**: KhÃ´ng cÃ³ váº¥n Ä‘á» nÃ o Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh trong giai Ä‘oáº¡n draft
**Váº¥n Ä‘á» Critical**: 
- Phá»¥ thuá»™c vÃ o cáº­p nháº­t MenuItem entity cáº§n verification tá»« Story 5.1
**Váº¥n Ä‘á» Minor**: 
- TÃªn API endpoint cÃ³ thá»ƒ cáº§n Ä‘iá»u chá»‰nh trong quÃ¡ trÃ¬nh triá»ƒn khai dá»±a trÃªn quy Æ°á»›c ABP

### BÃ¡o cÃ¡o Test Coverage
**Backend Coverage**: TBD (Má»¥c tiÃªu: â‰¥80% Domain Services, â‰¥70% Application Services)
**Frontend Coverage**: TBD (Má»¥c tiÃªu: â‰¥60% Components)

### Káº¿t quáº£ Performance Test
**Káº¿t quáº£ Load Test**: TBD (Má»¥c tiÃªu: Há»— trá»£ 10+ kitchen displays Ä‘á»“ng thá»i)
**Performance Thuáº­t toÃ¡n Priority**: TBD (Má»¥c tiÃªu: <100ms cho 500+ order items)
**Performance SignalR Connection**: TBD (Má»¥c tiÃªu: <2s thá»i gian reconnection)

### QA Sign-off
**Functional Testing**: â³ Äang chá»
**Performance Testing**: â³ Äang chá»
**Security Testing**: â³ Äang chá»
**Accessibility Testing**: â³ Äang chá»
**QA Approval Cuá»‘i cÃ¹ng**: â³ Äang chá»

## Nháº­t kÃ½ Thay Ä‘á»•i

| NgÃ y | PhiÃªn báº£n | MÃ´ táº£ | TÃ¡c giáº£ |
|------|-----------|-------|---------|
| 2025-01-15 | 1.0 | Táº¡o story ban Ä‘áº§u vá»›i template cáº¥p 3 cho Kitchen Priority Management Dashboard | Bob (Scrum Master) |
| 2025-01-15 | 1.1 | ThÃªm Æ¯u tiÃªn BÃ n Trá»‘ng (TC 6) - BÃ n cÃ³ 0-1 mÃ³n Ä‘Ã£ phá»¥c vá»¥ Ä‘Æ°á»£c tÄƒng Æ°u tiÃªn Ä‘á»ƒ trÃ¡nh khÃ¡ch chá» mÃ  khÃ´ng cÃ³ gÃ¬ Äƒn | Bob (Scrum Master) |
| 2025-01-15 | 2.0 | ÄÆ¡n giáº£n hÃ³a thÃ nh Template cáº¥p 2 - táº­p trung vÃ o logic nghiá»‡p vá»¥, bá» Redis/GraphQL/cache phá»©c táº¡p | Bob (Scrum Master) |
| 2025-01-15 | 2.1 | ThÃªm Thuáº­t toÃ¡n Sáº¯p xáº¿p NÃ¢ng cao (TC 7) - Sáº¯p xáº¿p Ä‘a cáº¥p: mÃ³n náº¥u nhanh â†’ bÃ n chÆ°a cÃ³ mÃ³n â†’ bÃ n tá»›i trÆ°á»›c vá»›i PriorityScore | Bob (Scrum Master) |
| 2025-01-15 | 2.2 | Cáº­p nháº­t vá»›i logic RequiresCooking - dashboard chá»‰ hiá»ƒn thá»‹ nhá»¯ng mÃ³n cáº§n náº¥u, lá»c bá» mÃ³n láº¥y sáºµn | Sarah (Product Owner) |
| 2025-01-15 | 2.3 | Sá»­a cÃ¡c váº¥n Ä‘á» validation: ThÃªm section Testing, Dev Agent Record, QA Results. LÃ m rÃµ tráº¡ng thÃ¡i phá»¥ thuá»™c MenuItem vÃ  giáº£ Ä‘á»‹nh API endpoint | Sarah (Product Owner) |