# C√¢u chuy·ªán ng∆∞·ªùi d√πng 5.2: B·∫£ng ƒëi·ªÅu khi·ªÉn Qu·∫£n l√Ω ∆Øu ti√™n B·∫øp

**Epic**: Epic 5 - X·ª≠ l√Ω ƒê∆°n h√†ng & Ph·ªëi h·ª£p B·∫øp  
**ƒêi·ªÉm Story**: 35-50 (Template c·∫•p 2 - Logic Nghi·ªáp v·ª•)  
**∆Øu ti√™n**: Cao  
**Tr·∫°ng th√°i**: B·∫£n nh√°p
**Ng∆∞·ªùi ƒë∆∞·ª£c giao**: Nh√≥m Ph√°t tri·ªÉn  
**Sprint**: Ch∆∞a x√°c ƒë·ªãnh

## Th√¥ng tin Template

### C·∫•p ƒë·ªô Template
**C·∫•p ƒë·ªô ƒë√£ ch·ªçn**: C·∫•p 2 (Template Logic Nghi·ªáp v·ª•)

### Ph√¢n t√≠ch ƒê·ªô ph·ª©c t·∫°p
- **ƒê·ªô ph·ª©c t·∫°p Entity**: Logic Nghi·ªáp v·ª• - Dashboard b·∫øp v·ªõi logic ∆∞u ti√™n ƒë∆°n gi·∫£n, s·∫Øp x·∫øp theo th·ªùi gian v√† lo·∫°i m√≥n
- **ƒê·ªô ph·ª©c t·∫°p UI**: Quy tr√¨nh l√†m vi·ªác - Hi·ªÉn th·ªã danh s√°ch ƒë∆°n h√†ng v·ªõi tr·∫°ng th√°i v√† l·ªçc theo tr·∫°m b·∫øp
- **Y√™u c·∫ßu K·ªπ thu·∫≠t**: Logic Nghi·ªáp v·ª• - C√°c d·ªãch v·ª• ·ª©ng d·ª•ng t√πy ch·ªânh v·ªõi logic t√≠nh to√°n ∆∞u ti√™n ƒë∆°n gi·∫£n

### ∆Ø·ªõc t√≠nh ƒêi·ªÉm Story
**Ph·∫°m vi**: 35-50 ƒëi·ªÉm d·ª±a tr√™n ƒë·ªô ph·ª©c t·∫°p template c·∫•p 2

### Tham chi·∫øu Template
- **Template Backend**: templates/backend-template-level2.md
- **Template Frontend**: templates/frontend-template-level2.md  
- **Template Task**: .bmad-core/templates/level2-tasks.yaml

## Ph·ª• thu·ªôc Story

**ƒêi·ªÅu ki·ªán ti√™n quy·∫øt**:
- ‚úÖ **Story 5.1 - Quy tr√¨nh Qu·∫£n l√Ω ƒê∆°n h√†ng Nh√¢n vi√™n Ph·ª•c v·ª•**: B·∫ÆT BU·ªòC - C√°c entity ƒë∆°n h√†ng, quy tr√¨nh OrderStatus, v√† SignalR hubs ph·∫£i ho·∫°t ƒë·ªông
- ‚ö†Ô∏è **D·ªØ li·ªáu MenuItem v·ªõi Tr∆∞·ªùng Boolean**: PH·ª§ THU·ªòC CH∆ØA X√ÅC NH·∫¨N - Entity MenuItem c·∫ßn 2 tr∆∞·ªùng boolean: IsQuickCook v√† RequiresCooking (Task BE-0 s·∫Ω th√™m c√°c tr∆∞·ªùng n√†y n·∫øu ch∆∞a c√≥ t·ª´ Story 5.1)

**ƒêi·ªÉm t√≠ch h·ª£p t∆∞∆°ng lai**:
- üîÑ **Epic 8 - X·ª≠ l√Ω Thanh to√°n**: T√≠ch h·ª£p t∆∞∆°ng lai cho quy tr√¨nh ho√†n th√†nh ƒë∆°n h√†ng
- üîÑ **Epic 9 - B√°o c√°o Ph√¢n t√≠ch**: S·ªë li·ªáu hi·ªáu su·∫•t v√† b√°o c√°o hi·ªáu qu·∫£ b·∫øp

## M√¥ t·∫£ Story

**V·ªõi t∆∞ c√°ch l√†** nh√¢n vi√™n b·∫øp,  
**T√¥i mu·ªën** xem c√°c b√†n c√≥ m√≥n c·∫ßn n·∫•u (RequiresCooking=true) ch∆∞a ph·ª•c v·ª• ƒë∆∞·ª£c ∆∞u ti√™n theo th·ªùi gian g·ªçi m√≥n v√† t·ªëc ƒë·ªô ch·∫ø bi·∫øn,  
**ƒê·ªÉ** t√¥i c√≥ th·ªÉ t·∫≠p trung v√†o ch·∫ø bi·∫øn nh·ªØng m√≥n ph·∫£i n·∫•u, b·ªè qua m√≥n l·∫•y s·∫µn, v√† t·ªëi ∆∞u th·ª© t·ª± n·∫•u ƒÉn theo ƒë·ªô ∆∞u ti√™n.

## Ti√™u ch√≠ Ch·∫•p nh·∫≠n

1. **Hi·ªÉn th·ªã ƒê∆°n h√†ng theo B√†n**: Hi·ªÉn th·ªã ƒë∆°n h√†ng theo b√†n cho c√°c m√≥n c√≥ RequiresCooking=true ch∆∞a ph·ª•c v·ª•, s·∫Øp x·∫øp theo th·ªùi gian g·ªçi

2. **Ch·ªâ b√°o M√≥n n·∫•u nhanh**: ƒê√°nh d·∫•u m√≥n n·∫•u nhanh (rau, ƒë·∫≠u ph·ª•, m√≥n nh·∫π) v·ªõi ch·ªâ b√°o ∆∞u ti√™n tr·ª±c quan

3. **∆Ø·ªõc t√≠nh Th·ªùi gian N·∫•u**: ∆Ø·ªõc t√≠nh th·ªùi gian n·∫•u cho t·ª´ng m√≥n v·ªõi m·ª©c ƒë·ªô kh·∫©n c·∫•p ƒë∆∞·ª£c m√£ h√≥a m√†u s·∫Øc

4. **G·ª£i √Ω Chu·∫©n b·ªã Th√¥ng minh**: G·ª£i √Ω chu·∫©n b·ªã th√¥ng minh c√¢n b·∫±ng ∆∞u ti√™n ƒë∆°n h√†ng ƒë·∫øn tr∆∞·ªõc v·ªõi c∆° h·ªôi ph·ª•c v·ª• nhanh

5. **C·∫≠p nh·∫≠t Th·ªùi gian th·ª±c**: C·∫≠p nh·∫≠t th·ªùi gian th·ª±c khi m√≥n ƒë∆∞·ª£c ho√†n th√†nh v√† ph·ª•c v·ª• cho b√†n

6. **∆Øu ti√™n B√†n Tr·ªëng**: B√†n ch∆∞a c√≥ m√≥n n√†o ho·∫∑c ch·ªâ c√≥ 1 m√≥n ƒë∆∞·ª£c ∆∞u ti√™n ƒë·ªÉ tr√°nh kh√°ch ch·ªù m√† kh√¥ng c√≥ g√¨ ƒÉn

7. **S·∫Øp x·∫øp N√¢ng cao**: Thu·∫≠t to√°n s·∫Øp x·∫øp ƒëa c·∫•p theo th·ª© t·ª± ∆∞u ti√™n: m√≥n n·∫•u nhanh ‚Üí b√†n ch∆∞a c√≥ m√≥n ‚Üí b√†n t·ªõi tr∆∞·ªõc

## Nhi·ªám v·ª• / Nhi·ªám v·ª• ph·ª•

### Nhi·ªám v·ª• Backend (C·∫•p 2 - Logic Nghi·ªáp v·ª•)

- [ ] **BE-0**: C·∫≠p nh·∫≠t MenuItem Entity v·ªõi Tr∆∞·ªùng Boolean (TC: 2, 4, 6, 7)
  - [ ] Th√™m thu·ªôc t√≠nh IsQuickCook (bool) v√†o MenuItem entity
  - [ ] Th√™m thu·ªôc t√≠nh RequiresCooking (bool) v√†o MenuItem entity  
  - [ ] T·∫°o migration cho 2 tr∆∞·ªùng m·ªõi
  - [ ] C·∫≠p nh·∫≠t d·ªØ li·ªáu m·∫´u cho c√°c m√≥n ƒÉn v·ªõi gi√° tr·ªã boolean ph√π h·ª£p
  - [ ] Ch·∫°y migration ƒë·ªÉ c·∫≠p nh·∫≠t database schema

- [ ] **BE-1**: T·∫°o Domain Services cho Logic ∆Øu ti√™n B·∫øp (TC: 1, 4, 6, 7)
  - [ ] T·∫°o KitchenPriorityService v·ªõi logic l·ªçc v√† t√≠nh to√°n ∆∞u ti√™n
  - [ ] Tri·ªÉn khai logic l·ªçc ch·ªâ hi·ªÉn th·ªã m√≥n RequiresCooking=true
  - [ ] Tri·ªÉn khai thu·∫≠t to√°n s·∫Øp x·∫øp ƒëa c·∫•p cho m√≥n c·∫ßn n·∫•u:
    - C·∫•p 1: M√≥n n·∫•u nhanh (IsQuickCook=true) trong danh s√°ch c·∫ßn n·∫•u
    - C·∫•p 2: B√†n ch∆∞a c√≥ m√≥n n√†o l√™n tr∆∞·ªõc  
    - C·∫•p 3: B√†n t·ªõi tr∆∞·ªõc (FIFO theo OrderTime)
  - [ ] T·∫°o method CalculateCookingPriorityScore() cho OrderItem c√≥ RequiresCooking=true
  - [ ] Tri·ªÉn khai logic ƒë·∫øm s·ªë m√≥n ƒë√£ ph·ª•c v·ª• cho m·ªói b√†n
  - [ ] T·∫°o method GetCookingOrderItemsSequence() ch·ªâ tr·∫£ v·ªÅ m√≥n c·∫ßn n·∫•u ƒë√£ s·∫Øp x·∫øp

- [ ] **BE-2**: Tri·ªÉn khai Application Services cho Dashboard B·∫øp (TC: 1, 2, 3, 5, 7)
  - [ ] T·∫°o KitchenDashboardAppService v·ªõi c√°c method cho m√≥n c·∫ßn n·∫•u
  - [ ] Th√™m GetCookingOrdersAsync() - l·∫•y danh s√°ch m√≥n RequiresCooking=true ƒë√£ s·∫Øp x·∫øp
  - [ ] Th√™m UpdateOrderItemStatusAsync() - c·∫≠p nh·∫≠t tr·∫°ng th√°i m√≥n c·∫ßn n·∫•u
  - [ ] Th√™m GetCookingOrdersByStationAsync() - l·ªçc m√≥n c·∫ßn n·∫•u theo tr·∫°m b·∫øp v·ªõi s·∫Øp x·∫øp ∆∞u ti√™n
  - [ ] T·∫°o GetCookingPriorityOrdersAsync() - √°p d·ª•ng thu·∫≠t to√°n s·∫Øp x·∫øp ƒëa c·∫•p ch·ªâ cho m√≥n c·∫ßn n·∫•u

- [ ] **BE-3**: Thi·∫øt l·∫≠p SignalR Hub c∆° b·∫£n (TC: 5)
  - [ ] T·∫°o KitchenHub cho th√¥ng b√°o th·ªùi gian th·ª±c
  - [ ] Th√™m method NotifyOrderStatusChanged() 
  - [ ] Th√™m method NotifyNewOrderReceived()
  - [ ] C·∫•u h√¨nh authorization cho nh√¢n vi√™n b·∫øp
  - [ ] Thi·∫øt l·∫≠p connection groups theo tr·∫°m b·∫øp

### Nhi·ªám v·ª• Frontend (C·∫•p 2 - Quy tr√¨nh l√†m vi·ªác)

- [ ] **FE-1**: T·∫°o Components c∆° b·∫£n cho Dashboard B·∫øp (TC: 1, 2, 3)
  - [ ] T·∫°o KitchenDashboardComponent hi·ªÉn th·ªã danh s√°ch ƒë∆°n h√†ng
  - [ ] T·∫°o OrderItemCard v·ªõi th√¥ng tin m√≥n ƒÉn v√† tr·∫°ng th√°i
  - [ ] Th√™m ch·ªâ b√°o m√†u s·∫Øc cho m√≥n n·∫•u nhanh (badge xanh)
  - [ ] Th√™m ch·ªâ b√°o ∆∞u ti√™n b√†n tr·ªëng (badge ƒë·ªè)
  - [ ] T·∫°o filter dropdown cho tr·∫°m b·∫øp

- [ ] **FE-2**: Tri·ªÉn khai SignalR Client ƒë∆°n gi·∫£n (TC: 5)
  - [ ] Thi·∫øt l·∫≠p SignalR connection service
  - [ ] L·∫Øng nghe s·ª± ki·ªán c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng
  - [ ] C·∫≠p nh·∫≠t UI khi c√≥ ƒë∆°n h√†ng m·ªõi
  - [ ] Hi·ªÉn th·ªã th√¥ng b√°o khi m√≥n ƒë√£ ho√†n th√†nh
  - [ ] X·ª≠ l√Ω l·ªói k·∫øt n·ªëi c∆° b·∫£n

- [ ] **FE-3**: T√≠nh nƒÉng C·∫≠p nh·∫≠t Tr·∫°ng th√°i (TC: 5)
  - [ ] Th√™m buttons "B·∫Øt ƒë·∫ßu n·∫•u", "Ho√†n th√†nh" cho m·ªói m√≥n
  - [ ] T·∫°o modal x√°c nh·∫≠n thay ƒë·ªïi tr·∫°ng th√°i
  - [ ] C·∫≠p nh·∫≠t m√†u s·∫Øc v√† tr·∫°ng th√°i real-time
  - [ ] Hi·ªÉn th·ªã th·ªùi gian ∆∞·ªõc t√≠nh ho√†n th√†nh
  - [ ] Th√™m ghi ch√∫ cho t·ª´ng m√≥n n·∫øu c·∫ßn

### Nhi·ªám v·ª• Ki·ªÉm th·ª≠ (C·∫•p 2 - Ki·ªÉm th·ª≠ C∆° b·∫£n)

- [ ] **TEST-1**: Unit Tests cho Logic Nghi·ªáp v·ª• (TC: T·∫•t c·∫£)
  - [ ] Test KitchenPriorityService - thu·∫≠t to√°n s·∫Øp x·∫øp ƒëa c·∫•p
  - [ ] Test CalculateAdvancedPriorityScore() v·ªõi nhi·ªÅu scenarios
  - [ ] Test s·∫Øp x·∫øp: m√≥n n·∫•u nhanh ‚Üí b√†n tr·ªëng ‚Üí b√†n t·ªõi tr∆∞·ªõc
  - [ ] Test KitchenDashboardAppService methods v·ªõi d·ªØ li·ªáu ƒë√£ s·∫Øp x·∫øp
  - [ ] Test cases cho c√°c tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát: b√†n c√≥ c√πng th·ªùi gian, c√πng lo·∫°i m√≥n

- [ ] **TEST-2**: Component Tests cho Frontend (TC: 1, 2, 3, 5)
  - [ ] Test KitchenDashboardComponent hi·ªÉn th·ªã ƒë√∫ng
  - [ ] Test OrderItemCard v·ªõi c√°c tr·∫°ng th√°i kh√°c nhau
  - [ ] Test filter theo tr·∫°m b·∫øp ho·∫°t ƒë·ªông
  - [ ] Test c·∫≠p nh·∫≠t tr·∫°ng th√°i m√≥n ƒÉn
  - [ ] Test SignalR connection service

## Ki·ªÉm th·ª≠

### Chi·∫øn l∆∞·ª£c Ki·ªÉm th·ª≠
**Ph∆∞∆°ng ph√°p Ki·ªÉm th·ª≠ C·∫•p 2**: T·∫≠p trung v√†o validation logic nghi·ªáp v·ª• v√† ki·ªÉm th·ª≠ ch·ª©c nƒÉng UI c∆° b·∫£n

**Y√™u c·∫ßu Test Coverage**: ‚â•80% cho Domain Services, ‚â•70% cho Application Services, ‚â•60% cho Components

### Framework Unit Testing
- **Backend**: xUnit v·ªõi ABP Test Framework, assertions Shouldly
- **Frontend**: Angular TestBed v·ªõi Jasmine/Karma
- **Mocking**: NSubstitute cho .NET services, Angular testing utilities cho components

### Integration Testing
- **SignalR Hub Testing**: Mock connections ƒë·ªÉ validation t√≠nh nƒÉng real-time
- **Database Integration**: In-memory database cho repository testing
- **API Integration**: ABP Test framework cho application service testing

### Qu·∫£n l√Ω Test Data
- **Seed Data**: C√°c MenuItem entities test-specific v·ªõi gi√° tr·ªã IsQuickCook/RequiresCooking ƒë√£ bi·∫øt
- **Test Scenarios**: C√°c k·∫øt h·ª£p ƒë∆°n h√†ng ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr∆∞·ªõc cho priority algorithm testing
- **Mock Data**: C·∫•u h√¨nh kitchen station v√† table setups

### C√¢n nh·∫Øc Performance Testing
- **Load Testing**: M√¥ ph·ªèng nhi·ªÅu kitchen displays k·∫øt n·ªëi ƒë·ªìng th·ªùi
- **Priority Calculation Performance**: Test thu·∫≠t to√°n sorting v·ªõi datasets ƒë∆°n h√†ng l·ªõn (500+ items)
- **SignalR Connection Handling**: Test c√°c scenarios reconnection v√† message queuing

## Ghi ch√∫ Dev

### H∆∞·ªõng d·∫´n C·ª• th·ªÉ Template (C·∫•p 2 - Logic Nghi·ªáp v·ª•)

**Patterns Tri·ªÉn khai cho Dashboard B·∫øp:**
- S·ª≠ d·ª•ng ABP Application Services v·ªõi Domain Services ƒë∆°n gi·∫£n cho logic ∆∞u ti√™n
- Tri·ªÉn khai logic nghi·ªáp v·ª• t√≠nh to√°n ∆∞u ti√™n: FIFO + m√≥n n·∫•u nhanh + b√†n tr·ªëng
- S·ª≠ d·ª•ng SignalR Hub c∆° b·∫£n cho th√¥ng b√°o real-time
- Entity Framework Core v·ªõi queries ƒë∆°n gi·∫£n cho danh s√°ch ƒë∆°n h√†ng
- Angular components v·ªõi PrimeNG cho hi·ªÉn th·ªã danh s√°ch

**Dependencies B·∫Øt bu·ªôc cho H·ªá th·ªëng B·∫øp:**
- ABP Framework 8.0 v·ªõi h·ªó tr·ª£ authorization v√† localization
- SignalR cho th√¥ng b√°o th·ªùi gian th·ª±c c∆° b·∫£n
- Entity Framework Core cho truy v·∫•n d·ªØ li·ªáu
- Angular 19 v·ªõi PrimeNG components
- **@microsoft/signalr**: ^8.0.0 cho client-side real-time communication

**C·∫•u h√¨nh C∆° b·∫£n cho H·ªá th·ªëng B·∫øp:**
```bash
# C·∫•u h√¨nh Backend c∆° b·∫£n
DEFAULT_CONNECTION_STRING=Host=localhost;Database=SmartRestaurant;Username=postgres;Password=postgres

# C·∫•u h√¨nh SignalR ƒë∆°n gi·∫£n
SIGNALR_CORS_ORIGINS=http://localhost:4200
SIGNALR_HUB_TIMEOUT=30000

# C·∫•u h√¨nh Angular Dashboard
API_BASE_URL=https://localhost:44346
WEBSOCKET_URL=wss://localhost:44346/hubs/kitchen
```

**C·∫•u tr√∫c File v√† Quy ∆∞·ªõc ƒê·∫∑t t√™n cho H·ªá th·ªëng B·∫øp:**
```
Ki·∫øn tr√∫c Backend B·∫øp:
- aspnet-core/src/SmartRestaurant.Domain/Kitchen/ (kitchen domain entities v√† services)
- aspnet-core/src/SmartRestaurant.Application/Kitchen/ (kitchen application services v√† DTOs)
- aspnet-core/src/SmartRestaurant.HttpApi.Host/Hubs/KitchenPriorityHub.cs (real-time kitchen communication)

Dashboard Frontend B·∫øp:  
- angular/src/app/restaurant-features/kitchen-management/ (kitchen dashboard feature module)
- angular/src/app/restaurant-features/kitchen-management/components/ (kitchen UI components)
- angular/src/app/restaurant-features/kitchen-management/services/ (kitchen API client services)
- angular/src/app/shared/models/kitchen/ (kitchen data models)
```

### Ng·ªØ c·∫£nh Story Tr∆∞·ªõc t·ª´ Story 5.1
T·ª´ vi·ªác ho√†n th√†nh Story 5.1 - H·ªá th·ªëng qu·∫£n l√Ω ƒë∆°n h√†ng ƒë√£ t·∫°o n·ªÅn t·∫£ng cho:
- C√°c Order entities v·ªõi OrderStatus workflow (Pending, Confirmed, Preparing, Ready, Served, Paid)
- SignalR hubs cho real-time communication (KitchenHub, OrderStatusHub, TableManagementHub)
- OrderManager domain service v·ªõi business logic cho order processing
- Real-time status tracking v√† notification system
- **OrderItem entities v·ªõi MenuItem relationships s·∫µn s√†ng cho kitchen priority calculation**
- **MenuItem entity c·∫ßn th√™m 2 boolean fields: IsQuickCook v√† RequiresCooking**

### M√¥ h√¨nh D·ªØ li·ªáu ƒê∆°n gi·∫£n cho Dashboard B·∫øp

**S·ª≠ d·ª•ng Entities c√≥ s·∫µn t·ª´ Story 5.1:**
- `Order` - ƒë∆°n h√†ng v·ªõi OrderStatus  
- `OrderItem` - m√≥n trong ƒë∆°n h√†ng v·ªõi quantity v√† notes
- `MenuItem` - th√¥ng tin m√≥n ƒÉn v·ªõi 2 boolean fields: IsQuickCook, RequiresCooking
- `Table` - th√¥ng tin b√†n ƒÉn

**DTO cho Kitchen Dashboard:**
```csharp
public class KitchenOrderItemDto
{
    public Guid OrderId { get; set; }               
    public Guid OrderItemId { get; set; }            
    public string TableNumber { get; set; }        
    public string MenuItemName { get; set; }       
    public int Quantity { get; set; }              
    public DateTime OrderTime { get; set; }        
    public bool IsQuickCook { get; set; }          // T·ª´ MenuItem.IsQuickCook
    public bool RequiresCooking { get; set; }      // T·ª´ MenuItem.RequiresCooking
    public bool IsEmptyTablePriority { get; set; } // B√†n c√≥ √≠t m√≥n
    public int ServedDishesCount { get; set; }     // S·ªë m√≥n ƒë√£ ph·ª•c v·ª• cho b√†n n√†y
    public int PriorityScore { get; set; }         // ƒêi·ªÉm ∆∞u ti√™n t·ªïng (ƒë·ªÉ s·∫Øp x·∫øp)
    public OrderItemStatus Status { get; set; }    
}
```

**KitchenPriorityService Domain Service** (Logic nghi·ªáp v·ª• n√¢ng cao):
```csharp
public class KitchenPriorityService : DomainService
{
    // T√≠nh ƒëi·ªÉm ∆∞u ti√™n cho t·ª´ng OrderItem theo thu·∫≠t to√°n ƒëa c·∫•p
    Task<int> CalculateAdvancedPriorityScoreAsync(Guid orderItemId, Guid tableId, bool isQuickCook, bool requiresCooking, DateTime orderTime);
    
    // L·∫•y danh s√°ch ƒë√£ s·∫Øp x·∫øp theo ƒëi·ªÉm ∆∞u ti√™n (cao xu·ªëng th·∫•p)
    Task<List<KitchenOrderItemDto>> GetPriorizedOrderItemsAsync();
    
    // Ki·ªÉm tra m√≥n c√≥ ph·∫£i n·∫•u nhanh kh√¥ng (t·ª´ MenuItem.IsQuickCook)
    Task<bool> IsQuickCookItemAsync(Guid menuItemId);
    
    // ƒê·∫øm s·ªë m√≥n ƒë√£ ph·ª•c v·ª• cho b√†n
    Task<int> GetServedDishesCountAsync(Guid tableId);
    
    // S·∫Øp x·∫øp danh s√°ch theo PriorityScore
    Task<List<KitchenOrderItemDto>> SortByAdvancedPriorityAsync(List<KitchenOrderItemDto> items);
}
```

**T√≠ch h·ª£p SignalR cho C·∫≠p nh·∫≠t B·∫øp Th·ªùi gian th·ª±c**:  
[Ngu·ªìn: docs/architecture/core-workflows.md#Kitchen-Priority-Management-Workflow]
- KitchenPriorityHub ph√°t s√≥ng thay ƒë·ªïi ∆∞u ti√™n v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i n·∫•u ƒÉn
- Qu·∫£n l√Ω k·∫øt n·ªëi th·ªùi gian th·ª±c cho nhi·ªÅu hi·ªÉn th·ªã b·∫øp
- Nh√≥m c·ª• th·ªÉ tr·∫°m b·∫øp cho th√¥ng b√°o c√≥ m·ª•c ti√™u
- T√≠nh l·∫°i ∆∞u ti√™n t·ª± ƒë·ªông v·ªõi domain events

### Logic Nghi·ªáp v·ª• N√¢ng cao cho Dashboard B·∫øp

**Thu·∫≠t to√°n S·∫Øp x·∫øp ƒêa c·∫•p:**

**C·∫•p 0 - L·ªçc m√≥n c·∫ßn n·∫•u (ƒêi·ªÅu ki·ªán b·∫Øt bu·ªôc):**
- `MenuItem.RequiresCooking = true` ‚Üí Hi·ªÉn th·ªã tr√™n dashboard
- `MenuItem.RequiresCooking = false` ‚Üí Kh√¥ng hi·ªÉn th·ªã (m√≥n l·∫•y s·∫µn)
- M·ª•c ƒë√≠ch: Ch·ªâ hi·ªÉn th·ªã m√≥n ph·∫£i ch·∫ø bi·∫øn, b·ªè qua m√≥n l·∫•y s·∫µn

**C·∫•p 1 - M√≥n n·∫•u nhanh (Priority Score = 100):**
- `MenuItem.IsQuickCook = true` ‚Üí Score + 100  
- M·ª•c ƒë√≠ch: N·∫•u m√≥n nhanh tr∆∞·ªõc ƒë·ªÉ tƒÉng t·ªëc ph·ª•c v·ª• t·ªïng th·ªÉ

**C·∫•p 2 - B√†n ch∆∞a c√≥ m√≥n (Priority Score = 50):**
- B√†n c√≥ 0 m√≥n ƒë√£ ph·ª•c v·ª• ‚Üí Score + 50
- B√†n c√≥ 1 m√≥n ƒë√£ ph·ª•c v·ª• ‚Üí Score + 25  
- M·ª•c ƒë√≠ch: Tr√°nh kh√°ch ng·ªìi ch·ªù m√† kh√¥ng c√≥ g√¨ ƒÉn

**C·∫•p 3 - FIFO (Priority Score = th·ªùi gian):**
- T√≠nh ƒëi·ªÉm d·ª±a tr√™n th·ªùi gian: (now - OrderTime) / 60 (ph√∫t)
- ƒê∆°n ƒë·∫∑t tr∆∞·ªõc s·∫Ω c√≥ ƒëi·ªÉm cao h∆°n
- M·ª•c ƒë√≠ch: ƒê·∫£m b·∫£o c√¥ng b·∫±ng, ai t·ªõi tr∆∞·ªõc ph·ª•c v·ª• tr∆∞·ªõc

**C√¥ng th·ª©c t·ªïng Priority Score:**
```
TotalScore = QuickCookScore + EmptyTableScore + TimeScore
(Ch·ªâ √°p d·ª•ng cho m√≥n c√≥ RequiresCooking = true)
```

**V√≠ d·ª• th·ª±c t·∫ø:**
- M√≥n A: Tr·ª©ng chi√™n (RequiresCooking=true, IsQuickCook=true, 100 ƒëi·ªÉm) + B√†n tr·ªëng (50) + 15 ph√∫t ch·ªù (15) = **165 ƒëi·ªÉm**
- M√≥n B: Ph·ªü (RequiresCooking=true, IsQuickCook=false, 0 ƒëi·ªÉm) + B√†n c√≥ m√≥n (0) + 30 ph√∫t ch·ªù (30) = **30 ƒëi·ªÉm**
- M√≥n C: Bia (RequiresCooking=false) = **Kh√¥ng hi·ªÉn th·ªã** (nh√¢n vi√™n ph·ª•c v·ª• t·ª± l·∫•y)
‚Üí Th·ª© t·ª± ∆∞u ti√™n tr√™n dashboard: M√≥n A ‚Üí M√≥n B

**Hi·ªÉn th·ªã Dashboard B·∫øp:**
- Danh s√°ch OrderItem ƒë∆∞·ª£c s·∫Øp x·∫øp theo ∆∞u ti√™n
- M√†u s·∫Øc v√† badges cho t·ª´ng lo·∫°i ∆∞u ti√™n  
- Filter dropdown theo tr·∫°m b·∫øp
- Buttons c·∫≠p nh·∫≠t tr·∫°ng th√°i: "B·∫Øt ƒë·∫ßu n·∫•u", "Ho√†n th√†nh"
- C·∫≠p nh·∫≠t real-time qua SignalR khi c√≥ ƒë∆°n h√†ng m·ªõi ho·∫∑c thay ƒë·ªïi tr·∫°ng th√°i

### API ƒê∆°n gi·∫£n cho Dashboard B·∫øp

**KitchenDashboardAppService Endpoints:**
```csharp
// ABP t·ª± ƒë·ªông t·∫°o c√°c REST endpoints (L∆∞u √Ω: ƒê∆∞·ªùng d·∫´n ch√≠nh x√°c tu√¢n theo quy ∆∞·ªõc ABP v√† c√≥ th·ªÉ ƒë∆∞·ª£c ƒëi·ªÅu ch·ªânh trong qu√° tr√¨nh tri·ªÉn khai):
GET /api/app/kitchen-dashboard/cooking-orders               // L·∫•y danh s√°ch m√≥n c·∫ßn n·∫•u
GET /api/app/kitchen-dashboard/cooking-orders-by-station/{station}  // L·ªçc m√≥n c·∫ßn n·∫•u theo tr·∫°m b·∫øp  
PUT /api/app/kitchen-dashboard/order-item/{id}/status       // C·∫≠p nh·∫≠t tr·∫°ng th√°i m√≥n
```

**KitchenDashboardAppService Methods:**
```csharp
public class KitchenDashboardAppService : ApplicationService
{
    // L·∫•y danh s√°ch m√≥n c·∫ßn n·∫•u ƒë√£ s·∫Øp x·∫øp theo thu·∫≠t to√°n ∆∞u ti√™n
    Task<List<KitchenOrderItemDto>> GetCookingOrdersAsync();
    
    // L·ªçc m√≥n c·∫ßn n·∫•u theo tr·∫°m b·∫øp v·ªõi s·∫Øp x·∫øp ∆∞u ti√™n
    Task<List<KitchenOrderItemDto>> GetCookingOrdersByStationAsync(KitchenStation station);
    
    // C·∫≠p nh·∫≠t tr·∫°ng th√°i m√≥n v√† t√≠nh l·∫°i ∆∞u ti√™n cho b√†n ƒë√≥
    Task UpdateOrderItemStatusAsync(Guid orderItemId, OrderItemStatus status);
    
    // L·∫•y th·ªëng k√™ ∆∞u ti√™n cho dashboard m√≥n c·∫ßn n·∫•u
    Task<CookingStatsDto> GetCookingStatsAsync();
}

public class CookingStatsDto
{
    public int QuickCookItemsCount { get; set; }     // S·ªë m√≥n n·∫•u nhanh c·∫ßn ch·∫ø bi·∫øn
    public int EmptyTablesCount { get; set; }        // S·ªë b√†n ch∆∞a c√≥ m√≥n (trong c√°c m√≥n c·∫ßn n·∫•u)
    public int TotalCookingItems { get; set; }       // T·ªïng s·ªë m√≥n c·∫ßn n·∫•u
    public double AverageWaitingTime { get; set; }   // Th·ªùi gian ch·ªù trung b√¨nh (ph√∫t)
}
```

### Ki·∫øn tr√∫c Angular ƒê∆°n gi·∫£n

**Components ch√≠nh:**
- `KitchenDashboardComponent` - hi·ªÉn th·ªã danh s√°ch ƒë∆°n h√†ng
- `OrderItemCardComponent` - hi·ªÉn th·ªã t·ª´ng m√≥n v·ªõi tr·∫°ng th√°i v√† buttons
- `KitchenFilterComponent` - dropdown l·ªçc theo tr·∫°m b·∫øp

**Services:**
- `KitchenDashboardService` - g·ªçi API ƒë·ªÉ l·∫•y d·ªØ li·ªáu
- `SignalRService` - k·∫øt n·ªëi real-time v·ªõi backend

**State Management ƒê∆°n gi·∫£n:**
```typescript
interface KitchenDashboardState {
  cookingItems: KitchenOrderItemDto[];    // Danh s√°ch m√≥n c·∫ßn n·∫•u (RequiresCooking=true)
  selectedStation: KitchenStation | null; // Tr·∫°m ƒëang l·ªçc
  isLoading: boolean;                     // ƒêang t·∫£i d·ªØ li·ªáu
  isConnected: boolean;                   // Tr·∫°ng th√°i SignalR
}
```

**T√≠ch h·ª£p SignalR C∆° b·∫£n:**
- K·∫øt n·ªëi ƒë·∫øn KitchenHub  
- L·∫Øng nghe s·ª± ki·ªán c·∫≠p nh·∫≠t tr·∫°ng th√°i
- Reload danh s√°ch khi c√≥ thay ƒë·ªïi

### Y√™u c·∫ßu B·∫£o m·∫≠t v√† B·∫£n ƒë·ªãa h√≥a

**Permissions C·∫ßn thi·∫øt:**
```csharp
[Authorize(SmartRestaurantPermissions.Kitchen.View)]         // Xem dashboard b·∫øp
[Authorize(SmartRestaurantPermissions.Kitchen.UpdateStatus)] // C·∫≠p nh·∫≠t tr·∫°ng th√°i m√≥n
```

**B·∫£n ƒë·ªãa h√≥a Ti·∫øng Vi·ªát:**
- T·∫•t c·∫£ text hi·ªÉn th·ªã b·∫±ng ti·∫øng Vi·ªát
- T√™n tr·∫°m b·∫øp: Chung, L·∫©u, N∆∞·ªõng, ƒê·ªì u·ªëng  
- Tr·∫°ng th√°i m√≥n: Ch·ªù, ƒêang n·∫•u, Ho√†n th√†nh, ƒê√£ ph·ª•c v·ª•
- Th√¥ng b√°o l·ªói v√† x√°c nh·∫≠n b·∫±ng ti·∫øng Vi·ªát

## H·ªì s∆° Dev Agent

### M√¥ h√¨nh Agent
**Agent Tri·ªÉn khai**: TBD (S·∫Ω ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh trong sprint planning)
**Kh·∫£ nƒÉng Agent Y√™u c·∫ßu**: 
- Chuy√™n m√¥n ABP Framework 8.0 v·ªõi Domain Services v√† Application Services
- Ph√°t tri·ªÉn Angular 19 v·ªõi PrimeNG components
- Tri·ªÉn khai SignalR real-time communication
- Entity Framework Core migrations v√† data modeling
- Tri·ªÉn khai thu·∫≠t to√°n business logic (multi-level sorting)

### Tham chi·∫øu Debug Log
**V·ªã tr√≠ Debug Log**: `.ai/debug-log.md` (S·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn trong qu√° tr√¨nh tri·ªÉn khai)
**C√°c ph·∫ßn Debug ch√≠nh**:
- V·∫•n ƒë·ªÅ migration MenuItem entity v√† th√™m boolean fields
- Testing thu·∫≠t to√°n KitchenPriorityService v√† x·ª≠ l√Ω edge cases
- Qu·∫£n l√Ω k·∫øt n·ªëi SignalR v√† thi·∫øt l·∫≠p kitchen station groups
- Angular component state management v√† real-time updates

### Ghi ch√∫ Ho√†n th√†nh
**Tr·∫°ng th√°i Tri·ªÉn khai**: Ch∆∞a b·∫Øt ƒë·∫ßu
**Ti√™u ch√≠ Ho√†n th√†nh**:
- [ ] T·∫•t c·∫£ 7 Ti√™u ch√≠ Ch·∫•p nh·∫≠n ƒë∆∞·ª£c validate v√† test
- [ ] MenuItem entity ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng v·ªõi c√°c tr∆∞·ªùng IsQuickCook/RequiresCooking
- [ ] Thu·∫≠t to√°n ∆∞u ti√™n ƒëa c·∫•p ho·∫°t ƒë·ªông ch√≠nh x√°c v·ªõi d·ªØ li·ªáu test
- [ ] Kitchen dashboard ch·ªâ hi·ªÉn th·ªã m√≥n RequiresCooking=true
- [ ] Real-time updates ho·∫°t ƒë·ªông tr√™n nhi·ªÅu kitchen displays
- [ ] T·∫•t c·∫£ test cases pass v·ªõi ‚â•80% domain service coverage

### Danh s√°ch File
**Files s·∫Ω ƒë∆∞·ª£c T·∫°o/S·ª≠a ƒë·ªïi**:
```
Backend Files:
- aspnet-core/src/SmartRestaurant.Domain/MenuManagement/MenuItems/MenuItem.cs (UPDATE - th√™m boolean fields)
- aspnet-core/src/SmartRestaurant.Domain/Kitchen/KitchenPriorityService.cs (CREATE)
- aspnet-core/src/SmartRestaurant.Application/Kitchen/KitchenDashboardAppService.cs (CREATE)
- aspnet-core/src/SmartRestaurant.Application/Kitchen/Dtos/KitchenOrderItemDto.cs (CREATE)
- aspnet-core/src/SmartRestaurant.Application/Kitchen/Dtos/CookingStatsDto.cs (CREATE)
- aspnet-core/src/SmartRestaurant.HttpApi.Host/Hubs/KitchenPriorityHub.cs (CREATE)
- aspnet-core/src/SmartRestaurant.EntityFrameworkCore/Migrations/[Timestamp]_AddMenuItemCookingFields.cs (CREATE)

Frontend Files:
- angular/src/app/restaurant-features/kitchen-management/kitchen-management.module.ts (CREATE)
- angular/src/app/restaurant-features/kitchen-management/components/kitchen-dashboard/kitchen-dashboard.component.ts (CREATE)
- angular/src/app/restaurant-features/kitchen-management/components/kitchen-dashboard/kitchen-dashboard.component.html (CREATE)
- angular/src/app/restaurant-features/kitchen-management/components/order-item-card/order-item-card.component.ts (CREATE)
- angular/src/app/restaurant-features/kitchen-management/services/kitchen-dashboard.service.ts (CREATE)
- angular/src/app/shared/services/signalr.service.ts (UPDATE - th√™m kitchen hub methods)

Test Files:
- test/SmartRestaurant.Domain.Tests/Kitchen/KitchenPriorityService_Tests.cs (CREATE)
- test/SmartRestaurant.Application.Tests/Kitchen/KitchenDashboardAppService_Tests.cs (CREATE)
- angular/src/app/restaurant-features/kitchen-management/components/kitchen-dashboard/kitchen-dashboard.component.spec.ts (CREATE)
```

## K·∫øt qu·∫£ QA

### Tr·∫°ng th√°i QA
**QA Agent**: TBD (S·∫Ω ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh trong giai ƒëo·∫°n testing)
**Tr·∫°ng th√°i QA Execution**: ƒêang ch·ªù Ho√†n th√†nh Tri·ªÉn khai

### K·∫øt qu·∫£ Test Execution
**Unit Tests**: Ch∆∞a th·ª±c hi·ªán (0/0 passing)
**Integration Tests**: Ch∆∞a th·ª±c hi·ªán (0/0 passing)
**Component Tests**: Ch∆∞a th·ª±c hi·ªán (0/0 passing)
**E2E Tests**: Ch∆∞a th·ª±c hi·ªán (0/0 passing)

### V·∫•n ƒë·ªÅ ƒê√£ bi·∫øt
**V·∫•n ƒë·ªÅ Blocker**: Kh√¥ng c√≥ v·∫•n ƒë·ªÅ n√†o ƒë∆∞·ª£c x√°c ƒë·ªãnh trong giai ƒëo·∫°n draft
**V·∫•n ƒë·ªÅ Critical**: 
- Ph·ª• thu·ªôc v√†o c·∫≠p nh·∫≠t MenuItem entity c·∫ßn verification t·ª´ Story 5.1
**V·∫•n ƒë·ªÅ Minor**: 
- T√™n API endpoint c√≥ th·ªÉ c·∫ßn ƒëi·ªÅu ch·ªânh trong qu√° tr√¨nh tri·ªÉn khai d·ª±a tr√™n quy ∆∞·ªõc ABP

### B√°o c√°o Test Coverage
**Backend Coverage**: TBD (M·ª•c ti√™u: ‚â•80% Domain Services, ‚â•70% Application Services)
**Frontend Coverage**: TBD (M·ª•c ti√™u: ‚â•60% Components)

### K·∫øt qu·∫£ Performance Test
**K·∫øt qu·∫£ Load Test**: TBD (M·ª•c ti√™u: H·ªó tr·ª£ 10+ kitchen displays ƒë·ªìng th·ªùi)
**Performance Thu·∫≠t to√°n Priority**: TBD (M·ª•c ti√™u: <100ms cho 500+ order items)
**Performance SignalR Connection**: TBD (M·ª•c ti√™u: <2s th·ªùi gian reconnection)

### QA Sign-off
**Functional Testing**: ‚è≥ ƒêang ch·ªù
**Performance Testing**: ‚è≥ ƒêang ch·ªù
**Security Testing**: ‚è≥ ƒêang ch·ªù
**Accessibility Testing**: ‚è≥ ƒêang ch·ªù
**QA Approval Cu·ªëi c√πng**: ‚è≥ ƒêang ch·ªù

## Nh·∫≠t k√Ω Thay ƒë·ªïi

| Ng√†y | Phi√™n b·∫£n | M√¥ t·∫£ | T√°c gi·∫£ |
|------|-----------|-------|---------|
| 2025-01-15 | 1.0 | T·∫°o story ban ƒë·∫ßu v·ªõi template c·∫•p 3 cho Kitchen Priority Management Dashboard | Bob (Scrum Master) |
| 2025-01-15 | 1.1 | Th√™m ∆Øu ti√™n B√†n Tr·ªëng (TC 6) - B√†n c√≥ 0-1 m√≥n ƒë√£ ph·ª•c v·ª• ƒë∆∞·ª£c tƒÉng ∆∞u ti√™n ƒë·ªÉ tr√°nh kh√°ch ch·ªù m√† kh√¥ng c√≥ g√¨ ƒÉn | Bob (Scrum Master) |
| 2025-01-15 | 2.0 | ƒê∆°n gi·∫£n h√≥a th√†nh Template c·∫•p 2 - t·∫≠p trung v√†o logic nghi·ªáp v·ª•, b·ªè Redis/GraphQL/cache ph·ª©c t·∫°p | Bob (Scrum Master) |
| 2025-01-15 | 2.1 | Th√™m Thu·∫≠t to√°n S·∫Øp x·∫øp N√¢ng cao (TC 7) - S·∫Øp x·∫øp ƒëa c·∫•p: m√≥n n·∫•u nhanh ‚Üí b√†n ch∆∞a c√≥ m√≥n ‚Üí b√†n t·ªõi tr∆∞·ªõc v·ªõi PriorityScore | Bob (Scrum Master) |
| 2025-01-15 | 2.2 | C·∫≠p nh·∫≠t v·ªõi logic RequiresCooking - dashboard ch·ªâ hi·ªÉn th·ªã nh·ªØng m√≥n c·∫ßn n·∫•u, l·ªçc b·ªè m√≥n l·∫•y s·∫µn | Sarah (Product Owner) |
| 2025-01-15 | 2.3 | S·ª≠a c√°c v·∫•n ƒë·ªÅ validation: Th√™m section Testing, Dev Agent Record, QA Results. L√†m r√µ tr·∫°ng th√°i ph·ª• thu·ªôc MenuItem v√† gi·∫£ ƒë·ªãnh API endpoint | Sarah (Product Owner) |