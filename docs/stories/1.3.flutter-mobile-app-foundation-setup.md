# Story 1.3: Flutter Mobile App Foundation Setup (Thiết lập Nền tảng Ứng dụng Di động Flutter)

## Status (Trạng thái)
Approved

## Story (Câu chuyện)
**As a** restaurant staff member (nhân viên nhà hàng),  
**I want** to access restaurant management functions on mobile devices (tôi muốn truy cập các chức năng quản lý nhà hàng trên thiết bị di động),  
**so that** I can work efficiently from anywhere in the restaurant (để tôi có thể làm việc hiệu quả từ bất kỳ đâu trong nhà hàng).

## Acceptance Criteria (Tiêu chí Chấp nhận)
1. Flutter project structure established in monorepo with proper folder organization (Cấu trúc dự án Flutter được thiết lập trong monorepo với tổ chức thư mục phù hợp)
2. Basic navigation framework implemented with Vietnamese-only interface (Framework điều hướng cơ bản được triển khai với giao diện chỉ tiếng Việt)
3. Authentication integration with ABP backend APIs using JWT tokens (Tích hợp xác thực với API backend ABP sử dụng JWT token)
4. Vietnamese localization setup with proper date/time and currency formatting (Thiết lập bản địa hóa tiếng Việt với định dạng ngày/giờ và tiền tệ phù hợp)
5. HTTP client configuration for secure API communication with backend (Cấu hình HTTP client cho giao tiếp API an toàn với backend)
6. Basic responsive design framework for tablets and smartphones (Framework thiết kế responsive cơ bản cho tablet và smartphone)

## Tasks / Subtasks (Nhiệm vụ / Nhiệm vụ con)

- [ ] Thiết lập Cấu trúc Dự án Flutter (AC: 1)
  - [ ] Khởi tạo dự án Flutter trong monorepo: `flutter create flutter --platforms android,ios`
  - [ ] Tổ chức thư mục trong `flutter/lib/` theo kiến trúc dựa trên tính năng
  - [ ] Tạo các thư mục `flutter/lib/features/` cho orders, reservations, takeaway modules
  - [ ] Thiết lập `flutter/lib/shared/` cho models, services, widgets, và utils
  - [ ] Cấu hình pubspec.yaml với các dependencies cần thiết cho ứng dụng nhà hàng

- [ ] Thiết lập Môi trường Phát triển (AC: 1)
  - [ ] Thêm cấu hình Flutter vào root package.json scripts cho development workflow
  - [ ] Cấu hình Flutter build system cho thương hiệu nhà hàng Việt Nam
  - [ ] Thiết lập tài liệu môi trường phát triển trong CLAUDE.md
  - [ ] Tạo flutter/.env files cho cấu hình API development và production

- [ ] Triển khai Framework Điều hướng Cơ bản (AC: 2)
  - [ ] Cấu hình Flutter routing bằng go_router với tên route tiếng Anh
  - [ ] Tạo cấu trúc điều hướng chính với bottom navigation bar
  - [ ] Triển khai điều hướng màn hình cho 3 tính năng chính: Gọi món, Đặt bàn, Mang về
  - [ ] Thiết lập navigation guards cho role-based access control

- [ ] Tạo Framework UI Tiếng Việt (AC: 2, 6)
  - [ ] Cấu hình text constants và labels chỉ bằng tiếng Việt
  - [ ] Triển khai responsive design framework bằng flutter_screenutil
  - [ ] Tạo các UI components có thể tái sử dụng cho hoạt động nhà hàng
  - [ ] Cấu hình responsive breakpoints ưu tiên tablet

- [ ] Cấu hình HTTP Client (AC: 5)
  - [ ] Cài đặt và cấu hình dio package cho HTTP communication
  - [ ] Thiết lập API client với base URL configuration cho ABP backend
  - [ ] Triển khai HTTP interceptors cho request/response logging
  - [ ] Cấu hình timeout và retry policies cho môi trường nhà hàng

- [ ] Triển khai Tích hợp Xác thực (AC: 3)
  - [ ] Thiết lập JWT token storage bằng flutter_secure_storage
  - [ ] Triển khai chức năng login/logout với ABP OAuth endpoints
  - [ ] Tạo authentication service với token refresh logic
  - [ ] Thiết lập authentication state management bằng riverpod

- [ ] Cấu hình Định dạng Tiếng Việt (AC: 4)
  - [ ] Tạo constants file cho tất cả text tiếng Việt trong app
  - [ ] Triển khai Vietnamese date formatting (dd/MM/yyyy - ví dụ: 08/08/2025)
  - [ ] Triển khai Vietnamese datetime formatting (dd/MM/yyyy HH:mm:ss - ví dụ: 08/08/2025 14:40:30)
  - [ ] Thiết lập Vietnamese currency formatting (1.244.444đ)

- [ ] Xử lý Văn bản và Input Tiếng Việt (AC: 4)
  - [ ] Cấu hình hỗ trợ Vietnamese text input
  - [ ] Thiết lập Vietnamese number formatting cho order amounts
  - [ ] Triển khai Vietnamese text search functionality
  - [ ] Kiểm thử xử lý Vietnamese diacritical marks

- [ ] Thiết lập Framework Kiểm thử (Testing Requirements)
  - [ ] Cấu hình flutter_test cho unit testing
  - [ ] Thiết lập integration_test cho widget testing
  - [ ] Tạo test utilities cho Vietnamese data formatting
  - [ ] Viết basic authentication và navigation tests

- [ ] Tài liệu và Xác minh Build (Build Requirements)
  - [ ] Cập nhật tài liệu dự án với hướng dẫn Flutter setup
  - [ ] Xác minh clean build process cho Android và iOS
  - [ ] Kiểm thử responsive design trên tablet và smartphone simulators
  - [ ] Validate Vietnamese localization trên tất cả screens

## Dev Notes (Ghi chú Phát triển)

### Previous Story Context (Bối cảnh Câu chuyện Trước)
Stories 1.1 and 1.2 have established the ABP Framework backend with PostgreSQL Vietnamese collation support and Angular Poseidon theme integration. The development environment is ready with Docker containers and CI/CD pipeline. ABP backend API is running at https://localhost:44346 and supports JWT authentication.

### Mobile App Scope (Phạm vi Ứng dụng Di động)
This Flutter foundation is designed specifically for 3 core restaurant staff features:
1. **Gọi món ăn ở quán** (Dine-in ordering) - Staff take orders for customers eating at tables
2. **Đặt bàn** (Table reservations) - Staff manage table bookings and reservations  
3. **Gọi đồ mang về** (Takeaway orders) - Staff process orders for customers taking food away

The mobile app is intentionally simplified to focus on these essential staff workflows, avoiding complexity of full restaurant management features like kitchen displays, inventory, or reporting which will remain on the web platform.

### Tech Stack Configuration (Cấu hình Ngăn xếp Công nghệ)
[Source: architecture/tech-stack.md]
- **Mobile Framework**: Flutter 3.x with Dart 3.0+ for cross-platform mobile development  
- **State Management**: Riverpod for reactive state management and dependency injection
- **HTTP Client**: Dio package for API communication with ABP backend
- **Navigation**: go_router for type-safe routing with Vietnamese route names
- **Local Storage**: flutter_secure_storage for JWT token storage
- **Responsive Design**: flutter_screenutil for tablet and smartphone adaptation

### Project Structure Requirements (Yêu cầu Cấu trúc Dự án)
[Source: architecture/unified-project-structure.md]

**Flutter Project Structure**:
```
flutter/
├── lib/
│   ├── features/                    # Feature-based organization
│   │   ├── orders/                  # Gọi món ăn ở quán (dine-in orders)
│   │   ├── reservations/            # Đặt bàn (table reservations)
│   │   └── takeaway/                # Gọi đồ mang về (takeaway orders)
│   ├── shared/                      # Shared code
│   │   ├── models/                  # Data models
│   │   ├── services/                # API services
│   │   ├── widgets/                 # Reusable widgets
│   │   └── utils/                   # Utilities
│   └── main.dart                    # App entry point
├── test/                            # Flutter tests
├── pubspec.yaml                     # Flutter dependencies
└── android/                         # Android-specific code
```

**Root Package.json Integration**:
```json
{
  "scripts": {
    "dev:mobile": "cd flutter && flutter run",
    "build:mobile": "cd flutter && flutter build apk --release",
    "test:mobile": "cd flutter && flutter test"
  }
}
```

### Authentication Integration Requirements (Yêu cầu Tích hợp Xác thực)
[Source: architecture/coding-standards.md and previous story context]

**ABP Backend Integration Points**:
- Backend URL: https://localhost:44346 (standard backend URL)
- OAuth endpoints: `/connect/token` for JWT authentication
- API endpoints: `/api/app/*` following ABP convention
- JWT token refresh: Use refresh_token for session management
- Role-based permissions: Owner, Manager, Cashier, Kitchen Staff, Waitstaff

**Critical Mobile Integration Rules**:
- Always use ABP API endpoints - never create direct database connections
- Use JWT tokens for all authenticated API calls
- Handle token refresh automatically in HTTP interceptor
- Implement offline capability for critical restaurant operations
- Follow ABP permission system for mobile feature access

### Vietnamese Restaurant Mobile Requirements (Yêu cầu Di động Nhà hàng Việt Nam)
[Source: architecture/frontend-architecture.md and restaurant context]

**Vietnamese-Only App Specifications**:
- Hard-coded Vietnamese text - no localization system needed
- Currency format: 1.244.444đ (dấu chấm ngăn cách hàng nghìn, ký hiệu đ ở cuối)
- Date format: dd/MM/yyyy (ví dụ: 08/08/2025)
- DateTime format: dd/MM/yyyy HH:mm:ss (ví dụ: 08/08/2025 14:40:30)
- Vietnamese diacritical marks support in text input and display
- Vietnamese restaurant terminology: "Gọi món", "Đặt bàn", "Mang về"

**Mobile Navigation Structure**:
```dart
// Main navigation items for Vietnamese restaurant (3 core features)
final List<NavigationItem> restaurantNavItems = [
  NavigationItem(
    label: 'Gọi món',  // Vietnamese UI text
    icon: Icons.restaurant,
    route: '/orders'   // English route
  ),
  NavigationItem(
    label: 'Đặt bàn',  // Vietnamese UI text
    icon: Icons.event_seat,
    route: '/reservations'  // English route
  ),
  NavigationItem(
    label: 'Mang về',  // Vietnamese UI text
    icon: Icons.takeout_dining,
    route: '/takeaway'  // English route
  ),
];
```

### Flutter Dependencies and Configuration (Dependencies Flutter và Cấu hình)
[Source: architecture/tech-stack.md]

**Required pubspec.yaml Dependencies**:
```yaml
dependencies:
  flutter:
    sdk: flutter
  
  # Navigation
  go_router: ^12.0.0
  
  # State Management
  flutter_riverpod: ^2.4.0
  riverpod_annotation: ^2.3.0
  
  # HTTP Client & API
  dio: ^5.4.0
  retrofit: ^4.0.0
  json_annotation: ^4.8.0
  
  # Storage
  flutter_secure_storage: ^9.0.0
  shared_preferences: ^2.2.0
  
  # Date/Time formatting
  intl: ^0.19.0
  
  # UI & Responsive
  flutter_screenutil: ^5.9.0
  flutter_svg: ^2.0.0
  
dev_dependencies:
  flutter_test:
    sdk: flutter
  integration_test:
    sdk: flutter
  
  # Code generation
  build_runner: ^2.4.0
  riverpod_generator: ^2.3.0
  retrofit_generator: ^8.0.0
  json_serializable: ^6.7.0
```

### File Locations and Naming (Vị trí File và Đặt tên)
[Source: architecture/unified-project-structure.md]

**Flutter Project Files Structure**:
- Main app entry: `flutter/lib/main.dart`
- Feature modules: `flutter/lib/features/{feature_name}/`
- Shared components: `flutter/lib/shared/widgets/`
- API services: `flutter/lib/shared/services/api/`
- Models: `flutter/lib/shared/models/`
- Vietnamese constants: `flutter/lib/shared/constants/`
- Environment config: `flutter/.env` and `flutter/.env.production`

**Integration with Root Project**:
- Root package.json scripts for mobile development workflow
- Docker configuration may include Flutter build container (future enhancement)
- CI/CD pipeline integration for mobile app builds

### Testing (Kiểm thử)

#### Test File Locations (Vị trí File Kiểm thử)
[Source: architecture/testing-strategy.md]
- Unit Tests: `flutter/test/unit/`
- Widget Tests: `flutter/test/widgets/`
- Integration Tests: `flutter/integration_test/`
- Test Utilities: `flutter/test/utils/`

#### Testing Requirements for This Story (Yêu cầu Kiểm thử cho Câu chuyện này)
- **Authentication Tests**: Test JWT token storage and retrieval
- **Navigation Tests**: Verify Vietnamese route navigation works correctly
- **Vietnamese Formatting Tests**: Test date (08/08/2025), datetime (08/08/2025 14:40:30), và currency (1.244.444đ) formatting
- **API Integration Tests**: Test HTTP client configuration with ABP backend
- **Responsive Tests**: Verify layout adapts to tablet and smartphone screen sizes

#### Test Framework Standards (Chuẩn Framework Kiểm thử)
[Source: architecture/testing-strategy.md]
- **Unit Testing**: flutter_test for Dart unit tests
- **Widget Testing**: flutter_test for widget integration testing
- **Integration Testing**: integration_test for full app workflow testing
- **Mock Data**: Vietnamese restaurant test data matching backend ABP DTOs

## Change Log (Lịch sử Thay đổi)

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-18 | 1.0 | Initial story creation from Epic 1.3 with Flutter foundation requirements | Bob (Scrum Master) |

## Dev Agent Record (Ghi chép Tác nhân Phát triển)

*This section will be populated by the development agent during implementation*

### Agent Model Used (Mô hình Tác nhân Sử dụng)
*To be filled by development agent*

### Debug Log References (Tham chiếu Log Debug)
*No debug log references yet*

### Completion Notes List (Danh sách Ghi chú Hoàn thành)
*To be filled during implementation*

### File List (Danh sách File)
*To be filled during implementation*

## QA Results (Kết quả QA)

*This section will be populated by the QA agent after story review*